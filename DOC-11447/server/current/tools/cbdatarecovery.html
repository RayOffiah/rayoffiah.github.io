<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>cbdatarecovery | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/server/current/tools/cbdatarecovery.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.6">
<meta name="page-url" content="/server/current/tools/cbdatarecovery.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="cbdatarecovery.html" selected>7.6</option>
        <option value="7.2" data-url="../../7.2/introduction/intro.html">7.2</option>
        <option value="7.1" data-url="../../7.1/index.html">7.1</option>
        <option value="7.0" data-url="../../7.0/index.html">7.0</option>
        <option value="6.6" data-url="../../6.6/index.html">6.6</option>
        <option value="6.5" data-url="../../6.5/index.html">6.5</option>
        <option value="6.0" data-url="../../6.0/index.html">6.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/backup/docs/modules/tools/pages/cbdatarecovery.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">cbdatarecovery</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Transfers key value data from a Couchbase Server data directory into an active
cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synopsis"><a class="anchor" href="#synopsis"></a>SYNOPSIS</h2>
<div class="sectionbody">
<div class="verseblock">
<pre class="content">cbdatarecovery [--cluster &lt;connection_string&gt;] [--cacert &lt;path&gt;]
               [--username &lt;username&gt;] [--password &lt;password&gt;]
               [--client-cert &lt;path&gt;] [--client-cert-password &lt;password&gt;]
               [--client-key &lt;path&gt;] [--client-key-password &lt;password&gt;]
               [--data-path &lt;path&gt;] [--map-data &lt;mappings&gt;]
               [--vbucket-filter &lt;filter&gt;] [--filter-keys &lt;regex&gt;]
               [--filter-values &lt;regex&gt;] [--replace-ttl &lt;type&gt;]
               [--replace-ttl-with &lt;timestamp&gt;]
               [--include-data &lt;collection_strings&gt;]
               [--exclude-data &lt;collection_strings&gt;]
               [--vbucket-state &lt;state&gt;] [--log-file &lt;path&gt;]
               [--threads &lt;threads&gt;] [--force-updates]
               [--create-missing-collections] [--no-ssl-verify]
               [--verbose] [--no-progress-bar]</pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>cbdatarecovery transfers key value data stored in Couchstore files from a
Couchbase Server data directory into an active cluster. This can be used to
recover data from offline/failed over nodes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="options"><a class="anchor" href="#options"></a>OPTIONS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="required"><a class="anchor" href="#required"></a>Required</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">-c, --cluster &lt;connection_string&gt;</dt>
<dd>
<p>A connection string representing a Couchbase node/cluster which will be the
destination for the recovered data. See the <a href="#HOST_FORMATS">HOST FORMATS</a> section for more
information.</p>
</dd>
<dt class="hdlist1">-u,--username &lt;username&gt;</dt>
<dd>
<p>The username for cluster authentication. The user must have the appropriate
privileges to take a backup.</p>
</dd>
<dt class="hdlist1">-p,--password &lt;password&gt;</dt>
<dd>
<p>The password for cluster authentication. The user must have the appropriate
privileges to take a backup. If not password is supplied to this option then
you will be prompted to enter your password.</p>
</dd>
<dt class="hdlist1">--client-cert &lt;path&gt;</dt>
<dd>
<p>The path to a client certificate used to authenticate when connecting to a
cluster. May be supplied with <code>--client-key</code> as an alternative to the
<code>--username</code> and <code>--password</code> flags.  See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a>
section for more information.</p>
</dd>
<dt class="hdlist1">--client-cert-password &lt;password&gt;</dt>
<dd>
<p>The password for the certificate provided to the <code>--client-cert</code> flag, when
using this flag, the certificate/key pair is expected to be in the PKCS#12
format. See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more information.</p>
</dd>
<dt class="hdlist1">--client-key &lt;path&gt;</dt>
<dd>
<p>The path to the client private key whose public key is contained in the
certificate provided to the <code>--client-cert</code> flag. May be supplied with
<code>--client-cert</code> as an alternative to the <code>--username</code> and <code>--password</code>
flags. See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more information.</p>
</dd>
<dt class="hdlist1">--client-key-password &lt;password&gt;</dt>
<dd>
<p>The password for the key provided to the <code>--client-key</code> flag, when using this
flag, the key is expected to be in the PKCS#8 format.
See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more information.</p>
</dd>
<dt class="hdlist1">-d, --data-path &lt;path&gt;</dt>
<dd>
<p>The path to a Couchbase Server data directory. For example
<code>/opt/couchbase/lib/couchbase/data</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="optional"><a class="anchor" href="#optional"></a>Optional</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">--cacert &lt;path&gt;</dt>
<dd>
<p>Specifies a CA certificate that will be used to verify the identity of the
server being connecting to. Either this flag or the --no-ssl-verify flag
must be specified when using an SSL encrypted connection.</p>
</dd>
<dt class="hdlist1">--map-data &lt;mappings&gt;</dt>
<dd>
<p>Specified when you want to transfer source data into a different location.
For example this argument may be used to remap buckets/scopes/collections
with the restriction that they must be remapped at the same level. For
example a bucket may only be remapped to a bucket, a scope to a scope and a
collection to a collection. The argument expects a comma separated list of
collection string mappings e.g.
<code>bucket1=bucket2,bucket3.scope1=bucket3.scope2,bucket4.scope.collection1=bucket4.scope.collection2</code></p>
</dd>
<dt class="hdlist1">--vbucket-filter &lt;filter&gt;</dt>
<dd>
<p>Specifies a list of vBuckets that should be transferred. vBuckets are
specified as a comma separated list of integers/ranges. For example <code>0,1,2</code>
and <code>0-2</code> represent the same subset of vBuckets. If no filter is provided,
then all vBuckets will be transferred.</p>
</dd>
<dt class="hdlist1">--filter-keys &lt;regex&gt;</dt>
<dd>
<p>Only transfer data where the key matches a particular regular expression.
The regular expressions provided must follow
<a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
</dd>
<dt class="hdlist1">--filter-values &lt;regex&gt;</dt>
<dd>
<p>Only transfer data where the value matches a particular regular expression.
The regular expressions provided must follow
<a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
</dd>
<dt class="hdlist1">--replace-ttl &lt;type&gt;</dt>
<dd>
<p>Sets a new expiration (time-to-live) value for the specified keys. This
parameter can either be set to "none", "all" or "expired" and should be used
along with the --replace-ttl-with flag. If "none" is supplied then the TTL
values are not changed. If "all" is specified then the TTL values for all
keys are replaced with the value of the --replace-ttl-with flag.  If
"expired" is set then only keys which have already expired will have the
TTL&#8217;s replaced.</p>
</dd>
<dt class="hdlist1">--replace-ttl-with &lt;timestamp&gt;</dt>
<dd>
<p>Updates the expiration for the keys specified by the --replace-ttl parameter.
The parameter has to be set when --replace-ttl is set to "all". There are two
options, RFC3339 time stamp format (2006-01-02T15:04:05-07:00) or "0". When
"0" is specified the expiration will be removed. Please note that the RFC3339
value is converted to a Unix time stamp on the cbbackupmgr client. It is
important that the time on both the client and the Couchbase Server are the
same to ensure expiry happens correctly.</p>
</dd>
<dt class="hdlist1">--include-data &lt;collection_strings&gt;</dt>
<dd>
<p>Only transfer data included in this comma list of collection strings. Note
that this flag can&#8217;t be specified at the same time <code>--exclude-data</code>.</p>
</dd>
<dt class="hdlist1">--exclude-data &lt;collection_strings</dt>
<dd>
<p>Don&#8217;t transfer the data for the buckets/scopes/collections in this comma
separated list of collection strings. Note that this flag can&#8217;t be specified
at the same time as <code>--include-data</code>.</p>
</dd>
<dt class="hdlist1">--vbucket-state &lt;state&gt;</dt>
<dd>
<p>Only transfer vBuckets which are in the provided stated. Accepts the values
<code>active</code>, <code>replica</code> or <code>dead</code>.</p>
</dd>
<dt class="hdlist1">--threads &lt;threads&gt;</dt>
<dd>
<p>Specifies the number of concurrent clients to use when transferring data.
Fewer clients means restores will take longer, but there will be less cluster
resources used to complete the restore. More clients means faster restores,
but at the cost of more cluster resource usage. This parameter defaults to 1
if it is not specified and it is recommended that this parameter is not set
to be higher than the number of CPUs on the machine where the restore is
taking place.</p>
</dd>
<dt class="hdlist1">--force-updates</dt>
<dd>
<p>Forces data in the Couchbase cluster to be overwritten even if the data in
the cluster is newer. By default updates are not forced and all updates use
Couchbase&#8217;s conflict resolution mechanism to ensure that if newer data exists
on the cluster that is not overwritten by older restore data.</p>
</dd>
<dt class="hdlist1">--create-missing-collections</dt>
<dd>
<p>Automatically create any scopes/collections which exist in the data directory
on disk but not in the remote cluster. This behavior is disabled by default.</p>
</dd>
<dt class="hdlist1">--no-ssl-verify</dt>
<dd>
<p>Skips the SSL verification phase. Specifying this flag will allow a
connection using SSL encryption, but will not verify the identity of the
server you connect to. You are vulnerable to a man-in-the-middle attack if
you use this flag. Either this flag or the --cacert flag must be specified
when using an SSL encrypted connection.</p>
</dd>
<dt class="hdlist1">--verbose</dt>
<dd>
<p>Increase logging verbosity; useful when debugging. Disabled by default.</p>
</dd>
<dt class="hdlist1">--no-progress-bar</dt>
<dd>
<p>By default, a progress bar is printed to stdout so that the user can see how
long the transfer is expected to take, the amount of data that is being
transferred per second, and the amount of data that has been transferred.
Specifying this flag disables the progress bar and is useful when running
automated jobs.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="HOST_FORMATS"><a class="anchor" href="#HOST_FORMATS"></a>HOST FORMATS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When specifying a host/cluster for a command using the <code>-c</code>/<code>--cluster</code> flag, the following formats
are accepted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>http://&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>https://&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>couchbase://&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>couchbases://&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>couchbase://&lt;srv&gt;</code></p>
</li>
<li>
<p><code>couchbases://&lt;srv&gt;</code></p>
</li>
<li>
<p><code>&lt;addr&gt;:&lt;port&gt;,&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>&lt;scheme&gt;://&lt;addr&gt;:&lt;port&gt;,&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>&lt;port&gt;</code> portion of the host format may be omitted, in which case the default port will be used
for the scheme provided. For example, <code>http://</code> and <code>couchbase://</code> will both default to 8091 where
<code>https://</code> and <code>couchbases://</code> will default to 18091. When connecting to a host/cluster using a
non-default port, the <code>&lt;port&gt;</code> portion of the host format must be specified.</p>
</div>
<div class="sect2">
<h3 id="connection-strings-multiple-nodes"><a class="anchor" href="#connection-strings-multiple-nodes"></a>Connection Strings (Multiple nodes)</h3>
<div class="paragraph">
<p>The <code>-c</code>/<code>--cluster</code> flag accepts multiple nodes in the format of a connection string; this is a
comma separated list of <code>&lt;addr&gt;:&lt;port&gt;</code> strings where <code>&lt;scheme&gt;</code> only needs to be specified once.
The main advantage of supplying multiple hosts is that in the event of a failure, the next host in
the list will be used.</p>
</div>
<div class="paragraph">
<p>For example, all of the following are valid connection strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>localhost,[::1]</code></p>
</li>
<li>
<p><code>10.0.0.1,10.0.0.2</code></p>
</li>
<li>
<p><code>http://10.0.0.1,10.0.0.2</code></p>
</li>
<li>
<p><code>https://10.0.0.1:12345,10.0.0.2</code></p>
</li>
<li>
<p><code>couchbase://10.0.0.1,10.0.0.2</code></p>
</li>
<li>
<p><code>couchbases://10.0.0.1:12345,10.0.0.2:12345</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="srv-records"><a class="anchor" href="#srv-records"></a>SRV Records</h3>
<div class="paragraph">
<p>The <code>-c</code>/<code>--cluster</code> flag accepts DNS SRV records in place of a host/cluster address where the SRV
record will be resolved into a valid connection string. There are a couple of rules which must be
followed when supplying an SRV record which are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>&lt;scheme&gt;</code> portion must be either <code>couchbase://</code> or <code>couchbases://</code></p>
</li>
<li>
<p>The <code>&lt;srv&gt;</code> portion should be a hostname with no port</p>
</li>
<li>
<p>The <code>&lt;srv&gt;</code> portion must not be a valid IP address</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, all of the following are valid connection string using an SRV record:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>couchbase://hostname</code></p>
</li>
<li>
<p><code>couchbases://hostname</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="alternate-addressing-caok8s"><a class="anchor" href="#alternate-addressing-caok8s"></a>Alternate Addressing (CAO/K8S)</h3>
<div class="paragraph">
<p>Users of the CAO (Couchbase Autonomous Operator) or K8S may need to supply the
<code>network=external</code> query parameter to force connection via the defined
alternate addressing.</p>
</div>
<div class="paragraph">
<p>For example, the following are valid connection strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>https://10.0.0.1:12345,10.0.0.2?network=default</code></p>
</li>
<li>
<p><code>https://10.0.0.1:12345,10.0.0.2?network=external</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CERTIFICATE_AUTHENTICATION"><a class="anchor" href="#CERTIFICATE_AUTHENTICATION"></a>CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tool supports authenticating against a Couchbase Cluster by using certificate based authentication (mTLS
authentication). To use certificate based authentication a certificate/key must be supplied, there a currently
multiple ways this may be done.</p>
</div>
<div class="sect2">
<h3 id="pem-encoded-certificatekey"><a class="anchor" href="#pem-encoded-certificatekey"></a>PEM ENCODED CERTIFICATE/KEY</h3>
<div class="paragraph">
<p>An unencrypted PEM encoded certificate/key may be supplied by using:
- <code>--client-cert &lt;path&gt;</code>
- <code>--client-key &lt;path&gt;</code></p>
</div>
<div class="paragraph">
<p>The file passed to <code>--client-cert</code> must contain the client certificate, and an optional chain required to authenticate
the client certificate.</p>
</div>
<div class="paragraph">
<p>The file passed to <code>--client-key</code> must contain at most one private key, the key can be in one of the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PKCS#1</p>
</li>
<li>
<p>PKCS#8</p>
</li>
<li>
<p>EC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently, only the following key types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RSA</p>
</li>
<li>
<p>ECDSA</p>
</li>
<li>
<p>ED25519</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pem-encoded-certificatepem-or-der-encrypted-pkcs8-key"><a class="anchor" href="#pem-encoded-certificatepem-or-der-encrypted-pkcs8-key"></a>PEM ENCODED CERTIFICATE/PEM OR DER ENCRYPTED PKCS#8 KEY</h3>
<div class="paragraph">
<p>An encrypted PKCS#8 formatted key may be provided using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--client-cert &lt;path&gt;</code></p>
</li>
<li>
<p><code>--client-key &lt;path&gt;</code></p>
</li>
<li>
<p><code>--client-key-password &lt;password&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The file passed to <code>--client-cert</code> must contain the client certificate, and an optional chain required to authenticate
the client certificate.</p>
</div>
<div class="paragraph">
<p>Currently, only the following key types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RSA</p>
</li>
<li>
<p>ECDSA</p>
</li>
<li>
<p>ED25519</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="encrypted-pkcs12-certificatekey"><a class="anchor" href="#encrypted-pkcs12-certificatekey"></a>ENCRYPTED PKCS#12 CERTIFICATE/KEY</h3>
<div class="paragraph">
<p>An encrypted PKCS#12 certificate/key may be provided using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--client-cert &lt;path&gt;</code></p>
</li>
<li>
<p><code>--client-cert-password &lt;password&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The file passed to <code>--client-cert</code> must contain the client certificate and exactly one private key. It may also contain
the chain required to authenticate the client certificate.</p>
</div>
<div class="paragraph">
<p>Currently, only the following key types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RSA</p>
</li>
<li>
<p>ECDSA</p>
</li>
<li>
<p>ED25519</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="automatic-collection-creation"><a class="anchor" href="#automatic-collection-creation"></a>AUTOMATIC COLLECTION CREATION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By design, users may not recreate the <code>_default</code> collection once it has been
deleted. Therefore, this means that the <code>_default</code> collection can&#8217;t (and won&#8217;t)
be recreated if it&#8217;s missing. Before performing a transfer, a check will take
place to see if the <code>_default</code> collection will be required when it&#8217;s missing.
If this is the case, the command will exit early and you will be required to
remap the <code>_default</code> collection using the <code>--map-data</code> flag.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="REMAPPING"><a class="anchor" href="#REMAPPING"></a>REMAPPING</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During a transfer, scopes/collections can be remapped from one location to
another. There are several rules that are enforced when remapping
scopes/collections, they are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must be running an Enterprise Edition version of Couchbase Server.</p>
</li>
<li>
<p>You may not remap the <code>_default</code> scope (discussed in THE DEFAULT SCOPE).</p>
</li>
<li>
<p>You may not restore users while remapping scopes/collections, the restoring of
users will be skipped.</p>
</li>
<li>
<p>You may only remap scopes/collections at the same level meaning scopes may
be remapped to other scopes, and collections to other collections, however, a
scope can&#8217;t be remapped to a collection or vice versa.</p>
</li>
<li>
<p>Scopes/collections may only be remapped within the same bucket. For example
the mapping <code>bucket1.scope.collection=bucket2.scope.collection</code> is invalid.</p>
</li>
<li>
<p>Scopes/collections may only be remapped once. For example the mapping
<code>bucket1.scope1=bucket1.scope2,bucket1.scope1=bucket1.scope3</code> is invalid.</p>
</li>
<li>
<p>Remapping may only take place at one level at once meaning that if a parent
bucket/scope is already remapped, the child scopes/collections may not also
be remapped. For example the mapping
<code>bucket1.scope1=bucket1.scope2,bucket1.scope1.collection1=bucket1.scope3.collection9</code>
is invalid.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="remapping-a-scopecollection-without-renaming"><a class="anchor" href="#remapping-a-scopecollection-without-renaming"></a>REMAPPING A SCOPE/COLLECTION WITHOUT RENAMING</h3>
<div class="paragraph">
<p>During a transfer, it&#8217;s possible for a scope/collection to encounter a conflict
(for example, because it has been recreated). It may not be preferable to
rename the scope/collection during the transfer.</p>
</div>
<div class="paragraph">
<p>For this reason, the <code>--map-data</code> flag, allows you to remap a scope/collection
to itself; this indicates that the scope/collection that exists in the target
(with a different id) should be treated as the same.</p>
</div>
<div class="paragraph">
<p>As an example, the following error message indicates that a collection has been
recreated prior to a restore.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Error restoring cluster: collection 8 with name 'collection1' in the scope '_default' exists with a different name/id on the cluster, a manual remap is required</pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>--map-data</code> flag with the argument
<code>bucket._default.collection1=bucket._default.collection1</code> would cause
<code>cbbackupmgr</code> to treat <code>collection1</code> (with id 8) as <code>collection1</code> (with the id
it exists with in the target).</p>
</div>
</div>
<div class="sect2">
<h3 id="the-default-scope"><a class="anchor" href="#the-default-scope"></a>THE DEFAULT SCOPE</h3>
<div class="paragraph">
<p>As mentioned in AUTOMATIC COLLECTION CREATION, it&#8217;s not possible to recreate
the <code>_default</code> scope/collection. This means you can&#8217;t remap the <code>_default</code>
scope because the tool may be unable to create a destination scope/collection.
This may be worked around by remapping each collection inside the <code>_default</code>
scope.</p>
</div>
</div>
<div class="sect2">
<h3 id="bucket-to-collection-remapping"><a class="anchor" href="#bucket-to-collection-remapping"></a>BUCKET TO COLLECTION REMAPPING</h3>
<div class="paragraph">
<p>As discussed in REMAPPING, it&#8217;s not possible to remap data at different levels;
buckets must be remapped to buckets, scopes to scopes and collections to
collections. However, there is one supported edge case, which is remapping a
bucket into a collection to allow migration from a collection unaware to
collection aware datasets.</p>
</div>
<div class="paragraph">
<p>To remap a bucket into a collection using <code>--map-data</code> you may supply
<code>--map-data bucket._default._default=bucket.scope.collection</code>. This
functionality is compatible with cross bucket mapping, for example you may also
supply <code>--map-data bucket1._default._default=bucket2.scope.collection</code>.</p>
</div>
<div class="paragraph">
<p>Note that once you&#8217;ve provided a mapping to remap a bucket into a collection
you may not remap that bucket elsewhere. For example <code>--map-data
bucket1._default._default=bucket2.scope.collection,bucket1=bucket3</code> is invalid.</p>
</div>
</div>
<div class="sect2">
<h3 id="remapping-multiple-data-sources-into-a-single-target-source"><a class="anchor" href="#remapping-multiple-data-sources-into-a-single-target-source"></a>REMAPPING MULTIPLE DATA SOURCES INTO A SINGLE TARGET SOURCE</h3>
<div class="paragraph">
<p>As outlined in the rules discussed in REMAPPING, it&#8217;s not possible to remap a
bucket/scope/collection multiple times, however, it is possible to remap to a
single destination multiple times. For example the mapping
<code>bucket1=dest,bucket2=dest,bucket3=dest</code> is valid.</p>
</div>
<div class="paragraph">
<p>Although valid, this manor of remapping is dangerous and can result in data not
being transferred due to conflicting key spaces. If this style of remapping is
detected a warning will be printed before proceeding.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations-during-major-cluster-configuration-changes"><a class="anchor" href="#operations-during-major-cluster-configuration-changes"></a>OPERATIONS DURING MAJOR CLUSTER CONFIGURATION CHANGES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operations (commands or sub-commands) which connect to a cluster are not
supported during major cluster configuration changes.</p>
</div>
<div class="paragraph">
<p>For example, performing an import/export, making a backup or performing a
restore whilst changing the TLS configuration/security settings is unsupported.</p>
</div>
<div class="paragraph">
<p>These types of changes (e.g. changing the TLS mode to strict) are not expected
to be time consuming so it&#8217;s generally expected that operations should be
started after completing the configuration change.</p>
</div>
<div class="paragraph">
<p>Please note that this does not include rebalances; operations may be performed
during a rebalance. The reason for this distinction, is that major cluster
configuration changes are generally quick, whilst rebalances for large data
sets may be time consuming.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>EXAMPLES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cbdatarecovery tool may be used to recover key value data from a
Couchbase Server data directory. By default, all the active vBuckets for all
the detected buckets will be transferred.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data
Recovering to '172.20.1.1'
Copied all data in 505ms (Avg. 11.06MB/Sec)                                                                               17722 items / 11.06MB
[=====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 11.06MB           | Tue, 23 Feb 2021 11:13:51 +0000/s | Tue, 23 Feb 2021 11:13:52 +0000 | 535ms    |

| Bucket
| ------
| Name        | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| beer-sample | Succeeded | 740.46KB    | 740.46KB/s        | Tue, 23 Feb 2021 11:13:51 +0000 | Tue, 23 Feb 2021 11:13:51 +0000 | 21ms     |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 1836     | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

| Bucket
| ------
| Name           | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| gamesim-sample | Succeeded | 29.82KB     | 29.82KB/s         | Tue, 23 Feb 2021 11:13:51 +0000 | Tue, 23 Feb 2021 11:13:51 +0000 | 3ms      |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 137      | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:13:51 +0000 | Tue, 23 Feb 2021 11:13:52 +0000 | 222ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>To recover only a subset of the available buckets, the <code>--include-data</code> and
<code>--exclude-flags</code> may be used. Note that these flags are mutually exclusive
meaning they can&#8217;t be used at the same time.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data --include-data travel-sample
Recovering to '172.20.1.1'
Copied all data in 273ms (Avg. 10.31MB/Sec)                                                                              15749 items / 10.31MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 10.31MB           | Tue, 23 Feb 2021 11:14:14 +0000/s | Tue, 23 Feb 2021 11:14:15 +0000 | 300ms    |

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:14:14 +0000 | Tue, 23 Feb 2021 11:14:15 +0000 | 189ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data --exclude-data travel-sample
Recovering to '172.20.1.1'
Copied all data in 202ms (Avg. 770.28KB/Sec)                                                                              1973 items / 770.28KB
[=====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 770.28KB          | Tue, 23 Feb 2021 11:26:43 +0000/s | Tue, 23 Feb 2021 11:26:43 +0000 | 227ms

| Bucket
| ------
| Name        | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| beer-sample | Succeeded | 740.46KB    | 740.46KB/s        | Tue, 23 Feb 2021 11:26:43 +0000 | Tue, 23 Feb 2021 11:26:43 +0000 | 26ms     |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 1836     | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

| Bucket
| ------
| Name           | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| gamesim-sample | Succeeded | 29.82KB     | 29.82KB/s         | Tue, 23 Feb 2021 11:26:43 +0000 | Tue, 23 Feb 2021 11:26:43 +0000 | 4ms      |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 137      | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>To recover only a subset of the available vBuckets, the <code>--vbucket-filter</code> flag
may be used. Note that by default all the available vBuckets will be recovered.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data --vbucket-filter 0-128
Recovering to '172.20.1.1'
Copied all data in 199ms (Avg. 5.31MB/Sec)                                                                                 7971 items / 5.31MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 5.31MB            | Tue, 23 Feb 2021 11:28:05 +0000/s | Tue, 23 Feb 2021 11:28:05 +0000 | 227ms

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 5.31MB      | 5.31MB/s          | Tue, 23 Feb 2021 11:28:05 +0000 | Tue, 23 Feb 2021 11:28:05 +0000 | 114ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 7971     | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>When recovering data to a different cluster or a cluster which has changed over
time, it&#8217;s possible for some scopes/collections to have been dropped. This may
cause the recovery to fail because the required scopes/collections no longer
exist. The <code>--auto-create-collections</code> flag can be used to automatically create
any missing scopes/collections.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data --auto-create-collections
Recovering to '172.20.1.1'
Copied all data in 534ms (Avg. 11.06MB/Sec)                                                                               17722 items / 11.06MB
[=====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 11.06MB           | Tue, 23 Feb 2021 11:15:19 +0000/s | Tue, 23 Feb 2021 11:15:20 +0000 | 563ms    |

| Bucket
| ------
| Name        | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| beer-sample | Succeeded | 740.46KB    | 740.46KB/s        | Tue, 23 Feb 2021 11:15:20 +0000 | Tue, 23 Feb 2021 11:15:20 +0000 | 25ms     |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 1836     | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

| Bucket
| ------
| Name           | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| gamesim-sample | Succeeded | 29.82KB     | 29.82KB/s         | Tue, 23 Feb 2021 11:15:20 +0000 | Tue, 23 Feb 2021 11:15:20 +0000 | 3ms      |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 137      | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:15:20 +0000 | Tue, 23 Feb 2021 11:15:20 +0000 | 200ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>To recover only <code>replica</code> vBuckets, the <code>--vbucket-state</code> flag may be used.
This flag accepts either <code>active</code> or <code>replica</code> resulting in the recovery of
only the vBuckets in the provided state. Note that by default only <code>active</code>
vBuckets will be recovered.</p>
</div>
<div class="paragraph">
<p>In the examples below, note the difference in the number of items recovered
when recovering replica vBuckets; this is due to the way active/replica
vBuckets are distributed.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data
Recovering to '172.20.1.1'
Copied all data in 279ms (Avg. 10.31MB/Sec)                                                                              15749 items / 10.31MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 10.31MB           | Tue, 23 Feb 2021 11:17:52 +0000/s | Tue, 23 Feb 2021 11:17:53 +0000 | 306ms

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:17:52 +0000 | Tue, 23 Feb 2021 11:17:53 +0000 | 194ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |

$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data --vbucket-state replica
Recovering to '172.20.1.1'
Copied all data in 188ms (Avg. 10.33MB/Sec)                                                                              15893 items / 10.33MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 10.33MB           | Tue, 23 Feb 2021 11:17:55 +0000/s | Tue, 23 Feb 2021 11:17:55 +0000 | 213ms

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.33MB     | 10.33MB/s         | Tue, 23 Feb 2021 11:17:55 +0000 | Tue, 23 Feb 2021 11:17:55 +0000 | 101ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15893    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>When recovering data to a cluster which has changed over time, it&#8217;s possible
for one or more target scopes/collections to have been recreated. The
<code>--map-data</code> flag can be used to recover data to a scope/collection whose id
has changed (but the name remains the same).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data \
    --map-data travel-sample.inventory=travel-sample.inventory
Recovering to '172.20.1.1'
Copied all data in 290ms (Avg. 10.31MB/Sec)                                                                              15749 items / 10.31MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 10.31MB           | Tue, 23 Feb 2021 11:46:38 +0000/s | Tue, 23 Feb 2021 11:46:38 +0000 | 318ms

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:46:38 +0000 | Tue, 23 Feb 2021 11:46:38 +0000 | 201ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--map-data</code> flag may also be used to remap data from one location to
another, for example to rename a scope/collection. Note the addition of the
<code>--auto-create-collections</code> flag because in this case the scope <code>storage</code> did
not exist.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbdatarecovery -c 172.20.1.1 -u Administrator -p asdasd -d /opt/couchbase/lib/couchbase/data \
    --map-data travel-sample.inventory=travel-sample.storage --auto-create-collections
Recovering to '172.20.1.1'
Copied all data in 401ms (Avg. 10.31MB/Sec)                                                                              15749 items / 10.31MB
[====================================================================================================================================] 100.00%

| Transfer
| --------
| Status    | Avg Transfer Rate | Started At                        | Finished At                     | Duration |
| Succeeded | 10.31MB           | Tue, 23 Feb 2021 11:20:23 +0000/s | Tue, 23 Feb 2021 11:20:23 +0000 | 429ms

| Bucket
| ------
| Name          | Status    | Transferred | Avg Transfer Rate | Started At                      | Finished At                     | Duration |
| travel-sample | Succeeded | 10.31MB     | 10.31MB/s         | Tue, 23 Feb 2021 11:20:23 +0000 | Tue, 23 Feb 2021 11:20:23 +0000 | 227ms    |
|
| Mutations                    | Deletions                    | Expirations                  |
| ---------                    | ---------                    | -----------                  |
| Received | Errored | Skipped | Received | Errored | Skipped | Received | Errored | Skipped |
| 15749    | 0       | 0       | 0        | 0       | 0       | 0        | 0       | 0       |</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="environment-and-configuration-variables"><a class="anchor" href="#environment-and-configuration-variables"></a>ENVIRONMENT AND CONFIGURATION VARIABLES</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">CB_CLUSTER</dt>
<dd>
<p>Specifies the hostname of the Couchbase cluster to connect to. If the
hostname is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_USERNAME</dt>
<dd>
<p>Specifies the username for authentication to a Couchbase cluster. If the
username is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_PASSWORD</dt>
<dd>
<p>Specifies the password for authentication to a Couchbase cluster. If the
password is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_CLIENT_CERT</dt>
<dd>
<p>The path to a client certificate used to authenticate when connecting to a
cluster. May be supplied with <code>CB_CLIENT_KEY</code> as an alternative to the
<code>CB_USERNAME</code> and <code>CB_PASSWORD</code> variables. See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a>
section for more information.</p>
</dd>
<dt class="hdlist1">CB_CLIENT_CERT_PASSWORD</dt>
<dd>
<p>The password for the certificate provided to the <code>CB_CLIENT_CERT</code> variable,
when using this variable, the certificate/key pair is expected to be in the
PKCS#12 format. See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more
information.</p>
</dd>
<dt class="hdlist1">CB_CLIENT_KEY</dt>
<dd>
<p>The path to the client private key whose public key is contained in the
certificate provided to the <code>CB_CLIENT_CERT</code> variable. May be supplied with
<code>CB_CLIENT_CERT</code> as an alternative to the <code>CB_USERNAME</code> and <code>CB_PASSWORD</code>
variables. See the <a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more information.</p>
</dd>
<dt class="hdlist1">CB_CLIENT_KEY_PASSWORD</dt>
<dd>
<p>The password for the key provided to the <code>CB_CLIENT_KEY</code> variable, when using
this variable, the key is expected to be in the PKCS#8 format.  See the
<a href="#CERTIFICATE_AUTHENTICATION">CERTIFICATE AUTHENTICATION (MTLS AUTHENTICATION)</a> section for more information.</p>
</dd>
</dl>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span> 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.6"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
