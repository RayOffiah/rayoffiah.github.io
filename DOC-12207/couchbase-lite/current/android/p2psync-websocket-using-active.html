<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Active Peer | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/couchbase-lite/current/android/p2psync-websocket-using-active.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Lite&#x27;s Peer-to-Peer Synchronization enables edge devices to synchronize securely without consuming centralized cloud-server resources">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="couchbase-lite">
<meta name="dcterms.identifier" content="3.1">
<meta name="page-url" content="/couchbase-lite/current/android/p2psync-websocket-using-active.html">
<meta name="page-nav-header-levels" content="0">

<meta name="docsearch:component" content="couchbase-lite">
<meta name="docsearch:component_title" content="Couchbase Lite">
<meta name="docsearch:cversion" content="3.1">
<meta name="docsearch:component_version" content="couchbase-lite@3.1">
<meta name="docsearch:module" content="android">
<meta name="docsearch:breadcrumbs" content="Couchbase Lite / Android / Data Sync / Peer-to-Peer / Active Peer">
<meta name="docsearch:topic_type" content="">
<meta name="docsearch:version_rank" content="2">
<meta name="docsearch:status" content="">
<meta name="docsearch:edition" content="">
<meta name="docsearch:page_rank" content="50">


<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation"
                      href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">

                  <li class="nav-item "">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                      
                    </a>
                  </li>
                  <li class="nav-item nav-item-selected">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                      
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="couchbase-lite">
        <option value="3.2" data-url="../../3.2/android/p2psync-websocket-using-active.html">3.2 Beta</option>
        <option value="3.1" data-url="p2psync-websocket-using-active.html" selected>3.1</option>
        <option value="3.0" data-url="../../3.0/android/p2psync-websocket-using-active.html">3.0</option>
        <option value="2.8" data-url="../../2.8/android/p2psync-websocket-using-active.html">2.8</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbaselabs/docs-couchbase-lite/edit/release/3.1/modules/android/pages/p2psync-websocket-using-active.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">Couchbase Lite</a></li>
<li class="crumb"><a href="quickstart.html">Android</a></li>
<li class="crumb">Data Sync</li>
<li class="crumb"><a href="p2psync-websocket.html">Peer-to-Peer</a></li>
<li class="crumb"><a href="p2psync-websocket-using-active.html">Active Peer</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Active Peer</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>Description&#8201;&#8212;&#8201;<em>Couchbase Lite&#8217;s Peer-to-Peer Synchronization enables edge devices to synchronize securely without consuming centralized cloud-server resources</em><br>
<em>Abstract&#8201;&#8212;&#8201;How to set up a Replicator to connect with a Listener and replicate changes using peer-to-peer sync</em><br>
Related Content&#8201;&#8212;&#8201;<a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/">API Reference</a>  |  <a href="p2psync-websocket-using-passive.html" class="xref page">Passive Peer</a>  |  <a href="p2psync-websocket-using-active.html" class="xref page">Active Peer</a></p>
</div>
</blockquote>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="title">Android enablers</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allow Unencrypted Network Traffic</dt>
<dd>
<p>To use cleartext, un-encrypted, network traffic (<code>http://</code> and-or <code>ws://</code>),  include <code>android:usesCleartextTraffic="true"</code> in the <code>application</code> element of the manifest as shown on <a href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted" target="_blank" rel="noopener">android.com</a>.<br>
<strong>This not recommended in production</strong>.</p>
</dd>
<dt class="hdlist1">Use Background Threads</dt>
<dd>
<p>As with any network or file I/O activity, CouchbaseLite activities should not be performed on the UI thread.
<strong>Always</strong> use a <strong>background</strong> thread.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Code Snippets</div>
All code examples are indicative only.
They demonstrate the basic concepts and approaches to using a feature.
Use them as inspiration and adapt these examples to best practice when developing applications for your platform.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This content provides sample code and configuration examples covering the implementation of <a href="refer-glossary.html#peer-to-peer-sync" class="xref page">Peer-to-Peer Sync</a> over WebSockets.
Specifically it covers the implementation of an <a href="refer-glossary.html#active-peer" class="xref page">Active Peer</a>.</p>
</div>
<div class="paragraph">
<p>This <em>active peer</em> (also referred to as a client and-or a replicator) will initiate the connection with a <a href="refer-glossary.html#passive-peer" class="xref page">Passive Peer</a> (also referred to as a server and-or listener) and participate in the replication of database changes to bring both databases into sync.</p>
</div>
<div class="paragraph">
<p>Subsequent sections provide additional details and examples for the main configuration options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Secure Storage</div>
The use of TLS, its associated keys and certificates requires using secure storage to minimize the chances of a security breach.
The implementation of this storage differs from platform to platform&#8201;&#8212;&#8201;see <a href="p2psync-websocket.html#using-secure-storage" class="xref page">Using secure storage</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-summary"><a class="anchor" href="#configuration-summary"></a>Configuration Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should configure and initialize a replicator for each Couchbase Lite database instance you want to sync.
<a href="#simple-replication-to-listener">Example 1</a> shows the initialization and configuration process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As with any network or file I/O activity, CouchbaseLite activities should not be performed on the UI thread.
<strong>Always</strong> use a <strong>background</strong> thread.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="simple-replication-to-listener" class="exampleblock">
<div class="title">Example 1. Replication configuration and initialization</div>
<div class="content">
<div id="tabs-1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-1-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-1-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-1-kotlin--panel" class="tabpanel" aria-labelledby="tabs-1-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">    // initialize the replicator configuration
    ReplicatorConfigurationFactory.newConfig(
        target = URLEndpoint(URI("wss://listener.com:8954")), <i class="conum" data-value="1"></i><b>(1)</b>

        collections = mapOf(collections to null),

        // Set replicator type
        type = ReplicatorType.PUSH_AND_PULL,

        // Configure Sync Mode
        continuous = false, // default value



        // Configure Server Authentication --
        // only accept self-signed certs
        acceptOnlySelfSignedServerCertificate = true, <i class="conum" data-value="2"></i><b>(2)</b>


        // Configure the credentials the
        // client will provide if prompted
        authenticator = BasicAuthenticator("PRIVUSER", "let me in".toCharArray())  <i class="conum" data-value="3"></i><b>(3)</b>

    )
)

// Optionally add a change listener <i class="conum" data-value="4"></i><b>(4)</b>
val token = repl.addChangeListener { change -&gt;
    val err: CouchbaseLiteException? = change.status.error
    if (err != null) {
        log("Error code ::  ${err.code}", err)
    }
}

// Start replicator
repl.start(false) <i class="conum" data-value="5"></i><b>(5)</b>


thisReplicator = repl
thisToken = token</code></pre>
</div>
</div>
</div>
<div id="tabs-1-java--panel" class="tabpanel" aria-labelledby="tabs-1-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">    // initialize the replicator configuration
    new ReplicatorConfiguration(new URLEndpoint(new URI("wss://listener.com:8954"))) <i class="conum" data-value="1"></i><b>(1)</b>
        .addCollections(collections, null)

        // Set replicator type
        .setType(ReplicatorType.PUSH_AND_PULL)

        // Configure Sync Mode
        .setContinuous(false) // default value



        // Configure Server Authentication --
        // only accept self-signed certs
        .setAcceptOnlySelfSignedServerCertificate(true) <i class="conum" data-value="2"></i><b>(2)</b>

        // Configure the credentials the
        // client will provide if prompted
        .setAuthenticator(new BasicAuthenticator("Our Username", "Our Password".toCharArray())) <i class="conum" data-value="3"></i><b>(3)</b>

);

// Optionally add a change listener <i class="conum" data-value="4"></i><b>(4)</b>
ListenerToken token = repl.addChangeListener(change -&gt; {
    CouchbaseLiteException err = change.getStatus().getError();
    if (err != null) { Logger.log("Error code :: " + err.getCode(), err); }
});

// Start replicator
repl.start(false); <i class="conum" data-value="5"></i><b>(5)</b>


thisReplicator = repl;
thisToken = token;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure how the client will authenticate the server.
Here we say connect only to servers presenting a self-signed certificate.
By default, clients accept only servers presenting certificates that can be verified using the OS bundled Root CA Certificates&#8201;&#8212;&#8201;see: <a href="#authenticate-listener">Authenticating the Listener</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure the credentials the client will present to the server.
Here we say to provide <em>Basic Authentication</em> credentials. Other options are available&#8201;&#8212;&#8201;see: <a href="#configuring-client-authentication">Example 7</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure how the replication should perform <a href="#conflict-resolution">Conflict Resolution</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Initialize the replicator using your configuration object.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register an observer, which will notify you of changes to the replication status.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Start the replicator.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api-references"><a class="anchor" href="#api-references"></a>API References</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/">Android API References</a> here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="device-discovery"><a class="anchor" href="#device-discovery"></a>Device Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>This phase is optional:</strong> If the listener is initialized on a well known URL endpoint (for example, a static IP Address or well known DNS address) then you can configure Active Peers to connect to those.</p>
</div>
<div class="paragraph">
<p>Prior to connecting with a listener you may execute a Peer discovery phase to dynamically discover Peers.</p>
</div>
<div class="paragraph">
<p>For the Active Peer this involves browsing-for and selecting the appropriate service using a zero-config protocol such as <em>Network Service Discovery</em>&#8201;&#8212;&#8201;see: <a href="https://developer.android.com/training/connect-devices-wirelessly/nsd" class="bare">https://developer.android.com/training/connect-devices-wirelessly/nsd</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-replicator"><a class="anchor" href="#configure-replicator"></a>Configure Replicator</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-cfg-tgt">Configure Target</a>
|  <a href="#lbl-cfg-sync">Sync Mode</a>
|  <a href="#lbl-cfg-retry">Retry Configuration</a>
|  <a href="#authenticate-listener">Authenticating the Listener</a>
|  <a href="#lbl-authclnt">Client Authentication</a></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="lbl-cfg-tgt"><a class="anchor" href="#lbl-cfg-tgt"></a>Configure Target</h3>
<div class="paragraph">
<p>Use the
Initialize and define the replication configuration with local and remote database locations using the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html">ReplicatorConfiguration</a> object.</p>
</div>
<div class="paragraph">
<p>The constructor provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the name of the local database to be sync&#8217;d</p>
</li>
<li>
<p>the server&#8217;s URL (including the port number and the name of the remote database to sync with)</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>It is expected that the app will identify the IP address and URL and append the remote database name to the URL endpoint, producing for example: <code>wss://10.0.2.2:4984/travel-sample</code></p>
</div>
<div class="paragraph">
<p>The URL scheme for web socket URLs uses <code>ws:</code> (non-TLS) or <code>wss:</code> (SSL/TLS) prefixes.
To use cleartext, un-encrypted, network traffic (<code>http://</code> and-or <code>ws://</code>),  include <code>android:usesCleartextTraffic="true"</code> in the <code>application</code> element of the manifest as shown on <a href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted" target="_blank" rel="noopener">android.com</a>.<br>
<strong>This not recommended in production</strong>.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Add Target to Configuration</div>
<div class="content">
<div id="tabs-2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-2-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-2-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-2-kotlin--panel" class="tabpanel" aria-labelledby="tabs-2-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// initialize the replicator configuration
val thisConfig = ReplicatorConfigurationFactory.newConfig(
    target = URLEndpoint(URI("wss://10.0.2.2:8954/travel-sample")), <i class="conum" data-value="1"></i><b>(1)</b>
    collections = mapOf(collections to null)
)</code></pre>
</div>
</div>
</div>
<div id="tabs-2-java--panel" class="tabpanel" aria-labelledby="tabs-2-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// initialize the replicator configuration
ReplicatorConfiguration thisConfig = new ReplicatorConfiguration(
    new URLEndpoint(new URI("wss://10.0.2.2:8954/travel-sample"))) <i class="conum" data-value="1"></i><b>(1)</b>
    .addCollections(collections, null);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note use of the scheme prefix (<code>wss://</code>
to ensure TLS encryption&#8201;&#8212;&#8201;strongly recommended in production&#8201;&#8212;&#8201;or <code>ws://</code>)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-sync"><a class="anchor" href="#lbl-cfg-sync"></a>Sync Mode</h3>
<div class="paragraph">
<p>Here we define the direction and type of replication we want to initiate.</p>
</div>
<div class="paragraph">
<p>We use <code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html">ReplicatorConfiguration</a></code> class&#8217;s <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setReplicatorType-com.couchbase.lite.AbstractReplicatorConfiguration.ReplicatorType-">replicatorType</a> and
<code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setContinuous-boolean-">continuous</a></code> parameters, to tell the replicator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type (or direction) of the replication:
<code><strong>PUSH_AND_PULL</strong></code>; <code>PULL</code>; <code>PUSH</code></p>
</li>
<li>
<p>The replication mode, that is either of:</p>
<div class="ulist">
<ul>
<li>
<p>Continuous&#8201;&#8212;&#8201;remaining active indefinitely to replicate changed documents (<code>continuous=true</code>).</p>
</li>
<li>
<p>Ad-hoc&#8201;&#8212;&#8201;a one-shot replication of changed documents (<code>continuous=false</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="ex-repl-sync" class="exampleblock">
<div class="title">Example 3. Configure replicator type and mode</div>
<div class="content">
<div id="tabs-3" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-3-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-3-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-3-kotlin--panel" class="tabpanel" aria-labelledby="tabs-3-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Set replicator type
type = ReplicatorType.PUSH_AND_PULL,

// Configure Sync Mode
continuous = false, // default value</code></pre>
</div>
</div>
</div>
<div id="tabs-3-java--panel" class="tabpanel" aria-labelledby="tabs-3-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Set replicator type
.setType(ReplicatorType.PUSH_AND_PULL)

// Configure Sync Mode
.setContinuous(false) // default value</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless there is a solid use-case not to, always initiate a single <code>PUSH_AND_PULL</code> replication rather than identical separate <code>PUSH</code> and <code>PULL</code> replications.</p>
</div>
<div class="paragraph">
<p>This prevents the replications generating the same checkpoint <code>docID</code> resulting in multiple conflicts.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="lbl-cfg-retry"><a class="anchor" href="#lbl-cfg-retry"></a>Retry Configuration</h3>
<div class="paragraph">
<p>Couchbase Lite for Android&#8217;s replication retry logic assures a resilient connection.</p>
</div>
<div class="paragraph">
<p>The replicator minimizes the chance and impact of dropped connections by maintaining a heartbeat; essentially pinging the listener at a configurable interval to ensure the connection remains alive.</p>
</div>
<div class="paragraph">
<p>In the event it detects a transient error, the replicator will attempt to reconnect, stopping only when the connection is re-established, or the number of retries exceeds the retry limit (9 times for a single-shot replication and unlimited for a continuous replication).</p>
</div>
<div class="paragraph">
<p>On each retry the interval between attempts is increased exponentially (exponential backoff) up to the maximum wait time limit (5 minutes).</p>
</div>
<div class="paragraph">
<p>The REST API provides configurable control over this replication retry logic using a set of configiurable properties&#8201;&#8212;&#8201;see: <a href="#tbl-repl-retry">Table 1</a>.</p>
</div>
<table id="tbl-repl-retry" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Replication Retry Configuration Properties</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Property</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Use cases</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Description</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setHeartbeat-long-">setHeartbeat()</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Reduce to detect connection errors sooner</p>
</li>
<li>
<p>Align to load-balancer or proxy <code>keep-alive</code> interval&#8201;&#8212;&#8201;see Sync Gateway&#8217;s topic <a href="../../../sync-gateway/current/load-balancer.html#websocket-connection" class="xref page">Load Balancer - Keep Alive</a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval (in seconds) between the heartbeat pulses.</p>
</div>
<div class="paragraph">
<p>Default: The replicator pings the listener every 300 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setMaxAttempts-int-">setMaxAttempts()</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change this to limit or extend the number of retry attempts.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of retry attempts</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set to zero (0) to use default values</p>
</li>
<li>
<p>Set to zero (1) to prevent any retry attempt</p>
</li>
<li>
<p>The retry attempt count is reset when the replicator is able to connect and replicate</p>
</li>
<li>
<p>Default values are:</p>
<div class="ulist">
<ul>
<li>
<p>Single-shot replication = 9;</p>
</li>
<li>
<p>Continuous replication = maximum integer value</p>
</li>
</ul>
</div>
</li>
<li>
<p>Negative values generate a Couchbase exception <code>InvalidArgumentException</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setMaxAttemptWaitTime-long-">setMaxAttemptWaitTime()</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change this to adjust the interval between retries.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum interval between retry attempts</p>
</div>
<div class="paragraph">
<p>While you can configure the <strong>maximum permitted</strong> wait time,  the replicator&#8217;s exponential backoff algorithm calculates each individual interval which is not configurable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default value: 300 seconds (5 minutes)</p>
</li>
<li>
<p>Zero sets the maximum interval between retries to the default of 300 seconds</p>
</li>
<li>
<p>300 sets the maximum interval between retries to the default of 300 seconds</p>
</li>
<li>
<p>A negative value generates a Couchbase exception, <code>InvalidArgumentException</code></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When necessary you can adjust any or all of those configurable values&#8201;&#8212;&#8201;see: <a href="#ex-repl-retry">Example 4</a> for how to do this.</p>
</div>
<div id="ex-repl-retry" class="exampleblock">
<div class="title">Example 4. Configuring Replication Retries</div>
<div class="content">
<div class="paragraph">
<p></p>
</div>
<div id="tabs-4" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-4-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-4-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-4-kotlin--panel" class="tabpanel" aria-labelledby="tabs-4-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">val repl = Replicator(
    ReplicatorConfigurationFactory.newConfig(
        target = URLEndpoint(URI("ws://localhost:4984/mydatabase")),
        collections = mapOf(collections to null),
        //  other config params as required . .
        heartbeat = 150, <i class="conum" data-value="1"></i><b>(1)</b>
        maxAttempts = 20,
        maxAttemptWaitTime = 600
    )
)
repl.start()
thisReplicator = repl</code></pre>
</div>
</div>
</div>
<div id="tabs-4-java--panel" class="tabpanel" aria-labelledby="tabs-4-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">Replicator repl = new Replicator(
    new ReplicatorConfiguration(new URLEndpoint(new URI("ws://localhost:4984/mydatabase")))
        .addCollections(collections, null)
        //  other config as required . . .
        .setHeartbeat(150) <i class="conum" data-value="1"></i><b>(1)</b>
        .setMaxAttempts(20) <i class="conum" data-value="2"></i><b>(2)</b>
        .setMaxAttemptWaitTime(600)); <i class="conum" data-value="3"></i><b>(3)</b>

repl.start();
thisReplicator = repl;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we use <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setHeartbeat-long-">setHeartbeat()</a> to set the required interval (in seconds) between the heartbeat pulses</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we use <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setMaxAttempts-int-">setMaxAttempts()</a> to set the required number of retry attempts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here we use <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicatorConfiguration.html#setMaxAttemptWaitTime-long-">setMaxAttemptWaitTime()</a> to set the required interval between retry attempts.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="authenticate-listener"><a class="anchor" href="#authenticate-listener"></a>Authenticating the Listener</h3>
<div class="paragraph">
<p>Define the credentials the your app (the client) is expecting to receive from the server (listener) in order to ensure that the server is one it is prepared to interact with.</p>
</div>
<div class="paragraph">
<p>Note that the client cannot authenticate the server if TLS is turned off.
When TLS is enabled (Sync Gateway&#8217;s default) the client <em>must</em> authenticate the server.
If the server cannot provide acceptable credentials then the connection will fail.</p>
</div>
<div class="paragraph">
<p>Use <code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html">ReplicatorConfiguration</a></code> properties <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setAcceptOnlySelfSignedServerCertificate-boolean-">setAcceptOnlySelfSignedServerCertificate</a> and <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setPinnedServerCertificate-byte:A-">setPinnedServerCertificate</a>, to tell the replicator how to verify server-supplied TLS server certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a pinned certificate, nothing else matters, the server cert must <strong>exactly</strong> match the pinned certificate.</p>
</li>
<li>
<p>If there are no pinned certs and <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setAcceptOnlySelfSignedServerCertificate-boolean-">setAcceptOnlySelfSignedServerCertificate</a> is <code>true</code> then any self-signed certificate is accepted.  Certificates that are not self signed are rejected, no matter who signed them.</p>
</li>
<li>
<p>If there are no pinned certificates and <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setAcceptOnlySelfSignedServerCertificate-boolean-">setAcceptOnlySelfSignedServerCertificate</a> is <code>false</code> (default), the client validates the server’s certificates against the system CA certificates.  The server must supply a chain of certificates whose root is signed by one of the certificates in the system CA bundle.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 5. Set Server TLS security</div>
<div class="content">
<div id="tabs-5" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-5-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-5-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-5-kotlin--panel" class="tabpanel" aria-labelledby="tabs-5-kotlin">
<div id="tabs-6" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-6-ca-cert" class="tab">
<p>CA Cert</p>
</li>
<li id="tabs-6-self-signed-cert" class="tab">
<p>Self Signed Cert</p>
</li>
<li id="tabs-6-pinned-certificate" class="tab">
<p>Pinned Certificate</p>
</li>
</ul>
</div>
<div id="tabs-6-ca-cert--panel" class="tabpanel" aria-labelledby="tabs-6-ca-cert">
<div class="paragraph">
<p>Set the client to expect and accept only CA attested certificates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Configure Server Security
// -- only accept CA attested certs
acceptOnlySelfSignedServerCertificate = false, <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the default.
Only certificate chains with roots signed by a trusted CA are allowed.
Self signed certificates are not allowed.</td>
</tr>
</table>
</div>
</div>
<div id="tabs-6-self-signed-cert--panel" class="tabpanel" aria-labelledby="tabs-6-self-signed-cert">
<div class="paragraph">
<p>Set the client to expect and accept only self-signed certificates</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Configure Server Authentication --
// only accept self-signed certs
acceptOnlySelfSignedServerCertificate = true, <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set this to <code>true</code> to accept any self signed cert.
Any certificates that are not self-signed are rejected.</td>
</tr>
</table>
</div>
</div>
<div id="tabs-6-pinned-certificate--panel" class="tabpanel" aria-labelledby="tabs-6-pinned-certificate">
<div class="paragraph">
<p>Set the client to expect and accept only a pinned certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt#L2891-L2894">// Use the pinned certificate from the byte array (cert)
pinnedServerCertificate =
TLSIdentity.getIdentity("Our Corporate Id")?.certs?.get(0) as? X509Certificate <i class="conum" data-value="1"></i><b>(1)</b>
    ?: throw IllegalStateException("Cannot find corporate id"),</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure the pinned certificate using data from the byte array <code>cert</code></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="tabs-5-java--panel" class="tabpanel" aria-labelledby="tabs-5-java">
<div id="tabs-7" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-7-ca-cert" class="tab">
<p>CA Cert</p>
</li>
<li id="tabs-7-self-signed-cert" class="tab">
<p>Self Signed Cert</p>
</li>
<li id="tabs-7-pinned-certificate" class="tab">
<p>Pinned Certificate</p>
</li>
</ul>
</div>
<div id="tabs-7-ca-cert--panel" class="tabpanel" aria-labelledby="tabs-7-ca-cert">
<div class="paragraph">
<p>Set the client to expect and accept only CA attested certificates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Configure Server Security
// -- only accept CA attested certs
.setAcceptOnlySelfSignedServerCertificate(false); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the default.
Only certificate chains with roots signed by a trusted CA are allowed.
Self signed certificates are not allowed.</td>
</tr>
</table>
</div>
</div>
<div id="tabs-7-self-signed-cert--panel" class="tabpanel" aria-labelledby="tabs-7-self-signed-cert">
<div class="paragraph">
<p>Set the client to expect and accept only self-signed certificates</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Configure Server Authentication --
// only accept self-signed certs
.setAcceptOnlySelfSignedServerCertificate(true) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set this to <code>true</code> to accept any self signed cert.
Any certificates that are not self-signed are rejected.</td>
</tr>
</table>
</div>
</div>
<div id="tabs-7-pinned-certificate--panel" class="tabpanel" aria-labelledby="tabs-7-pinned-certificate">
<div class="paragraph">
<p>Set the client to expect and accept only a pinned certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">// Use the pinned certificate from the byte array (cert)

TLSIdentity identity = TLSIdentity.getIdentity("OurCorp");
if (identity == null) { throw new IllegalStateException("Cannot find corporate id"); }
config.setPinnedServerX509Certificate((X509Certificate) identity.getCerts().get(0)); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-authclnt"><a class="anchor" href="#lbl-authclnt"></a>Client Authentication</h3>
<div class="paragraph">
<p>Here we define the credentials that the client can present to the server if prompted to do so in order that the server can authenticate it.</p>
</div>
<div class="paragraph">
<p>We use <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html">ReplicatorConfiguration</a>'s <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setAuthenticator-com.couchbase.lite.Authenticator-">setAuthenticator</a> method to define the authentication method to the replicator.</p>
</div>
<div class="sect3">
<h4 id="basic-authentication"><a class="anchor" href="#basic-authentication"></a>Basic Authentication</h4>
<div class="paragraph">
<p>Use the <code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/BasicAuthenticator.html">BasicAuthenticator</a></code> to supply basic authentication credentials (username and word).</p>
</div>
<div id="basic-authentication" class="exampleblock">
<div class="title">Example 6. Basic Authentication</div>
<div class="content">
<div class="paragraph">
<p>This example shows basic authentication using user name and password:</p>
</div>
<div id="tabs-8" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-8-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-8-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-8-kotlin--panel" class="tabpanel" aria-labelledby="tabs-8-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Configure the credentials the
// client will provide if prompted
authenticator = BasicAuthenticator("PRIVUSER", "let me in".toCharArray())  <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
<div id="tabs-8-java--panel" class="tabpanel" aria-labelledby="tabs-8-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Configure the credentials the
// client will provide if prompted
.setAuthenticator(new BasicAuthenticator("Our Username", "Our Password".toCharArray())) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="certificate-authentication"><a class="anchor" href="#certificate-authentication"></a>Certificate Authentication</h4>
<div class="paragraph">
<p>Use the <code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ClientCertificateAuthenticator.html">ClientCertificateAuthenticator</a></code> to configure the client TLS certificates to be presented to the server, on connection.
This applies only to the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/URLEndpointListener.html">URLEndpointListener</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>server</strong> (listener) must have <code>disableTLS</code> set <code>false</code> and have a <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ClientCertificateAuthenticator.html">ClientCertificateAuthenticator</a> configured, or it will never ask for this client&#8217;s certificate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The certificate to be presented to the server will need to be signed by the root certificates or be valid based on the authentication callback set to the listener via ListenerCertificateAuthenticator.</p>
</div>
<div class="paragraph">
<p>TLSIdentity.getIdentity uses the Android keystore.  Please see (Android developers documentation (for example <a href="https://developer.android.com/training/articles/keystore" class="bare">https://developer.android.com/training/articles/keystore</a>) for more information about how to import a keychain.</p>
</div>
<div id="configuring-client-authentication" class="exampleblock">
<div class="title">Example 7. Client Cert Authentication</div>
<div class="content">
<div class="paragraph">
<p>This example shows client certificate authentication using an identity from secure storage.</p>
</div>
<div id="tabs-9" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-9-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-9-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-9-kotlin--panel" class="tabpanel" aria-labelledby="tabs-9-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">        // Provide a client certificate to the server for authentication
        authenticator = ClientCertificateAuthenticator(
            TLSIdentity.getIdentity("clientId")
                ?: throw IllegalStateException("Cannot find client id")
        ) <i class="conum" data-value="1"></i><b>(1)</b>

        // ... other replicator configuration
    )
)

thisReplicator = repl</code></pre>
</div>
</div>
</div>
<div id="tabs-9-java--panel" class="tabpanel" aria-labelledby="tabs-9-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Provide a client certificate to the server for authentication
TLSIdentity clientId = TLSIdentity.getIdentity("client");
if (clientId == null) { throw new IllegalStateException("Cannot find client id"); }
config.setAuthenticator(new ClientCertificateAuthenticator(clientId)); <i class="conum" data-value="1"></i><b>(1)</b>

// ... other replicator configuration

Replicator repl = new Replicator(config);
repl.start();
thisReplicator = repl;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get an identity from secure storage and create a TLS Identity object</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the authenticator to <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ClientCertificateAuthenticator.html">ClientCertificateAuthenticator</a> and configure it to use the retrieved identity</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="initialize-replicator"><a class="anchor" href="#initialize-replicator"></a>Initialize Replicator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <code><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/Replicator.html">Replicator</a></code> class&#8217;s <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/Replicator.html#Replicator-com.couchbase.lite.ReplicatorConfiguration-">ReplicatorConfiguration(config)</a> constructor, to initialize the replicator with the configuration you have defined.
You can, optionally, add a change listener (see <a href="#lbl-repl-mon">Monitor Sync</a>) before starting the replicator running using <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#start-boolean-">start()</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Initialize and run replicator</div>
<div class="content">
<div id="tabs-10" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-10-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-10-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-10-kotlin--panel" class="tabpanel" aria-labelledby="tabs-10-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Create replicator
// Consider holding a reference somewhere
// to prevent the Replicator from being GCed
val repl = Replicator( <i class="conum" data-value="1"></i><b>(1)</b>

    // initialize the replicator configuration
    ReplicatorConfigurationFactory.newConfig(
        target = URLEndpoint(URI("wss://listener.com:8954")), <i class="conum" data-value="2"></i><b>(2)</b>

        collections = mapOf(collections to null),

        // Set replicator type
        type = ReplicatorType.PUSH_AND_PULL,

        // Configure Sync Mode
        continuous = false, // default value


        // set auto-purge behavior
        // (here we override default)
        enableAutoPurge = false, <i class="conum" data-value="3"></i><b>(3)</b>


        // Configure Server Authentication --
        // only accept self-signed certs
        acceptOnlySelfSignedServerCertificate = true, <i class="conum" data-value="4"></i><b>(4)</b>


        // Configure the credentials the
        // client will provide if prompted
        authenticator = BasicAuthenticator("PRIVUSER", "let me in".toCharArray())  <i class="conum" data-value="5"></i><b>(5)</b>

    )
)

// Start replicator
repl.start(false) <i class="conum" data-value="6"></i><b>(6)</b>


thisReplicator = repl
thisToken = token</code></pre>
</div>
</div>
</div>
<div id="tabs-10-java--panel" class="tabpanel" aria-labelledby="tabs-10-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Create replicator
// Consider holding a reference somewhere
// to prevent the Replicator from being GCed
Replicator repl = new Replicator( <i class="conum" data-value="1"></i><b>(1)</b>

    // initialize the replicator configuration
    new ReplicatorConfiguration(new URLEndpoint(new URI("wss://listener.com:8954"))) <i class="conum" data-value="2"></i><b>(2)</b>
        .addCollections(collections, null)

        // Set replicator type
        .setType(ReplicatorType.PUSH_AND_PULL)

        // Configure Sync Mode
        .setContinuous(false) // default value


        // set auto-purge behavior
        // (here we override default)
        .setAutoPurgeEnabled(false) <i class="conum" data-value="3"></i><b>(3)</b>


        // Configure Server Authentication --
        // only accept self-signed certs
        .setAcceptOnlySelfSignedServerCertificate(true) <i class="conum" data-value="4"></i><b>(4)</b>

        // Configure the credentials the
        // client will provide if prompted
        .setAuthenticator(new BasicAuthenticator("Our Username", "Our Password".toCharArray())) <i class="conum" data-value="5"></i><b>(5)</b>

);

// Start replicator
repl.start(false); <i class="conum" data-value="6"></i><b>(6)</b>


thisReplicator = repl;
thisToken = token;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize the replicator with the configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the replicator</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-mon"><a class="anchor" href="#lbl-repl-mon"></a>Monitor Sync</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">In this section</dt>
<dd>
<p><a href="#lbl-repl-chng">Change Listeners</a>  |
<a href="#lbl-repl-status">Replicator Status</a>  |
<a href="#lbl-repl-pend">Documents Pending Push</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can monitor a replication’s status by using a combination of <a href="#lbl-repl-chng">Change Listeners</a> and the <code>replication.status.activity</code> property&#8201;&#8212;&#8201;see; <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorStatus.html#getActivityLevel()">getActivityLevel()</a>.
This enables you to know, for example, when the replication is actively transferring data and when it has stopped.</p>
</div>
<div class="sect2">
<h3 id="lbl-repl-chng"><a class="anchor" href="#lbl-repl-chng"></a>Change Listeners</h3>
<div class="paragraph">
<p>Use this to monitor changes and to inform on sync progress; this is an optional step.
You can add and a replicator change listener at any point; it will report changes from the point it is registered.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Best Practice</div>
Don&#8217;t forget to save the token so you can remove the listener later
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/Replicator.html">Replicator</a> class to add a change listener as a callback to the Replicator (<a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#addChangeListener-java.util.concurrent.Executor-com.couchbase.lite.ReplicatorChangeListener-">addChangeListener()</a>)&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 9</a>.
You will then be asynchronously notified of state changes.</p>
</div>
<div class="paragraph">
<p>You can remove a change listener with <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#removeChangeListener-com.couchbase.lite.ListenerToken-">removeChangeListener(ListenerToken token)</a>.</p>
</div>
<div class="sect3">
<h4 id="using-kotlin-flows-and-livedata"><a class="anchor" href="#using-kotlin-flows-and-livedata"></a>Using Kotlin Flows and LiveData</h4>
<div class="paragraph">
<p>Android Kotlin developers can take advantage of Flows and LiveData to monitor replicators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">Unresolved include directive in modules/ROOT/pages/_partials/commons/common-sgw-replication-monitor.adoc - include::android:example$snippets/app/src/main/kotlin/com/couchbase/code_snippets/FlowExamples.kt[]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-status"><a class="anchor" href="#lbl-repl-status"></a>Replicator Status</h3>
<div class="paragraph">
<p>You can use the
<a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorStatus.html">ReplicatorStatus()</a> class
to check the replicator status.
That is, whether it is actively transferring data or if it has stopped&#8201;&#8212;&#8201;see: <a href="#ex-repl-mon">Example 9</a>.</p>
</div>
<div class="paragraph">
<p>The returned <em>ReplicationStatus</em> structure comprises:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorStatus.html#getActivityLevel()">getActivityLevel()</a>&#8201;&#8212;&#8201;stopped, offline, connecting, idle or busy&#8201;&#8212;&#8201;see states described in: <a href="#tbl-states">Table 2</a></p>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorStatus.html#getProgress()">getProgress()</a></p>
<div class="ulist">
<ul>
<li>
<p>completed&#8201;&#8212;&#8201;the total number of changes completed</p>
</li>
<li>
<p>total&#8201;&#8212;&#8201;the total number of changes to be processed</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorStatus.html#getError">getError()</a>&#8201;&#8212;&#8201;the current error, if any</p>
</li>
</ul>
</div>
<div id="ex-repl-mon" class="exampleblock">
<div class="title">Example 9. Monitor replication</div>
<div class="content">
<div id="tabs-11" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-11-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-11-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-11-kotlin--panel" class="tabpanel" aria-labelledby="tabs-11-kotlin">
<div id="tabs-12" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-12-adding-a-change-listener" class="tab">
<p>Adding a Change Listener</p>
</li>
<li id="tabs-12-using-replicator-status" class="tab">
<p>Using replicator.status</p>
</li>
</ul>
</div>
<div id="tabs-12-adding-a-change-listener--panel" class="tabpanel" aria-labelledby="tabs-12-adding-a-change-listener">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">val token = repl.addChangeListener { change -&gt;
    val err: CouchbaseLiteException? = change.status.error
    if (err != null) {
        log("Error code ::  ${err.code}", err)
    }
}</code></pre>
</div>
</div>
</div>
<div id="tabs-12-using-replicator-status--panel" class="tabpanel" aria-labelledby="tabs-12-using-replicator-status">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">repl.status.let {
    val progress = it.progress
    log(
        "The Replicator is ${
            it.activityLevel
        } and has processed ${
            progress.completed
        } of ${progress.total} changes"
    )
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabs-11-java--panel" class="tabpanel" aria-labelledby="tabs-11-java">
<div id="tabs-13" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-13-adding-a-change-listener" class="tab">
<p>Adding a Change Listener</p>
</li>
<li id="tabs-13-using-replicator-status" class="tab">
<p>Using replicator.status</p>
</li>
</ul>
</div>
<div id="tabs-13-adding-a-change-listener--panel" class="tabpanel" aria-labelledby="tabs-13-adding-a-change-listener">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">ListenerToken token = repl.addChangeListener(change -&gt; {
    CouchbaseLiteException err = change.getStatus().getError();
    if (err != null) { Logger.log("Error code :: " + err.getCode(), err); }
});</code></pre>
</div>
</div>
</div>
<div id="tabs-13-using-replicator-status--panel" class="tabpanel" aria-labelledby="tabs-13-using-replicator-status">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">    ReplicatorStatus status = repl.getStatus();
    ReplicatorProgress progress = status.getProgress();
    Logger.log(
        "The Replicator is " + status.getActivityLevel()
            + "and has processed " + progress.getCompleted()
            + " of " + progress.getTotal() + " changes");
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="lbl-repl-states"><a class="anchor" href="#lbl-repl-states"></a>Replication States</h4>
<div class="paragraph">
<p><a href="#tbl-states">Table 2</a> shows the different states, or activity levels, reported in the API; and the meaning of each.</p>
</div>
<table id="tbl-states" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Replicator activity levels</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">State</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">Meaning</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is finished or hit a fatal error.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>OFFLINE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is offline as the remote host is unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CONNECTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replicator is connecting to the remote host.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication caught up with all the changes available from the server.
The <code>IDLE</code> state is only used in continuous replications.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BUSY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The replication is actively transferring data.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The replication change object also has properties to track the progress (<code>change.status.completed</code> and <code>change.status.total</code>).
Since the replication occurs in batches the total count can vary through the course of a replication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="replication-status-and-app-life-cycle"><a class="anchor" href="#replication-status-and-app-life-cycle"></a>Replication Status and App Life Cycle</h4>
<div class="paragraph">
<p>Couchbase Lite replications will continue running until the app terminates, unless the remote system, or the application, terminates the connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Recall that the Android OS may kill an application without warning.
You should explicitly stop replication processes when they are no longer useful (for example, when they are <code>suspended</code> or <code>idle</code>) to avoid socket connections being closed by the OS, which may interfere with the replication process.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lbl-repl-pend"><a class="anchor" href="#lbl-repl-pend"></a>Documents Pending Push</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#isDocumentPending-java.lang.String-">Replicator.isDocumentPending()</a> is quicker and more efficient.
Use it in preference to returning a list of pending document IDs, where possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can check whether documents are waiting to be pushed in any forthcoming sync by using either of the following API methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#getPendingDocumentIds--">Replicator.getPendingDocumentIds()</a> method, which returns a list of document IDs that have local changes, but which have not yet been pushed to the server.</p>
<div class="paragraph">
<p>This can be very useful in tracking the progress of a push sync, enabling the app to provide a visual indicator to the end user on its status, or decide when it is safe to exit.</p>
</div>
</li>
<li>
<p>Use the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#isDocumentPending-java.lang.String-">Replicator.isDocumentPending()</a> method to quickly check whether an individual document is pending a push.</p>
</li>
</ul>
</div>
<div id="ex-pending" class="exampleblock">
<div class="title">Example 10. Use Pending Document ID API</div>
<div class="content">
<div id="tabs-14" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-14-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-14-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-14-kotlin--panel" class="tabpanel" aria-labelledby="tabs-14-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">val repl = Replicator(
    ReplicatorConfigurationFactory.newConfig(
        target = URLEndpoint(URI("ws://localhost:4984/mydatabase")),
        collections = mapOf(setOf(collection) to null),
        type = ReplicatorType.PUSH
    )
)

val pendingDocs = repl.getPendingDocumentIds(collection)

// iterate and report on previously
// retrieved pending docids 'list'
if (pendingDocs.isNotEmpty()) {
    log("There are ${pendingDocs.size} documents pending")

    val firstDoc = pendingDocs.first()
    repl.addChangeListener { change -&gt;
        log("Replicator activity level is ${change.status.activityLevel}")
        try {
            if (!repl.isDocumentPending(firstDoc, collection)) {
                log("Doc ID ${firstDoc} has been pushed")
            }
        } catch (err: CouchbaseLiteException) {
            log("Failed getting pending docs", err)
        }
    }

    repl.start()
    thisReplicator = repl
}</code></pre>
</div>
</div>
</div>
<div id="tabs-14-java--panel" class="tabpanel" aria-labelledby="tabs-14-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">Replicator repl = new Replicator(
    new ReplicatorConfiguration(new URLEndpoint(new URI("ws://localhost:4984/mydatabase")))
        .addCollection(collection, null)
        .setType(ReplicatorType.PUSH));

Set&lt;String&gt; pendingDocs = repl.getPendingDocumentIds(collection);

if (!pendingDocs.isEmpty()) {
    Logger.log("There are " + pendingDocs.size() + " documents pending");

    final String firstDoc = pendingDocs.iterator().next();

    repl.addChangeListener(change -&gt; {
        Logger.log("Replicator activity level is " + change.getStatus().getActivityLevel());
        try {
            if (!repl.isDocumentPending(firstDoc, collection)) {
                Logger.log("Doc ID " + firstDoc + " has been pushed");
            }
        }
        catch (CouchbaseLiteException err) {
            Logger.log("Failed getting pending docs", err);
        }
    });

    repl.start();
    this.thisReplicator = repl;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#getPendingDocumentIds--">Replicator.getPendingDocumentIds()</a> returns a list of the document IDs for all documents waiting to be pushed.
This is a snapshot and may have changed by the time the response is received and processed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#isDocumentPending-java.lang.String-">Replicator.isDocumentPending()</a> returns <code>true</code> if the document is waiting to be pushed, and <code>false</code> otherwise.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lbl-repl-stop"><a class="anchor" href="#lbl-repl-stop"></a>Stop Sync</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stopping a replication is straightforward.
It is done using <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#stop--">stop()</a>.
This initiates an asynchronous operation and so is not necessarily immediate.
Your app should account for this potential delay before attempting any subsequent operations.</p>
</div>
<div class="paragraph">
<p>You can find further information on database operations in <a href="database.html" class="xref page">Databases</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 11. Stop replicator</div>
<div class="content">
<div id="tabs-15" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-15-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-15-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-15-kotlin--panel" class="tabpanel" aria-labelledby="tabs-15-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">// Stop replication.
repl.stop() <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
<div id="tabs-15-java--panel" class="tabpanel" aria-labelledby="tabs-15-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">// Stop replication.
repl.stop(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we initiate the stopping of the replication using the <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/AbstractReplicator.html#stop--">stop()</a> method.
It will stop any active <a href="#lbl-repl-chng">change listener</a> once the replication is stopped.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conflict-resolution"><a class="anchor" href="#conflict-resolution"></a>Conflict Resolution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unless you specify otherwise, Couchbase Lite&#8217;s default conflict resolution policy is applied&#8201;&#8212;&#8201;see <a href="conflict.html" class="xref page">Handling Data Conflicts</a>.</p>
</div>
<div class="paragraph">
<p>To use a different policy, specify a <em>conflict resolver</em> using <a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/com/couchbase/lite/ReplicatorConfiguration.html#setConflictResolver-com.couchbase.lite.ConflictResolver-">conflictResolver</a> as shown in <a href="#using-conflict-resolvers">Example 12</a>.</p>
</div>
<div class="paragraph">
<p>For more complex solutions you can provide a custom conflict resolver - see: <a href="conflict.html" class="xref page">Handling Data Conflicts</a>.</p>
</div>
<div id="using-conflict-resolvers" class="exampleblock">
<div class="title">Example 12. Using conflict resolvers</div>
<div class="content">
<div id="tabs-16" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-16-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-16-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-16-kotlin--panel" class="tabpanel" aria-labelledby="tabs-16-kotlin">
<div id="tabs-17" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-17-local-wins" class="tab">
<p>Local Wins</p>
</li>
<li id="tabs-17-remote-wins" class="tab">
<p>Remote Wins</p>
</li>
<li id="tabs-17-merge" class="tab">
<p>Merge</p>
</li>
</ul>
</div>
<div id="tabs-17-local-wins--panel" class="tabpanel" aria-labelledby="tabs-17-local-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">// Using replConfig.setConflictResolver(new LocalWinConflictResolver());
@Suppress("unused")
object LocalWinsResolver : ConflictResolver {
    override fun resolve(conflict: Conflict) = conflict.localDocument
}</code></pre>
</div>
</div>
</div>
<div id="tabs-17-remote-wins--panel" class="tabpanel" aria-labelledby="tabs-17-remote-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">// Using replConfig.setConflictResolver(new RemoteWinConflictResolver());
@Suppress("unused")
object RemoteWinsResolver : ConflictResolver {
    override fun resolve(conflict: Conflict) = conflict.remoteDocument
}</code></pre>
</div>
</div>
</div>
<div id="tabs-17-merge--panel" class="tabpanel" aria-labelledby="tabs-17-merge">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin">// Using replConfig.setConflictResolver(new MergeConflictResolver());
@Suppress("unused")
object MergeConflictResolver : ConflictResolver {
    override fun resolve(conflict: Conflict): Document {
        val localDoc = conflict.localDocument?.toMap()
        val remoteDoc = conflict.remoteDocument?.toMap()

        val merge: MutableMap&lt;String, Any&gt;?
        if (localDoc == null) {
            merge = remoteDoc
        } else {
            merge = localDoc
            if (remoteDoc != null) {
                merge.putAll(remoteDoc)
            }
        }

        return if (merge == null) {
            MutableDocument(conflict.documentId)
        } else {
            MutableDocument(conflict.documentId, merge)
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabs-16-java--panel" class="tabpanel" aria-labelledby="tabs-16-java">
<div id="tabs-18" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-18-local-wins" class="tab">
<p>Local Wins</p>
</li>
<li id="tabs-18-remote-wins" class="tab">
<p>Remote Wins</p>
</li>
<li id="tabs-18-merge" class="tab">
<p>Merge</p>
</li>
</ul>
</div>
<div id="tabs-18-local-wins--panel" class="tabpanel" aria-labelledby="tabs-18-local-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java#L967-L971">class LocalWinConflictResolver implements ConflictResolver {
    public Document resolve(Conflict conflict) {
        return conflict.getLocalDocument();
    }
}</code></pre>
</div>
</div>
</div>
<div id="tabs-18-remote-wins--panel" class="tabpanel" aria-labelledby="tabs-18-remote-wins">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt#L1417-L1421">// Using replConfig.setConflictResolver(new RemoteWinConflictResolver());
@Suppress("unused")
object RemoteWinsResolver : ConflictResolver {
    override fun resolve(conflict: Conflict) = conflict.remoteDocument
}</code></pre>
</div>
</div>
</div>
<div id="tabs-18-merge--panel" class="tabpanel" aria-labelledby="tabs-18-merge">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java#L985-L991">class MergeConflictResolver implements ConflictResolver {
    public Document resolve(Conflict conflict) {
        Map&lt;String, Object&gt; merge = conflict.getLocalDocument().toMap();
        merge.putAll(conflict.getRemoteDocument().toMap());
        return new MutableDocument(conflict.getDocumentId(), merge);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Just as a replicator may observe a conflict&#8201;&#8212;&#8201;when updating a document that has changed both in the local database and in a remote database&#8201;&#8212;&#8201;any attempt to save a document may also observe a conflict, if a replication has taken place since the local app retrieved the document from the database.
To address that possibility, a version of the <code>Database.save()</code> method also takes a conflict resolver as shown in <a href="#ex-merge-props">Example 13</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows an example of merging properties from the existing document (<code>current</code>) into the one being saved (<code>new</code>).
In the event of conflicting keys, it will pick the key value from <code>new</code>.</p>
</div>
<div id="ex-merge-props" class="exampleblock">
<div class="title">Example 13. Merging document properties</div>
<div class="content">
<div id="tabs-19" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-19-kotlin" class="tab">
<p>Kotlin</p>
</li>
<li id="tabs-19-java" class="tab">
<p>Java</p>
</li>
</ul>
</div>
<div id="tabs-19-kotlin--panel" class="tabpanel" aria-labelledby="tabs-19-kotlin">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Kotlin hljs" data-lang="Kotlin" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.kt">val mutableDocument = collection.getDocument("xyz")?.toMutable() ?: return
mutableDocument.setString("name", "apples")
collection.save(mutableDocument) { newDoc, curDoc -&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
    if (curDoc == null) {
        return@save false
    } <i class="conum" data-value="2"></i><b>(2)</b>
    val dataMap: MutableMap&lt;String, Any&gt; = curDoc.toMap()
    dataMap.putAll(newDoc.toMap()) <i class="conum" data-value="3"></i><b>(3)</b>
    newDoc.setData(dataMap)
    true <i class="conum" data-value="4"></i><b>(4)</b>
} <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
</div>
<div id="tabs-19-java--panel" class="tabpanel" aria-labelledby="tabs-19-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java" data-source-url="https://github.com/couchbaselabs/docs-couchbase-lite/blob/a7879bd848b3f0540839f9681364bc0b4568f22c/modules/android/examples/codesnippet_collection.java">Document doc = collection.getDocument("xyz");
if (doc == null) { return; }
MutableDocument mutableDocument = doc.toMutable();
mutableDocument.setString("name", "apples");

collection.save(
    mutableDocument,
    (newDoc, curDoc) -&gt; {
        if (curDoc == null) { return false; }
        Map&lt;String, Object&gt; dataMap = curDoc.toMap();
        dataMap.putAll(newDoc.toMap());
        newDoc.setData(dataMap);
        return true;
    });</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more on replicator conflict resolution see: <a href="conflict.html" class="xref page">Handling Data Conflicts</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delta-sync"><a class="anchor" href="#delta-sync"></a>Delta Sync</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If delta sync is enabled on the listener, then replication will use delta sync.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-content"><a class="anchor" href="#related-content"></a>Related Content</h2>
<div class="sectionbody">
<div class="card-row three-column-row">
<div class="sect5 column">
<h6 id=""><a class="anchor" href="#"></a></h6>
<div class="ulist">
<div class="title">How to</div>
<ul>
<li>
<p><a href="p2psync-websocket-using-passive.html" class="xref page">Passive Peer</a></p>
</li>
<li>
<p><a href="p2psync-websocket-using-active.html" class="xref page">Active Peer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-2"><a class="anchor" href="#-2"></a></h6>
<div class="ulist">
<div class="title">Concepts</div>
<ul>
<li>
<p><a href="#android:landing-p2psync.adoc" class="xref unresolved">Peer-to-Peer Sync</a></p>
</li>
<li>
<p><a href="http://docs.couchbase.com/mobile/3.1.8/couchbase-lite-android/">API References</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5 column">
<h6 id="-3"><a class="anchor" href="#-3"></a></h6>
<div class="paragraph">
<div class="title">Community Resources &#8230;&#8203;</div>
<p><a href="https://forums.couchbase.com/c/mobile/14">Mobile Forum</a> |
<a href="https://blog.couchbase.com/">Blog</a> |
<a href="https://docs.couchbase.com/tutorials/">Tutorials</a></p>
</div>
<div class="paragraph">
<div class="title"></div>
<p><a href="../../../tutorials/cbl-p2p-sync-websockets/swift/cbl-p2p-sync-websockets.html" class="xref page">Getting Started with Peer-to-Peer Synchronization</a></p>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Mobile","components":["couchbase-lite","sync-gateway"],"url":"/home/mobile.html","latestVersions":{"couchbase-lite":"3.1","sync-gateway":"3.1"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/vendor/chatbox-ui.js"></script>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
