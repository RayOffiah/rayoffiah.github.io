<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="654px" preserveAspectRatio="none" style="width:767px;height:654px;background:#FFFFFF;" version="1.1" viewBox="0 0 767 654" width="767px" zoomAndPan="magnify"><defs><filter height="300%" id="f1dm3btdc1lste" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" height="642.2001" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.0;" width="425" x="336" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165" x="464" y="19">Couchbase Server Cluster</text><rect fill="#008080" filter="url(#f1dm3btdc1lste)" height="400.4002" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="133.2"/><rect fill="#00BFFF" filter="url(#f1dm3btdc1lste)" height="37" style="stroke:#A80036;stroke-width:1.0;" width="10" x="558.5" y="257.2001"/><rect fill="#191970" filter="url(#f1dm3btdc1lste)" height="37" style="stroke:#A80036;stroke-width:1.0;" width="10" x="691.5" y="372.6001"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="230" x2="230" y1="65.3999" y2="605.4002"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="404" x2="404" y1="65.3999" y2="605.4002"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="563" x2="563" y1="65.3999" y2="605.4002"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="696" x2="696" y1="65.3999" y2="605.4002"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="56" x="200" y="29.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="207" y="50.6">Clients</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="56" x="200" y="604.4002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="207" y="625.4002">Clients</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="101" x="354" y="25.6"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="101" x="350" y="29.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="357" y="50.6">Query Service</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="101" x="354" y="604.4002"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="101" x="350" y="608.4002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="357" y="629.4002">Query Service</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="515" y="25.6"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="511" y="29.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="518" y="50.6">Index Service</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="515" y="604.4002"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="97" x="511" y="608.4002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="518" y="629.4002">Index Service</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="93" x="650" y="25.6"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="93" x="646" y="29.6"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="653" y="50.6">Data Service</text><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="93" x="650" y="604.4002"/><rect fill="#FEFECE" filter="url(#f1dm3btdc1lste)" height="30.7999" rx="2.5" ry="2.5" style="stroke:#A80036;stroke-width:1.5;" width="93" x="646" y="608.4002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="653" y="629.4002">Data Service</text><rect fill="#008080" filter="url(#f1dm3btdc1lste)" height="400.4002" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="133.2"/><rect fill="#00BFFF" filter="url(#f1dm3btdc1lste)" height="37" style="stroke:#A80036;stroke-width:1.0;" width="10" x="558.5" y="257.2001"/><rect fill="#191970" filter="url(#f1dm3btdc1lste)" height="37" style="stroke:#A80036;stroke-width:1.0;" width="10" x="691.5" y="372.6001"/><polygon fill="#A80036" points="387.5,129.2,397.5,133.2,387.5,137.2,391.5,133.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230" x2="393.5" y1="133.2" y2="133.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="237" y="113">Submit the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="237" y="128.6">query</text><path d="M5,82.8999 L5,149.8999 A2.5,2.5 0 0 0 7.5,152.3999 L218.5,152.3999 A2.5,2.5 0 0 0 221,149.8999 L221,90.3999 L211,80.3999 L7.5,80.3999 A2.5,2.5 0 0 0 5,82.8999 " fill="#FBFB77" filter="url(#f1dm3btdc1lste)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,80.3999 L211,89.1499 A1.25,1.25 0 0 0 212.25,90.3999 L221,90.3999 L211,80.3999 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="11" y="98.4">SELECT airportname, city</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="11" y="114">FROM airport</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="11" y="129.6">WHERE tz = "America/Anchorage"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="11" y="145.2">AND geo.alt &gt;= 2100;</text><line style="stroke:#00000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="409.5" x2="451.5" y1="199" y2="199"/><line style="stroke:#00000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="451.5" x2="451.5" y1="199" y2="212"/><line style="stroke:#00000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="410.5" x2="451.5" y1="212" y2="212"/><polygon points="420.5,208,410.5,212,420.5,216,416.5,212" style="stroke:#00000000;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="416.5" y="178.8">Parse, analyze,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="416.5" y="194.4">create plan</text><polygon fill="#A80036" points="546.5,253.2001,556.5,257.2001,546.5,261.2001,550.5,257.2001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="552.5" y1="257.2001" y2="257.2001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="416.5" y="237">Scan request; index</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="416.5" y="252.6">filters</text><polygon fill="#A80036" points="420.5,290.2001,410.5,294.2001,420.5,298.2001,416.5,294.2001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="562.5" y1="294.2001" y2="294.2001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="431.5" y="308.2001">Get qualified doc keys</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="473.5" y="323.8001">and index keys</text><polygon fill="#A80036" points="679.5,368.6001,689.5,372.6001,679.5,376.6001,683.5,372.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="685.5" y1="372.6001" y2="372.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="416.5" y="352.4001">Fetch request, doc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="416.5" y="368.0001">keys</text><polygon fill="#A80036" points="420.5,405.6001,410.5,409.6001,420.5,413.6001,416.5,409.6001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="695.5" y1="409.6001" y2="409.6001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="635.5" y="423.6001">Fetch the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="626.5" y="439.2001">documents</text><line style="stroke:#00000000;stroke-width:1.0;" x1="409.5" x2="451.5" y1="488.0002" y2="488.0002"/><line style="stroke:#00000000;stroke-width:1.0;" x1="451.5" x2="451.5" y1="488.0002" y2="501.0002"/><line style="stroke:#00000000;stroke-width:1.0;" x1="410.5" x2="451.5" y1="501.0002" y2="501.0002"/><polygon points="420.5,497.0002,410.5,501.0002,420.5,505.0002,416.5,501.0002" style="stroke:#00000000;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="416.5" y="467.8001">Evaluate; documents</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="416.5" y="483.4002">to results</text><polygon fill="#A80036" points="241,529.6002,231,533.6002,241,537.6002,237,533.6002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="235" x2="403.5" y1="533.6002" y2="533.6002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="363.5" y="547.6002">Query</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="366.5" y="563.2002">result</text><path d="M43,516.5002 L43,583.5002 A2.5,2.5 0 0 0 45.5,586.0002 L218.5,586.0002 A2.5,2.5 0 0 0 221,583.5002 L221,524.0002 L211,514.0002 L45.5,514.0002 A2.5,2.5 0 0 0 43,516.5002 " fill="#FBFB77" filter="url(#f1dm3btdc1lste)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,514.0002 L211,522.7502 A1.25,1.25 0 0 0 212.25,524.0002 L221,524.0002 L211,514.0002 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="49" y="532.0002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="55" y="547.6002">"airportname": "Analtuvuk",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="55" y="563.2002">"city": "Anaktuvuk Pass"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="49" y="578.8002">}</text><!--MD5=[61c9c630e388f78a7bd393c7a2e5ca93]
@startuml
skinparam maxMessageSize 125
skinparam roundcorner 5
skinparam responseMessageBelowArrow true
skinparam sequenceMessageAlign direction
skinparam ParticipantPadding 10
skinparam BoxPadding 60
skinparam box {
BackgroundColor PaleGreen
ArrowColor SeaGreen
BorderColor SpringGreen
}

participant Clients

box Couchbase Server Cluster #White
collections "Query Service" as Query
collections "Index Service" as Index
collections "Data Service" as Data
end box

Clients -> Query: Submit the\nquery
activate Query #teal
' tag::example[]
note left
  SELECT airportname, city
  FROM airport
  WHERE tz = "America/Anchorage"
  AND geo.alt >= 2100;
end note
' end::example[]

Query -[#transparent]-> Query: Parse, analyze, create plan

Query -> Index: Scan request; index filters
activate Index #deepskyblue
|||
Index -> Query: Get qualified doc keys and index keys
deactivate Index

' tag::fetch[]
Query -> Data: Fetch request, doc keys
activate Data #midnightblue
|||
Data -> Query: Fetch the\ndocuments
deactivate Data
' end::fetch[]

Query -[#transparent]> Query: Evaluate; documents to results

Query -> Clients: Query\nresult
deactivate Query
' tag::example[]
note left
  {
    "airportname": "Analtuvuk",
    "city": "Anaktuvuk Pass"
  }
end note
' end::example[]
@enduml

@startuml
skinparam maxMessageSize 125
skinparam roundcorner 5
skinparam responseMessageBelowArrow true
skinparam sequenceMessageAlign direction
skinparam ParticipantPadding 10
skinparam BoxPadding 60
skinparam box {
BackgroundColor PaleGreen
ArrowColor SeaGreen
BorderColor SpringGreen
}

participant Clients

box Couchbase Server Cluster #White
collections "Query Service" as Query
collections "Index Service" as Index
collections "Data Service" as Data
end box

Clients -> Query: Submit the\nquery
activate Query #teal
note left
  SELECT airportname, city
  FROM airport
  WHERE tz = "America/Anchorage"
  AND geo.alt >= 2100;
end note

Query -[#transparent]-> Query: Parse, analyze, create plan

Query -> Index: Scan request; index filters
activate Index #deepskyblue
|||
Index -> Query: Get qualified doc keys and index keys
deactivate Index

Query -> Data: Fetch request, doc keys
activate Data #midnightblue
|||
Data -> Query: Fetch the\ndocuments
deactivate Data

Query -[#transparent]> Query: Evaluate; documents to results

Query -> Clients: Query\nresult
deactivate Query
note left
  {
    "airportname": "Analtuvuk",
    "city": "Anaktuvuk Pass"
  }
end note
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>