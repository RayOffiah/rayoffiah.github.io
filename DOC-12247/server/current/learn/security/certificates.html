<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Certificates | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/server/current/learn/security/certificates.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Server supports using certificates for client and server security and  authentication.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.6">
<meta name="page-url" content="/server/current/learn/security/certificates.html">
<meta name="page-nav-header-levels" content="0">

<meta name="docsearch:component" content="server">
<meta name="docsearch:component_title" content="Couchbase Server">
<meta name="docsearch:cversion" content="7.6">
<meta name="docsearch:component_version" content="server@7.6">
<meta name="docsearch:module" content="learn">
<meta name="docsearch:breadcrumbs" content="Couchbase Server / Learn / Security / Authentication / Certificates">
<meta name="docsearch:topic_type" content="">
<meta name="docsearch:version_rank" content="1">
<meta name="docsearch:status" content="">
<meta name="docsearch:edition" content="">
<meta name="docsearch:page_rank" content="50">


<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation"
                      href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">

                  <li class="nav-item "">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item nav-item-selected">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../../cloud/index.html">
                      Capella
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../../../home/sdk.html">
                      SDKs
                      
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="certificates.html" selected>7.6</option>
        <option value="7.2" data-url="../../../7.2/index.html">7.2</option>
        <option value="7.1" data-url="../../../7.1/index.html">7.1</option>
        <option value="7.0" data-url="../../../7.0/index.html">7.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="3">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/docs-server/modules/learn/pages/security/certificates.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Learn</li>
<li class="crumb"><a href="security-overview.html">Security</a></li>
<li class="crumb"><a href="authentication.html">Authentication</a></li>
<li class="crumb"><a href="certificates.html">Certificates</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Certificates</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server supports using certificates for client and server security and  authentication.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificates-in-couchbase"><a class="anchor" href="#certificates-in-couchbase"></a>Certificates and Couchbase Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To maintain security, Couchbase Server can verify the identity of any system it connects to or that tries to connect to it.
This verification ensures that only authorized systems can interact with the database.
By default, Couchbase Server nodes always verifies the identity of other nodes in the cluster.
You can choose to have Couchbase Server also verify the identity of client systems and XDCR clusters.
Couchbase Server verifies the identity of systems using certificates.</p>
</div>
<div class="paragraph">
<p>Similarly, you can configure Couchbase Server to identify itself to other systems using certificates.
This use of certificates lets other systems such as clients and XDCR clusters verify the identity of your database.</p>
</div>
<div class="paragraph">
<p>Certificates indicate trust (and therefore identity) by cryptographically signing other certificates.
You use a certificate&#8217;s private key to sign another certificate.
In this case, the certificate you use to sign another is called a Certificate Authority (CA) or a root certificate.
When you use a CA to sign a certificate, you&#8217;re indicating you trust the system using certificate.
If Couchbase Server trusts the CA, it can trust a system that identifies itself with a certificate signed by the CA.
You can also use the signed certificate as an intermediate certificate by using its own private key to sign new certificates.
By signing the new certificate, the intermediate certificate extends the trust of the CA to the newly signed certificate.
This series of signings establishes a chain of trust from the CA, through the intermediate certificate, to new certificate.</p>
</div>
<div class="paragraph">
<p>This page provides a general overview of using certificates with Couchbase Server and clients.
It assumes you know the basics of Transport Layer Security (TLS) and certificates.
To learn more about these topics, see the Wikipedia article on  <a href="https://en.wikipedia.org/wiki/Public_key_certificate" target="_blank" rel="noopener">Public key certificate</a>,  and OpenSSL&#8217;s <a href="https://wiki.openssl.org/index.php/Command_Line_Utilities">Command Line Utilities</a> page.</p>
</div>
<div class="paragraph">
<p>Managing certificates requires Full Admin, Local User Security Admin, or External User Security Admin privileges.</p>
</div>
<div class="paragraph">
<p>For step-by-step instructions for creating and deploying certificate for Couchbase Server and clients, see <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a> and <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.</p>
</div>
<div class="sect2">
<h3 id="certificate-hierarchies"><a class="anchor" href="#certificate-hierarchies"></a>Couchbase Server&#8217;s Trust Store</h3>
<div class="paragraph">
<p>You tell Couchbase Server which CAs and intermediate certificates to trust by adding them to its trust store.
The trust store is a collection of certificates that&#8217;s shared cluster-wide&#8212;&#8203;each node can access the certificates in it.
The nodes in the cluster use these certificates to determine whether to trust other nodes during TLS connection negotiation.</p>
</div>
<div class="paragraph">
<p>When a system&#8212;&#8203;another node, or a client or XDCR cluster when configured to connect securely&#8212;&#8203;interacts with a node, it provides its certificate as identification.
The node tries to identify the system by establishing a chain of trust from the system&#8217;s certificate to a certificate in the trust store.
For example, suppose a client system has a certificate signed by an intermediate certificate which in turn was signed by a CA in the trust store.
In this case, the node finds a chain of trust from the system&#8217;s certificate, through the intermediate certificate, and to a CA in the trust store.
Therefore, it can trust the identity of the other system.</p>
</div>
</div>
<div class="sect2">
<h3 id="server-certificates"><a class="anchor" href="#server-certificates"></a>Default Certificates</h3>
<div class="paragraph">
<p>By default, when you create a new cluster, Couchbase Server generates a self-signed CA that it uses as its root CA.
It uses this CA to sign server certificates that it automatically generates for each node.
The root CA appears under <strong>Trusted Root Certificates</strong> on the <strong>Certificates</strong> tab of the <strong>Security</strong> page in the Couchbase Server Web Console.</p>
</div>
<div class="imageblock text-left">
<div class="content">
<img src="../_images/security/security_certificates_page.png" alt="security certificates page">
</div>
</div>
<div class="paragraph">
<p>This page also lists each node&#8217;s certificate.</p>
</div>
<div class="paragraph">
<p>As you add nodes to the cluster, Couchbase Server automatically creates a new server certificate for them signed by this CA.
These default certificates allow the nodes to verify each other&#8217;s identity, preventing outside systems from masquerading as a node.
They a basic level of security.</p>
</div>
<div class="paragraph">
<p>You can add additional custom root certificates to Couchbase Server&#8217;s trust store.
Common uses for the additional certificates includes signing certificates to identify client or XDCR clusters.
You can also use additional root certificates to replace the node certificates that Couchbase Server automatically generates.
The following sections explain these uses of custom certificates.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-root-certificates"><a class="anchor" href="#custom-root-certificates"></a>Custom Root Certificates</h3>
<div class="paragraph">
<p>You can choose to create your own certificates, optionally signed by a well-known authority, and add them to Couchbase Server&#8217;s trust store.
These additional certificates are listed under Trusted Root Certificates on the <strong>Certificates</strong> tab of the <strong>Security</strong> page, along with the self-signed CA.
You can use these custom root certificates to sign certificates for client systems and XDCR peers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use the private key for the self-signed root CA that Couchbase Server created to sign node certificates.
Therefore, the only way to create certificates for client systems and XDCR clusters is to create and add custom certificates to the trust store.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="custom-node-certificates"><a class="anchor" href="#custom-node-certificates"></a>Custom Node Certificates</h3>
<div class="paragraph">
<p>You can also use a custom root certificate to sign node certificates.
As long as the signing certificate has a chain of trust leading to a CA in the Couchbase Server&#8217;s trust store, the node&#8217;s certificate will be trusted by other nodes.</p>
</div>
<div class="paragraph">
<p>If you want to use custom node certificates, you can choose to replace the default self-signed root certificate  with your own customized one.
To replace the self-signed CA, you must first replace each node&#8217;s certificate with one you signed using the new CA.
Once no node has a certificate that was signed by the self-signed CA you can delete it.
You can learn which nodes have certificates signed by a root CA from its entry in the Couchbase Server Web Console&#8217;s <strong>Certificates</strong> tab on the <strong>Security</strong> page.
 The <strong>Certs Issued For Nodes</strong> field lists any nodes that have certificates signed by the certificate.</p>
</div>
<div class="paragraph">
<p>Couchbase Server only automatically generates node certificates for new nodes using its default self-signed root certificate.
If you remove this certificate, Couchbase Server does not automatically generate certificates for new nodes.
In this case, you must create a certificate for a new node before adding or joining it to the cluster.</p>
</div>
<div class="paragraph">
<p>Couchbase Server requires that certificates for nodes meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The node&#8217;s certificate must have an attribute that limits its validity to the specific node.
See <a href="#node-certificate-validation">Node Certificate Validation</a> for an explanation.</p>
</li>
<li>
<p>The certificate must either:</p>
<div class="ulist">
<ul>
<li>
<p>An X.509 format certificate in PEM format and named <code>chain.pem</code>.
In addition, you must also supply the certificate&#8217;s private key in a file named <code>pkey.key</code>.
See <a href="#private-key-formats">Private Keys</a> for a discussion of the private keys Couchbase Server supports.</p>
</li>
<li>
<p>A PKCS #12 format file.
See <a href="#pkcs12">PKCS #12 Certificates for Nodes</a> for more information about this format.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../../manage/manage-security/configure-server-certificates.html#root-and-node-certificates" class="xref page">Create and Deploy Cluster and Node Certificates</a> for step-by-step instructions on creating the new CA and node certificates.</p>
</div>
</div>
<div class="sect2">
<h3 id="supported-certificate-formats"><a class="anchor" href="#supported-certificate-formats"></a>Supported Certificate Formats</h3>
<div class="paragraph">
<p>Most of the certificates you use with Couchbase Server are in the X.509 format.
Certificates you add to the trust store must meet the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The certificate must be in a Privacy Enhanced Mail (PEM) file.</p>
</li>
<li>
<p>These files have the extension <code>.pem</code>.</p>
</li>
<li>
<p>The file can have any name, although <code>ca.pem</code> is commonly used.</p>
</li>
<li>
<p>They contain a single certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For examples of creating cluster and other certificates based on private keys see in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a></p>
</div>
<div class="sect3">
<h4 id="pkcs12"><a class="anchor" href="#pkcs12"></a>PKCS #12 Certificates for Nodes</h4>
<div class="paragraph">
<p>When creating custom certificates for nodes, you can use PKCS #12 format certificates instead of X.509 certificates.
This format lets you bundle the node&#8217;s certificate, private key, and certificate chain into a single file.
Couchbase Server only supports this format for nodes.</p>
</div>
<div class="paragraph">
<p>When you upload a PKCS #12 certificate, Couchbase Server extracts the node&#8217;s private key and certificate and handles them the same way it handles individual X.509 certificates.</p>
</div>
<div class="paragraph">
<p>Several things to note when using PKCS #12 certificates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PKCS #12 file&#8217;s name must be <code>couchbase.p12</code> and be located in the node&#8217;s inbox directory.</p>
</li>
<li>
<p>Make sure the node&#8217;s inbox directory only contains the PKCS #12 certificate file.
If the directory contains both a PKCS #12 certificate and a private key file named <code>pkey.key</code>, the call to reload the node&#8217;s certificates fails.
In this case, Couchbase Server cannot determine which file you want it to reload, and refuses to continue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="../../manage/manage-security/configure-server-certificates.html#pkcs12" class="xref page">Deploy a Certificate and Private Key to a Node in a PKCS #12 File</a> for an example of using this certificate format.</p>
</div>
</div>
<div class="sect3">
<h4 id="node-certificate-validation"><a class="anchor" href="#node-certificate-validation"></a>Node Certificate Validation</h4>
<div class="paragraph">
<p>In Couchbase Enterprise Server, each node certificate must have the node&#8217;s name specified as a Subject Alternative Name (SAN).
This attribute restricts the certificate so it&#8217;s only valid for the node named in the SAN.</p>
</div>
<div class="paragraph">
<p>The SAN must meet the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the node name is a Fully Qualified Domain Name (FQDN), the SAN must be the FQDN with a <code>DNS:</code> prefix.
For example, <code>DNS:node1.localhost.com</code>.
When the node name is an FQDN, the SAN cannot specify an IP address.</p>
</li>
<li>
<p>If the node name is an IPv4 or an IPv6 IP address, the SAN must be the IP address, with an <code>IP:</code> prefix.
For example, <code>IP:127.0.0.1</code> or <code>IP:0:0:0:0:0:0:0:1</code>.
When the node name is an IP address, the SAN cannot specify an FQDN.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the wildcard character in all expressions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For examples configuring node certificate including setting the node&#8217;s name as a SAN, see <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intermediate-certificates"><a class="anchor" href="#intermediate-certificates"></a>Intermediate Certificates</h3>
<div class="paragraph">
<p>An intermediate certificate&#8212;&#8203;sometimes referred to as a subordinate certificate, an intermediate CA, or a signing CA&#8212;&#8203;can be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A certificate signed by the root CA certificate.</p>
</li>
<li>
<p>One of a chain of intermediate certificates, each of which was signed by one preceding it in the chain.
The first certificate in the chain must be in Couchbase Server&#8217;s trust store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main purpose of the intermediate certificate is to sign node certificates, client certificates, or other intermediate certificates.
Signing node certificates convey the authority of the root certificate to the node or client certificates indirectly.
Using the intermediate certificate instead of the root certificate&#8217;s own private key limits the key&#8217;s use, making it more secure.</p>
</div>
<div class="paragraph">
<p>The default certificates provided by Couchbase Server do not include intermediates: entity certificates are all signed directly by the root certificate.
However, if you use customized certificates and certificate chains, you can define intermediate certificates.</p>
</div>
<div class="paragraph">
<p>You can upload intermediate certificates to the Couchbase Server trust store.
For information, see <a href="using-multiple-cas.html#adding-intermediate-certificates-to-the-trust-store" class="xref page">Adding Intermediate Certificates to the Trust Store</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-certificates"><a class="anchor" href="#client-certificates"></a>Client Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A client can use a client certificate to identify itself to Couchbase Server.
The certificate allows the server to authenticate the client and to authorize the client&#8217;s associated user.
Information included in the certificate identifies the user by means of a username.</p>
</div>
<div class="paragraph">
<p>Administrators must sign the client certificates for XDCR or SDK-client connections using a root CA certificate in Couchbase Server&#8217;s trust store.</p>
</div>
<div class="paragraph">
<p>When authenticating a client that uses certificate-based authentication, Couchbase Server asks the client to present its certificate.
If Couchbase Server finds that the certificate&#8217;s chain of trust leads to a root authority that it recognizes, it trusts the client.
Couchbase Server then verifies that the certificate has not expired.
After verifying the certificate is still valid, Couchbase Server extracts the username from the certificate.
If the username matches an existing user and the user has the correct roles to access Couchbase Server via the client, Couchbase Server lets the client connect.</p>
</div>
<div class="paragraph">
<p>A similar process allows the server to authenticate with the client in a process called mutual TLS (mTLS) or <a href="https://en.wikipedia.org/wiki/Mutual_authentication" target="_blank" rel="noopener">mutual authentication</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The client&#8217;s authentication with the server relies on the private key used to create the client certificate.
The client digitally signs a message with its private key and sends the message to the server.
The server uses the client&#8217;s public key to verify that the client sent the message.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For an example of using private keys to secure XDCR, see <a href="../../manage/manage-xdcr/enable-full-secure-replication.html#specify-full-xdcr-security-with-certificates" class="xref page">Specify Root and Client Certificates, and Client Private Key</a>.</p>
</div>
<div class="paragraph">
<p>For an example iof using certificates to secure a connection to an LDAP host, see <a href="../../manage/manage-security/configure-ldap.html#client-certificate" class="xref page">Configure LDAP</a>.</p>
</div>
<div class="sect2">
<h3 id="identity-encoding-in-client-certificates"><a class="anchor" href="#identity-encoding-in-client-certificates"></a>Specifying Usernames for Client Certificate Authentication</h3>
<div class="paragraph">
<p>The client certificate can contain the username to use for a client connection.
You can configure Couchbase Server to search for a username among multiple elements within the client certificate.
If it finds an element that could contain a username, Couchbase Server attempts to authenticate and authorize username.</p>
</div>
<div class="paragraph">
<p>If you configure multiple elements within the client certificate to be potential usernames, Couchbase Server attempts to authenticate each until it either authenticates one or runs out of elements.
You set the order in which Couchbase Server examines the elements in the client certificate for usernames.
See <a href="../../manage/manage-security/enable-client-certificate-handling.html" class="xref page">Enable Client Certificate Handling</a> for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="specifying-usernames-in-certificates"><a class="anchor" href="#specifying-usernames-in-certificates"></a>Embedding Usernames in Certificates</h3>
<div class="paragraph">
<p>You can use the following elements in a certificate to specify a username:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Subject</code> for the certificate, featuring the Common Name.
For example, when creating the client-certificate using the command line, you can set the subject of the certificate to <code>clientname</code> by using the <code>-subj "/CN=clientuser"</code> argument.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Internet Engineering Task Force (IETF) has deprecated the Subject Common Name as described in <a href="https://tools.ietf.org/html/rfc6125#section-6.4.4" target="_blank" rel="noopener">section 6.4.4 of RFC 6125</a>.
Couchbase Server continues to support using the Subject Common Name.
See also <a href="#deprecation-of-subject-common-name">Deprecation of Subject Common Name</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <code>DNS</code> name, provided as a Subject Alternative Name for the certificate.
For example, if you add <code>subjectAltName = DNS:node2.cb.com</code> to the certificate, you can configure Couchbase Server  to use <code>node2.cb.com</code> as the username withouy a prefix or delimiter specified in the handling-configuration.</p>
<div class="paragraph">
<p>Prefix and delimiter are explained later in <a href="#identifying-certificate-based-usernames-on-couchbase-server">Identifying Certificate-Based Usernames on Couchbase Server</a>.</p>
</div>
</li>
<li>
<p>The <code>email</code> defined as a Subject Alternative Name for the certificate.
For example, if you add <code>subjectAltName = email:john.smith@example.com</code> to the certificate, you can configure Couchbase Server to use <code>john.smith@example.com</code> as the username.
However, because Couchbase Server does not allow the character <code>@</code> in  usernames, <code>john.smith@example.com</code> is not valid.
You can configure Couchbase Server extract just the account portion of the email address (<code>john.smith</code>) by defining <code>@</code> as a delimiter.
See <a href="#identifying-certificate-based-usernames-on-couchbase-server">Identifying Certificate-Based Usernames on Couchbase Server</a> form an explanation.</p>
</li>
<li>
<p>The <code>URI</code> defined as a Subject Alternative Name in the certificate.
For example, if you add <code>subjectAltName = URI:www.example.com</code> to the certificate, you can configure Couchbase Server to use <code>www.example.com</code> as the username.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For examples of setting Subject Common Names and Subject Alternative Names in certificates, see  <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a> and <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="identifying-certificate-based-usernames-on-couchbase-server"><a class="anchor" href="#identifying-certificate-based-usernames-on-couchbase-server"></a>Identifying Certificate-Based Usernames on Couchbase Server</h3>
<div class="paragraph">
<p>By default, Couchbase Server does not handle client certificates.
You can enable client certificate handling so that it is optional or even mandatory.</p>
</div>
<div class="paragraph">
<p>When you enable client-certificate handling, you can configure Couchbase Server to search for paths within the client certificate that contain usernames for authentication.</p>
</div>
<div class="paragraph">
<p>Each specified path can be one of the following path-types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subject.cn</code>: extracts the Subject Common Name.</p>
</li>
<li>
<p><code>san.dns</code>. extracts the <code>DNS</code> Subject Alternative Name.</p>
</li>
<li>
<p><code>san.email</code>: extracts the <code>email</code> Subject Alternative Name.</p>
</li>
<li>
<p><code>san.uri</code>: extracts the <code>URI</code> Subject Alternative Name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify any number of paths for Couchbase Server to extract.
You can also have it extract multiple instances of any path-type.</p>
</div>
<div class="paragraph">
<p>In some cases, the value in the certificate cannot match a Couchbase Server user name.
For example, email addresses are not valid usernames because they contain the <code>@</code> character.
To handle these case, you can have Couchbase Server parse the value from the certificate to extract the username.
You can define a prefix, delimiter, or both that Couchbase Server uses to extract a portion of the element it extracts from the path.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you define neither a prefix or delimiter for a path, Couchbase Server does not parse element&#8217;s content.
It attempts to match the value as-is to an existing username.</p>
</li>
<li>
<p>You can define a prefix which is a string of text Couchbase Server attempts to match of the start of the value  extracted from the certificate.
If the prefix matches the start of the value, Couchbase Server removes the matching prefix from the value.
It then tries to match the remaining string to a Couchbase Server username.
If the prefix does not match the start of the value, Couchbase Server tries to match the entire value to a username.
For example, suppose you specify <code>san.uri</code> as a path in the certificate to use, and set the prefix to <code>www.</code>.
If Couchbase Server extracts the value <code>www.example.com</code> from the <code>san.uri</code> element in the certificate, the prefix matches leading <code>www.</code>, leaving Couchbase Server with <code>example.com</code> as the username.
If instead the <code>san.uri</code> is <code>example.com</code>, the prefix does not match.
In this case, Couchbase Server attempts to match <code>example.com</code> to a username.</p>
</li>
<li>
<p>You can define a delimiter, which is a single character that Couchbase Server should use to split the value extracted from the certificate.
If it finds the delimiter in the value, Couchbase Server uses the portion of the value before the delimiter as the username.
If Couchbase Server does not find the delimiter in the value, it uses the entire value as the username.
For example, suppose you specify <code>san.email</code> as a path in the certificate, and set the delimeter to <code>@</code>.
If Couchbase Server extracts the value <code>john.smit@example.com</code> as the value of <code>san.email</code>, it splits the value at the <code>@</code>, leaving it with <code>john.smith</code> to match to a username.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the value contains multiple instances of the delimiter, Couchbase Server only uses the portion before the first delimiter.
For example, if you set the delimiter to <code>.</code> and the value is <code>www.example.com</code>, Couchbase Server attempts to match <code>www</code> to a username.
It does not attempt to match any other portion of the value if the first part does not match.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For step-by-step instructions, see <a href="../../manage/manage-security/enable-client-certificate-handling.html" class="xref page">Enable Client Certificate Handling</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deprecation-of-subject-common-name"><a class="anchor" href="#deprecation-of-subject-common-name"></a>Deprecation of Subject Common Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The IETF has deprecated using Subject Common Name to identify either a server or a client in <a href="https://tools.ietf.org/html/rfc6125#section-6.4.4" target="_blank" rel="noopener">section 6.4.4 of RFC 6125</a>.
For Couchbase Enterprise Server Version 7.2 and later, this means that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The node certificate for each server in the cluster must specify its node name as a Subject Alternative Name.
See <a href="#node-certificate-validation">Node-Certificate Validation</a> for details.
You can still use Subject Common Name.</p>
</li>
<li>
<p>A client certificate may continue to specify just a Subject Common Name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of certificate creation provided in <a href="../../manage/manage-security/manage-certificates.html" class="xref page">Manage Certificates</a> continue to include definitions of Subject Common Name for both server and client.</p>
</div>
<div class="sect2">
<h3 id="certificate-checking"><a class="anchor" href="#certificate-checking"></a>Certificate Checking</h3>
<div class="paragraph">
<p>Couchbase Server checks the validity of certificates in following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You upload certificate to a node.
If the name of the node is not specified as a SAN:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If the name of the node can be changed, Couchbase Server issues a warning, and the upload succeeds.</p>
</li>
<li>
<p>If the name of the node cannot be changed, Couchbase Server reports an error, and the upload fails.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>To learn when you can rename a node, see <a href="../clusters-and-availability/nodes.html#node-renaming" class="xref page">Node Renaming</a>.</p>
</div>
</li>
<li>
<p>You add a node or a node joins the cluster.
Couchbase Server always checks the certificate on the new node to verify the node&#8217;s name is correctly specified as a SAN. Depending on the cluster&#8217;s configuration, Couchbase Server may perform the same check on the certificate of the cluster node handling the join.
If Couchbase Server finds an issue, its response depends on what sort of check it performed:</p>
<div class="ulist">
<ul>
<li>
<p>New node: If the node name is not specified as a SAN, Couchbase Server returns an error and the add or join fails.</p>
</li>
<li>
<p>Cluster node: If the cluster has two or more nodes prior to the add or join, Couchbase Server does not perform a check.
Otherwise, the Couchbase Server performs the check.
If the node-name is not specified as a SAN, the add or join fails.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="certificate-expiration"><a class="anchor" href="#certificate-expiration"></a>Certificate Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you create a certificate, you can choose to have it expire after a period of time.
Setting an expiration on certificates is a best practice, as it can help limit the impact of a certificate being compromised.
It also helps enforce certificate rotation.
See <a href="../../manage/manage-security/rotate-server-certificates.html" class="xref page">Certificate Rotation</a>.</p>
</div>
<div class="paragraph">
<p>When you set your certificates to expire, you must remember replace them before their expiration.
You can have the Couchbase Server alert feature notify you before a certificate expires.
By default, Couchbase Server sends this alert 30 days before the certificate expires.
You can change this alert period using the <code>/settings/alerts/limits</code> endpoint to change the <code>certExpirationDays</code> setting.
See <a href="../../rest-api/rest-cluster-email-notifications.html" class="xref page">Setting Alerts</a> for more steps to change this setting.
Couchbase Server also alerts a second time if a certificate has expired.
See <a href="../../manage/manage-settings/configure-alerts.html" class="xref page">Alerts</a> for more information about alerts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="private-key-formats"><a class="anchor" href="#private-key-formats"></a>Private Keys</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server supports using both RSA and X.509 Elliptic Curve (EC) private keys.</p>
</div>
<div class="paragraph">
<p>Couchbase Server supports using the PKCS #1 file format only for unencrypted private keys.
This format only supports RSA keys.</p>
</div>
<div class="paragraph">
<p>Couchbase Server supports using PKCS #8 file format for both unencrypted and encrypted private keys.
The user-specified <code>EncryptedPrivateKeyInfo</code> must use PKCS #5 v2 algorithms.
This format supports both RSA and Elliptic Curve keys.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Couchbase Server does not support Elliptic Curve Key files containing EC PARAMETERS.
When generating EC keys using the <code>openssl</code> command, be sure to use the <code>-noout</code> argument to prevent it from adding an EC PARAMETERS section.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-passphrase-registration"><a class="anchor" href="#json-passphrase-registration"></a>JSON Passphrase Registration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a node&#8217;s certificate has an encrypted private key, you can give Couchbase Server the key&#8217;s passphrase, so it can use the private key when necessary.
You register the passphrase by passing Couchbase Server a JSON object using the REST API.
For information, see <a href="../../rest-api/upload-retrieve-node-cert.html" class="xref page">Upload and Retrieve a Node Certificate</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Examples of file-types and their generation, of extension-definition, of intermediate-certificate use, and of Couchbase-Server specific deployment requirements are provided for the server-side in <a href="../../manage/manage-security/configure-server-certificates.html" class="xref page">Configure Server Certificates</a>, and for the client-side in <a href="../../manage/manage-security/configure-client-certificates.html" class="xref page">Configure Client Certificates</a>.
The examples allow <em>Cross Data Center Replication</em> to be secured with certificates only.
They also support secure access to Couchbase Server from Java clients.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.6"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/vendor/chatbox-ui.js"></script>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
