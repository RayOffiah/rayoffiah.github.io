<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Quickstart | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/kafka-connector/current/quickstart.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="kafka-connector">
<meta name="dcterms.identifier" content="4.2">
<meta name="page-url" content="/kafka-connector/current/quickstart.html">
<meta name="page-nav-header-levels" content="0">

<meta name="docsearch:component" content="kafka-connector">
<meta name="docsearch:component_title" content="Kafka Connector">
<meta name="docsearch:cversion" content="4.2">
<meta name="docsearch:component_version" content="kafka-connector@4.2">
<meta name="docsearch:module" content="">
<meta name="docsearch:breadcrumbs" content=" / Kafka Connector / Quickstart">
<meta name="docsearch:topic_type" content="">
<meta name="docsearch:version_rank" content="1">
<meta name="docsearch:status" content="">
<meta name="docsearch:edition" content="">
<meta name="docsearch:page_rank" content="50">


<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation"
                      href="https://docs.couchbase.com/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">

                  <li class="nav-item "">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                      
                    </a>
                  </li>
                  <li class="nav-item ">
                    <a class="nav-link" href="../../cloud/index.html">
                      Capella
                      
                    </a>
                  </li>
                  <li class="nav-item nav-item-selected">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                      
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/kafka-connect-couchbase/docs/modules/ROOT/pages/quickstart.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="index.html">Kafka Connector</a></li>
<li class="crumb"><a href="quickstart.html">Quickstart</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Quickstart</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This section shows how to deploy the connector.
</blockquote>
</div>
<div class="paragraph">
<p>Before you start, make sure to read the <a href="index.html" class="xref page">introduction</a>, especially the part about the connector&#8217;s <a href="index.html#delivery-guarantees" class="xref page">delivery guarantees</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="download"><a class="anchor" href="#download"></a>Download</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The connector is distributed as a ZIP archive which you can download from the <a href="release-notes.html" class="xref page">Release Notes</a> page.</p>
</div>
<div class="paragraph">
<p>The connector is also available on <a href="https://www.confluent.io/hub/couchbase/kafka-connect-couchbase">Confluent Hub</a>.</p>
</div>
<div class="paragraph">
<p>If you prefer to build the connector from source:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the <a href="https://github.com/couchbase/kafka-connect-couchbase">GitHub repository</a></p>
</li>
<li>
<p>Run <code>mvn package</code> to generate the connector archive</p>
</li>
<li>
<p>Look for <code>couchbase-kafka-connect-couchbase-&lt;version&gt;.zip</code> under the <code>target</code> directory.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>However you obtained the connector archive, go ahead and unzip it now.
The result should be a directory called <code>couchbase-kafka-connect-couchbase-&lt;version&gt;</code>.
The rest of this guide will refer to this directory as <code>$KAFKA_CONNECT_COUCHBASE_HOME</code>.</p>
</div>
<div class="paragraph">
<p>This guide assumes you have already installed Couchbase Server locally and have loaded the sample bucket called <code>travel-sample</code>.
(It&#8217;s fine if you want to use a different bucket;
neither the connector nor this guide depends on the contents of the documents in the bucket.)</p>
</div>
<div class="paragraph">
<p>You&#8217;ll also need a local installation of Apache Kafka or Confluent Platform Kafka.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="set-up-kafka"><a class="anchor" href="#set-up-kafka"></a>Set Up Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you already have an installation of Kafka and know how to start the servers, feel free to skip this section.</p>
</div>
<div class="paragraph">
<p>Still reading?
Don&#8217;t worry, setting up a basic installation is pretty easy.
Download either <a href="https://kafka.apache.org/downloads">Apache Kafka</a> or <a href="https://www.confluent.io/download/">Confluent Platform Kafka</a>.
For simplicity, this guide assumes you&#8217;re installing from a ZIP or TAR archive, so steer clear of the deb/rpm packages for now.</p>
</div>
<div class="paragraph">
<p>Decompress the Apache Kafka or Confluent Platform archive and move the resulting directory under <code>~/opt</code> (or wherever you like to keep this kind of software).
The rest of this guide refers to the root of the installation directory as <code>$KAFKA_HOME</code> or <code>$CONFLUENT_HOME</code>.
Be aware some config files are in different relative locations depending on whether you&#8217;re using Apache Kafka or Confluent Platform Kafka.</p>
</div>
<div class="paragraph">
<p>Make sure the Kafka command line tools are in your path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export PATH=&lt;path-to-apache-kafka-or-confluent&gt;/bin:$PATH</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="start-the-kafka-servers"><a class="anchor" href="#start-the-kafka-servers"></a>Start the Kafka Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re using Confluent Platform Kafka, you can use the <code>confluent</code> command to start the servers in development mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">confluent local services schema-registry start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re not using Confluent, the commands are slightly different, but the idea is the same.
Start the Zookeeper and Kafka servers by running these commands, <strong>each in a separate terminal</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">zookeeper-server-start.sh $KAFKA_HOME/config/zookeeper.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in a separate terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafka-server-start.sh $KAFKA_HOME/config/server.properties</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="couchbase-source-connector"><a class="anchor" href="#couchbase-source-connector"></a>Couchbase Source Connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The source connector listens for changes to Couchbase documents and publishes them to a Kafka topic.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you&#8217;re more interested in saving Kafka messages to Couchbase, skip ahead to the <a href="#sink">Couchbase Sink Connector</a> section.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="source-config"><a class="anchor" href="#source-config"></a>Configure the Source Connector</h3>
<div class="paragraph">
<p>The Couchbase connector distribution includes sample config files.
Look inside <code>$KAFKA_CONNECT_COUCHBASE_HOME/etc</code> and edit the <code>quickstart-couchbase-source.properties</code> file.</p>
</div>
<div class="paragraph">
<p>Take a moment to peruse the configuration options specified here.
Some are <a href="https://kafka.apache.org/documentation/#connect_configuring">standard options available to all connectors</a>.
The rest are specific to the Couchbase connector.</p>
</div>
<div class="paragraph">
<p>For this exercise, change the value of <code>couchbase.bucket</code> to <code>travel-sample</code> (or whichever bucket you want to stream from).
For <code>couchbase.username</code> and <code>couchbase.password</code>, supply the credentials of a Couchbase user who has the "Data DCP Reader" role for the bucket.
If you have not yet created such a user, now is a good time to read about <a href="../../server/current/manage/manage-security/manage-users-and-roles.html" class="xref page">Creating and Managing Users with the UI</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you&#8217;re connecting to Capella, make sure to read <a href="cloud.html" class="xref page">Couchbase Capella Support</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="run"><a class="anchor" href="#run"></a>Run the Source Connector</h3>
<div class="paragraph">
<p>Kafka connectors can be run in <a href="https://kafka.apache.org/documentation/#connect_running">standalone or distributed</a> mode.
For now let&#8217;s run the connector in standalone mode, using the CLASSPATH environment variable to include the Couchbase connector JAR in the class path.</p>
</div>
<div class="paragraph">
<p>For Confluent Platform Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $KAFKA_CONNECT_COUCHBASE_HOME
env CLASSPATH="lib/*" \
    connect-standalone $CONFLUENT_HOME/etc/kafka/connect-standalone.properties \
                       etc/quickstart-couchbase-source.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or for Apache Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $KAFKA_CONNECT_COUCHBASE_HOME
env CLASSPATH="lib/*" \
    connect-standalone.sh $KAFKA_HOME/config/connect-standalone.properties \
                       etc/quickstart-couchbase-source.properties</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alternatively-run-the-connector-with-class-loader-isolation"><a class="anchor" href="#alternatively-run-the-connector-with-class-loader-isolation"></a>Alternatively, Run the Connector with Class Loader Isolation</h3>
<div class="paragraph">
<p>Class loader isolation prevents plugins that use different versions of the same Java library from interfering with one another.
Instead of adding the plugin JARs to the class path when running the connect worker, you can install them in a location called the "plugin path."</p>
</div>
<div class="paragraph">
<p>There are multiple ways to do this.
You can choose whichever method is most convenient.
All of these methods involve the <code>plugin.path</code> worker config property which is defined in the <code>connect-*.properties</code> file referenced by the above commands.</p>
</div>
<div class="paragraph">
<p>Once the connector is in the plugin path (using any of the methods described below), it is no longer necessary to set the <code>CLASSPATH</code> environment variable when running the connect worker.</p>
</div>
<div class="sect3">
<h4 id="option-1-use-confluent-platform-tools"><a class="anchor" href="#option-1-use-confluent-platform-tools"></a>Option 1: Use Confluent Platform tools</h4>
<div class="paragraph">
<p>Confluent Platform users can install the connector by running the <a href="https://docs.confluent.io/current/connect/managing/confluent-hub/command-reference/confluent-hub-install.html"><code>confluent-hub install</code></a> command:</p>
</div>
<div class="paragraph">
<p>To install from a ZIP archive on the local filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">confluent-hub install couchbase-kafka-connect-couchbase-&lt;version&gt;.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can download and install the connector directly from the Confluent Hub component repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">confluent-hub install couchbase/kafka-connect-couchbase:&lt;version&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="option-2-modify-the-plugin-path-config-property"><a class="anchor" href="#option-2-modify-the-plugin-path-config-property"></a>Option 2: Modify the <code>plugin.path</code> config property</h4>
<div class="paragraph">
<p>Alternatively, Edit the connect worker config file (<code>connect-*.properties</code>) and search for the <code>plugin.path</code> property.
Change the value of this property to include the full path to the <code>couchbase-kafka-connect-couchbase-&lt;version&gt;</code> directory (which we have been calling <code>$KAFKA_CONNECT_COUCHBASE_HOME</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="option-3-copy-the-connector-to-an-existing-plugin-path-location"><a class="anchor" href="#option-3-copy-the-connector-to-an-existing-plugin-path-location"></a>Option 3: Copy the connector to an existing <code>plugin.path</code> location</h4>
<div class="paragraph">
<p>Alternatively, copy the <code>$KAFKA_CONNECT_COUCHBASE_HOME/<strong>lib</strong></code> directory to one of the directories already listed in the plugin path.
You may also wish to rename the directory from <code>lib</code> to <code>kafka-connect-couchbase</code>.</p>
</div>
<div class="paragraph">
<p>For example, if the <code>plugin.path</code> property is <code>/opt/connectors</code>, you want to end up with a directory structure like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">opt
`-- connectors
    `-- kafka-connect-couchbase
        |-- kafka-connect-couchbase-&lt;version&gt;.jar
        |-- java-client-&lt;version&gt;.jar
        |-- core-io-&lt;version&gt;.jar
        `-- (and the other JARs too)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="observe-messages-published-by-couchbase-source-connector"><a class="anchor" href="#observe-messages-published-by-couchbase-source-connector"></a>Observe Messages Published by Couchbase Source Connector</h3>
<div class="paragraph">
<p>The sample config file tells the source connector to publish to a topic called <code>test-default</code>.
Let&#8217;s use the Kafka command-line tools to spy on the contents of the topic.</p>
</div>
<div class="paragraph">
<p>For Confluent Platform Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafka-console-consumer --bootstrap-server localhost:9092 \
                       --property print.key=true \
                       --topic test-default --from-beginning</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When a topic contains messages in Avro format, Confluent users should view the messages by running <code>kafka-avro-console-consumer</code> instead of <code>kafka-console-consumer</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or for Apache Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kafka-console-consumer.sh --bootstrap-server localhost:9092 \
                          --property print.key=true \
                          --topic test-default --from-beginning</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each line of the output represents a document in Couchbase.
Every time a Couchbase document is created, modified, or deleted, the console consumer  prints another line containing the updated version of the document.</p>
</div>
<div class="paragraph">
<p>Once the consumer catches up to the current state of the bucket, try <a href="#java-sdk::webui-cli-access.adoc" class="xref unresolved">creating, updating, or deleting a document via the Couchbase Web Console</a> and observe how the change is propagated to the Kafka topic.</p>
</div>
</div>
<div class="sect2">
<h3 id="changing-the-format-of-published-messages"><a class="anchor" href="#changing-the-format-of-published-messages"></a>Changing the format of published messages</h3>
<div class="paragraph">
<p>A component called a "source handler" determines the content of the published  messages.</p>
</div>
<div class="paragraph">
<p>The sample config uses <code>RawJsonSourceHandler</code>, which publishes JSON messages identical to the Couchbase documents. This section describes  how to use this source handler, and then discusses alternate source handlers.</p>
</div>
<div class="sect3">
<h4 id="rawjsonsourcehandler"><a class="anchor" href="#rawjsonsourcehandler"></a>RawJsonSourceHandler</h4>
<div class="paragraph">
<p>This handler always publishes records in JSON format, and requires the value converter be set to <code>ByteArrayConverter</code> which acts as a pass-through for the output byte array containing the JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">key.converter=org.apache.kafka.connect.storage.StringConverter
couchbase.source.handler=com.couchbase.connect.kafka.handler.source.RawJsonSourceHandler
value.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a Couchbase document is deleted, <code>RawJsonSourceHandler</code> sends a Kafka message with a null value.
If instead you wish to ignore deletion events, filter them out with the <code>DropIfNullValue</code> transform:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">transforms=ignoreDeletes
transforms.ignoreDeletes.type=com.couchbase.connect.kafka.transform.DropIfNullValue</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a performance optimization, <code>RawJsonSourceHandler</code> and its cousin <code>RawJsonWithMetadataSourceHandler</code> create Kafka Connect records whose values are byte arrays.
If you wish to use these handlers together with transforms that modify document content, the record value must be converted from a byte array to a compatible format.
To do this, include the <code>DeserializeJson</code> transform as the first in the chain and set <code>value.converter</code> to <code>JsonConverter</code> instead of <code>ByteArrayConverter</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">couchbase.source.handler=com.couchbase.connect.kafka.handler.source.RawJsonSourceHandler

value.converter=org.apache.kafka.connect.json.JsonConverter
value.converter.schemas.enable=false

transforms=deserializeJson,someOtherTransform
transforms.deserializeJson.type=com.couchbase.connect.kafka.transform.DeserializeJson
transforms.someOtherTransform.type=...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rawjsonwithmetadatasourcehandler"><a class="anchor" href="#rawjsonwithmetadatasourcehandler"></a>RawJsonWithMetadataSourceHandler</h4>
<div class="paragraph">
<p>This source handler is similar to <code>RawJsonSourceHandler</code>, but it wraps the
Couchbase document content in an envelope that includes document metadata.
Like <code>RawJsonSourceHandler</code>, it requires the <code>ByteArrayConverter</code> value converter (unless you are using Single Message Transforms, in which case you should use <code>JsonConverter</code> and execute <code>DeserializeJson</code> as the first transform).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">key.converter=org.apache.kafka.connect.storage.StringConverter
couchbase.source.handler=com.couchbase.connect.kafka.handler.source.RawJsonWithMetadataSourceHandler
value.converter=org.apache.kafka.connect.converters.ByteArrayConverter</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use this source handler, each record has an <code>event</code> field whose value indicates the type of change represented by the message.
The possible values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mutation</code>: A change to document content, including creation and changes made via subdocument commands.</p>
</li>
<li>
<p><code>deletion</code>: Removal or expiration of the document.</p>
</li>
<li>
<p><code>expiration</code>: Reserved for document expiration (Couchbase Server does not currently send this event type, but may in future versions).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For mutation messages, the entire content of the Couchbase document is present as the value of the <code>content</code> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="defaultschemasourcehandler"><a class="anchor" href="#defaultschemasourcehandler"></a>DefaultSchemaSourceHandler</h4>
<div class="paragraph">
<p>This source handler generates records whose values contain the same kind of metadata envelope as <code>RawJsonWithMetadataSourceHandler</code>.
It differs in that it defines a schema for the envelope.
You can use this source handler with any value converter; specify whichever converter matches your desired publication format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">couchbase.source.handler=com.couchbase.connect.kafka.handler.source.DefaultSchemaSourceHandler</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The schema used by this source handler defines the Couchbase document content to be a byte array.
If you use <code>JsonConverter</code>, this byte array will be serialized as a single Base64-encoded string.
If this is not the behavior you want, consider using one of the raw JSON source handlers instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For reference, the Avro schema for this payload format is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "record",
  "name": "DcpMessage",
  "namespace": "com.couchbase",
  "fields": [
    {
      "name": "event",
      "type": "string"
    },
    {
      "name": "partition",
      "type": {
        "type": "int",
        "connect.type": "int16"
      }
    },
    {
      "name": "key",
      "type": "string"
    },
    {
      "name": "cas",
      "type": "long"
    },
    {
      "name": "bySeqno",
      "type": "long"
    },
    {
      "name": "revSeqno",
      "type": "long"
    },
    {
      "name": "expiration",
      "type": [
        "null",
        "int"
      ]
    },
    {
      "name": "flags",
      "type": [
        "null",
        "int"
      ]
    },
    {
      "name": "lockTime",
      "type": [
        "null",
        "int"
      ]
    },
    {
      "name": "content",
      "type": [
        "null",
        "bytes"
      ]
    }
  ],
  "connect.name": "com.couchbase.DcpMessage"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-custom-sourcehandler"><a class="anchor" href="#writing-a-custom-sourcehandler"></a>Writing a custom SourceHandler</h4>
<div class="paragraph">
<p>If none of the existing source handlers meet your requirements, you can write your own.
The connector&#8217;s GitHub repository includes an <a href="https://github.com/couchbase/kafka-connect-couchbase/tree/master/examples/custom-extensions">example project</a> you can use as a template for creating your own source handlers and Single Message Transforms.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sink"><a class="anchor" href="#sink"></a>Couchbase Sink Connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s talk about the sink connector, which reads messages from one or more Kafka topics and writes them to Couchbase Server.</p>
</div>
<div class="paragraph">
<p>The sink connector will attempt to convert message values to JSON.
If the conversion fails, the connector will fall back to treating the value as a String BLOB.</p>
</div>
<div class="paragraph">
<p>If the Kafka key is a primitive type, the connector will use it as the document ID.
If the Kafka key is absent or of complex type (array or struct), the document ID will be generated as <code>topic/partition/offset</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the document ID can come from the body of the Kafka message.
Provide a <code>couchbase.document.id</code> property whose value is a JSON Pointer identifying the document ID field.
If you want the connector to remove this node before persisting the document to Couchbase, provide a <code>couchbase.remove.document.id</code> property with value <code>true</code>.
If the connector fails to locate the document ID field, it will fall back to using the Kafka key or <code>topic/partition/offset</code> as described above.</p>
</div>
<div class="paragraph">
<p>If the Kafka message body is null, the sink connector will delete the Couchbase document whose ID matches the Kafka message key.</p>
</div>
<div class="sect2">
<h3 id="configure-and-run-the-sink-connector"><a class="anchor" href="#configure-and-run-the-sink-connector"></a>Configure and Run the Sink Connector</h3>
<div class="paragraph">
<p>In the <code>$KAFKA_CONNECT_COUCHBASE_HOME/etc</code> directory there is a file called <code>quickstart-couchbase-sink.properties</code>.
Customize this file as described in <a href="#source-config">Configure the Source Connector</a>, only now the bucket will receive messages, and the user must have <em>write</em> access to the bucket.</p>
</div>
<div class="paragraph">
<p>Note: Make sure to specify an existing bucket, otherwise the sink connector will fail.
You may wish to <a href="../../server/current/manage/manage-buckets/create-bucket.html" class="xref page">create a new bucket</a> to receive the messages.</p>
</div>
<div class="paragraph">
<p>To run the sink connector, use the same command as described in <a href="#run">Run the Source Connector</a>, but pass <code>quickstart-couchbase-sink.properties</code> as the second argument to <code>connect-standalone</code> instead of <code>quickstart-couchbase-source.properties</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="send-test-messages"><a class="anchor" href="#send-test-messages"></a>Send Test Messages</h3>
<div class="paragraph">
<p>Now that the Couchbase Sink Connector is running, let&#8217;s give it some messages to import:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/couchbase/kafka-connect-couchbase.git
cd kafka-connect-couchbase/examples/json-producer
mvn compile exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The producer will send some messages and then terminate.
If all goes well, the messages will appear in the Couchbase bucket you specified in the sink connector config.</p>
</div>
<div class="paragraph">
<p>If you wish to see how the Couchbase Sink Connector behaves in the absence of message keys, modify the <code>publishMessage</code> method in the example source code to set the message keys to null, then rerun the producer.</p>
</div>
<div class="paragraph">
<p>Alternatively, if you want the Couchbase document ID to be the airport code, edit <code>quickstart-couchbase-sink.properties</code> and set <code>couchbase.document.id=/airport</code>, restart the sink connector, and run the producer again.</p>
</div>
</div>
<div class="sect2">
<h3 id="modify-documents-before-writing-to-couchbase"><a class="anchor" href="#modify-documents-before-writing-to-couchbase"></a>Modify Documents Before Writing to Couchbase</h3>
<div class="paragraph">
<p>Kafka Connect supports <a href="https://kafka.apache.org/documentation/#connect_transforms">Single Message Transforms</a> that let you change the structure or content of a message.
To experiment with this feature, try adding these lines to your sink connector configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">transforms=addMagicWord
transforms.addMagicWord.type=org.apache.kafka.connect.transforms.InsertField$Value
transforms.addMagicWord.static.field=magicWord
transforms.addMagicWord.static.value=xyzzy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you restart the sink connector and send some more test messages, each new Couchbase document should have a "magicWord" field with value "xyzzy".</p>
</div>
<div class="paragraph">
<p>If the built-in transforms are not sufficient, you can write Java code to implement more complex logic.
The <a href="https://github.com/couchbase/kafka-connect-couchbase/tree/master/examples/custom-extensions"><code>custom-extensions</code></a> project on GitHub includes a sample <code>CustomTransform</code> which you can use as a starting point for creating your own transforms.</p>
</div>
<div class="paragraph">
<p><strong>Parent topic:</strong> <a href="index.html" class="xref page">Kafka Connector</a></p>
</div>
<div class="paragraph">
<p><strong>Next topic:</strong> <a href="source-configuration-options.html" class="xref page">Source Configuration Options</a></p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>Â© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"SDKs","components":["dotnet-sdk","c-sdk","go-sdk","java-sdk","nodejs-sdk","php-sdk","python-sdk","ruby-sdk","scala-sdk","elasticsearch-connector","kafka-connector","spark-connector","tableau-connector","power-bi-connector"],"url":"/home/sdk.html","latestVersions":{"dotnet-sdk":"3.3","c-sdk":"3.3","go-sdk":"2.5","java-sdk":"3.3","nodejs-sdk":"4.1","php-sdk":"4.0","python-sdk":"4.0","ruby-sdk":"3.3","scala-sdk":"1.3","elasticsearch-connector":"4.4","kafka-connector":"4.2","spark-connector":"3.2","tableau-connector":"1.x","power-bi-connector":"1.0"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/vendor/chatbox-ui.js"></script>
<script id="site-script" src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
