<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>cbbackupmgr merge | Couchbase Docs</title>
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Merges two or more backups together">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.6">
<meta name="page-url" content="/server/7.6/backup-restore/cbbackupmgr-merge.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="cbbackupmgr-merge.html" selected>7.6 Prerelease</option>
        <option value="7.2" data-url="../../current/index.html">7.2</option>
        <option value="7.1" data-url="../../7.1/index.html">7.1</option>
        <option value="7.0" data-url="../../7.0/index.html">7.0</option>
        <option value="6.6" data-url="../../6.6/index.html">6.6</option>
        <option value="6.5" data-url="../../6.5/index.html">6.5</option>
        <option value="6.0" data-url="../../6.0/index.html">6.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/backup/docs/modules/backup-restore/pages/cbbackupmgr-merge.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-banner">
<i class="fas fa-file-alt"></i> <p>You are viewing the documentation for a prerelease version.</p>
</div>
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">server</a></li>
<li class="crumb">Reference</li>
<li class="crumb"><a href="../cli/cli-intro.html">CLI Reference</a></li>
<li class="crumb"><a href="cbbackupmgr.html">cbbackupmgr</a></li>
<li class="crumb"><a href="cbbackupmgr-merge.html">cbbackupmgr merge</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">cbbackupmgr merge</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Merges two or more backups together</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synopsis"><a class="anchor" href="#synopsis"></a>SYNOPSIS</h2>
<div class="sectionbody">
<div class="verseblock">
<pre class="content">cbbackupmgr merge [--archive &lt;archive_dir&gt;] [--repo &lt;repo_name&gt;]
                  [--start &lt;start&gt;] [--end &lt;end&gt;]
                  [--date-range &lt;range&gt;] [--threads &lt;num&gt;]
                  [--no-progress-bar] [--passphrase &lt;passphrase&gt;]
                  [--km-key-url &lt;url&gt;] [--km-endpoint &lt;endpoint&gt;]
                  [--km-region &lt;region&gt;] [--km-access-key-id &lt;id&gt;]
                  [--km-secret-access-key &lt;key&gt;] [--km-auth-file &lt;path&gt;]</pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The merge command is an Enterprise Edition command which can be used to merge
two or more backups together. Since cbbackupmgr is a utility that always
attempts to take incremental backups it is sometimes desirable to reduce the
number of files and reclaim disk space. The merge command will always reclaim
space taken up by metadata from each individual backup, and with the SQLite
format it will deduplicate identical keys in backup files merged together in
order to create a single smaller backup file. Note that this deduplication does
not currently happen with the Rift format.</p>
</div>
<div class="paragraph">
<p>Doing merges should replace the full backup step by taking multiple incremental
backups of a Couchbase cluster and converting them into a single full backup.
Since this process takes place in the backup archive there is no cluster
overhead to merging data together. See <a href="cbbackupmgr-strategies.html" class="xref page">cbbackupmgr-strategies</a> for
suggestions on using the merge command in your backup process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="options"><a class="anchor" href="#options"></a>OPTIONS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below are a list of required parameters for the merge command.</p>
</div>
<div class="sect2">
<h3 id="required"><a class="anchor" href="#required"></a>Required</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">-a,--archive &lt;archive_dir&gt;</dt>
<dd>
<p>The archive directory to merge data in.</p>
</dd>
<dt class="hdlist1">-r,--repo &lt;repo_name&gt;</dt>
<dd>
<p>The name of the backup repository to merge data in.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="optional"><a class="anchor" href="#optional"></a>Optional</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">--start &lt;start&gt;</dt>
<dd>
<p>The first backup to merge. See <a href="#START_AND_END">START AND END</a> for information on what values
are accepted.</p>
</dd>
<dt class="hdlist1">--end &lt;end&gt;</dt>
<dd>
<p>The final backup to merge. See <a href="#START_AND_END">START AND END</a> for information on what values
are accepted.</p>
</dd>
<dt class="hdlist1">--date-range &lt;range&gt;</dt>
<dd>
<p>This flag will accept a comma separated range in the same formats as
<code>--start</code> and <code>--end</code>. See <a href="#START_AND_END">START AND END</a> section for more information on the
accepted formats.</p>
</dd>
<dt class="hdlist1">-t,--threads &lt;num&gt;</dt>
<dd>
<p>Specifies the number of concurrent vBuckets that will be merged at a time.
Increasing the threads will make the merge faster but will also increase the
resource used by the client. This parameter defaults to 1 but it is
recommended to increase it to match the number of CPUs in the client machine.</p>
</dd>
<dt class="hdlist1">--no-progress-bar</dt>
<dd>
<p>By default, a progress bar is printed to stdout so that the user can see how
long the merge is expected to take, the amount of data that is being transferred
per second, and the amount of data that has been merged. Specifying this flag
disables the progress bar and is useful when running automated jobs.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="encryption-developer-preview"><a class="anchor" href="#encryption-developer-preview"></a>Encryption (Developer Preview)</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">--passphrase &lt;passphrase&gt;</dt>
<dd>
<p>Passphrase can be used instead of an external key manager. This is not
supported on production and should only be used in development or testing.</p>
</dd>
<dt class="hdlist1">--km-key-url &lt;url&gt;</dt>
<dd>
<p>Provides the Key Identifier in the external Key Management system. Currently
supported KMSs are AWS KMS, GCP KMS, Azure KeyVault, HashiCorp Vault Transit
secrets engine. The option can also be provided using the environmental
variable <code>CB_KM_KEY_URL</code>. For more on how to authenticate using the different
providers see <a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a>.</p>
<div class="paragraph">
<p>For AWS the expected key format is <code>awskms://&lt;KEY-ID|KEY-ALIAS&gt;</code>, for example
<code>awskms://alias/keyAlias</code>.</p>
</div>
<div class="paragraph">
<p>For GCP the expected key format is <code>gcpkms://&lt;KEY-RESOURCE-ID&gt;</code>, for example
<code>gcpkms://projects/project-id/locations/location/keyRings/keyring/cryptoKeys/key</code>.</p>
</div>
<div class="paragraph">
<p>For Azure key vault the expected key format is <code>azurekeyvault://&lt;KEY-IDENTIFIER&gt;</code>
for example:
<code>azurekeyvault://vault-name.vault.azure.net/object-type/object-name/object-version</code>.</p>
</div>
<div class="paragraph">
<p>For HashiCorp Vault the expected format is <code>hashivaults://&lt;HOST&gt;/&lt;KEY-NAME&gt;</code>
for example:
<code>hashivaults://127.0.0.1:8200/keyName</code>.</p>
</div>
</dd>
<dt class="hdlist1">--km-region &lt;region&gt;</dt>
<dd>
<p>Required when using AWS KMS, it allows you to set the key region.</p>
</dd>
<dt class="hdlist1">--km-endpoint &lt;endpoint&gt;</dt>
<dd>
<p>The host or address to use as your KMS. It will override the default SDK one.</p>
</dd>
<dt class="hdlist1">--km-access-key-id &lt;id&gt;</dt>
<dd>
<p>The user ID used to connect to the key management service. It can also be
provided via <code>CB_KM_ACCESS_KEY_ID</code> environmental variable. Please refer
to <a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a> for the required authentication for each
provider.</p>
</dd>
<dt class="hdlist1">--km-secret-access-key &lt;key&gt;</dt>
<dd>
<p>The key used to connect to the key management service. It can also be
provided via the <code>CB_KM_SECRET_ACCESS_KEY</code> environmental variable. Please
refer to <a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a> for the required authentication for
each provider.</p>
</dd>
<dt class="hdlist1">--km-tenant-id &lt;id&gt;</dt>
<dd>
<p>The tenant ID used to connect to the key management service. It can also be
provided via the <code>CB_KM_TENANT_ID</code> environmental variable. This argument is
only required when doing access key authentication with Azure. Please refer
to <a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a> for the required authentication for each
provider.</p>
</dd>
<dt class="hdlist1">--km-auth-file &lt;path&gt;</dt>
<dd>
<p>The path to a file containing the authentication credentials for the key
management service. It can also be provided via the <code>CB_KM_AUTH_FILE</code>
environmental variable. Please refer to <a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a> for the
required authentication for each provider.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="START_AND_END"><a class="anchor" href="#START_AND_END"></a>START AND END</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This sub-command accepts a <code>--start</code> and <code>--end</code> flag. These flags accept
multiple values to allow you to flexibly operate on a range of backups.</p>
</div>
<div class="sect2">
<h3 id="indexes"><a class="anchor" href="#indexes"></a>Indexes</h3>
<div class="paragraph">
<p>Indexes may be supplied to operate on a range of backups, for example
<code>--start 1 --end 2</code> will include start at the first backup and will finish with
the second backup. Note that the first backup is 1 and not 0 and that the
<code>--end</code> flag is inclusive.</p>
</div>
</div>
<div class="sect2">
<h3 id="short-dates"><a class="anchor" href="#short-dates"></a>Short Dates</h3>
<div class="paragraph">
<p>Short dates may be supplied in the format <code>day-month-year</code>. For example
<code>--start 01-08-2020 --end 31-08-2020</code> will operate on all the backups which
were taken during August of 2020. Note that the end date is inclusive.</p>
</div>
<div class="paragraph">
<p>When supplying short dates, you may supply <code>start</code> or <code>oldest</code> as a placeholder
for the date on which the first backup in this repository was taken. The
keywords <code>end</code> or <code>latest</code> may be used as a placeholder for the date last
backup in the repository was taken.</p>
</div>
</div>
<div class="sect2">
<h3 id="backup-names"><a class="anchor" href="#backup-names"></a>Backup Names</h3>
<div class="paragraph">
<p>Backup names may be supplied as they exist on disk. For example
<code>--start 2020-08-13T20_01_08.894226137+01_00 --end 2020-08-13T20_01_12.348300092+01_00</code>
will cause the sub-command to operate on all the backups which inclusively fall
between these two backups.</p>
</div>
<div class="paragraph">
<p>When supplying backup names, you may supply <code>start</code> or <code>oldest</code> as a
placeholder for the first backup in the repository. The keywords <code>end</code> or
<code>latest</code> may be used  as a placeholder for the final backup in the repository.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>EXAMPLES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to merge data, you need to have a backup repository with at least two
backups. Below is an example of merging a backup repository named "example" that
has two backups in it. The first backup contains the initial dataset. The second
backup was taken after four items were updated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cbbackupmgr info -a /data/backups -r example --all
| Repo
| ----
| Name    | Size     | # Backups | Encrypted | Point in Time |
| example | 24.11MiB | 2         | false     | false         |
|
| Backups
| -------
|
| * Backup
|   ------
|   Name                            | Size    | Type | Complete |
|   2020-06-02T07_58_32.42306+01_00 | 2.38MiB | FULL | true     |
|
|   Merged Range
|   ------------
|   Start | End | Count |
|   N/A   | N/A | N/A   |
|
|   Cluster
|   -------
|   Hostname              | UUID                             |
|   http://localhost:8091 | c044f5eeb1dc16d0cd49dac29074b5f9 |
|
|   Services
|   --------
|
|     Eventing
|     --------
|     Functions |
|     0         |
|
|     FTS
|     ---
|     Aliases |
|     1       |
|
|     Query
|     -----
|     UDFs |
|     0    |
|
|   Buckets
|   -------
|
|  -  Bucket
|     ------
|     Name    | Size    |
|     example | 2.38MiB |
|
|     Services
|     --------
|
|       Data
|       ----
|       Mutations | Deletions | Size    |
|       8192      | 0         | 2.38MiB |
|
|         Point in Time
|         -------------
|         Mutations | Deletions | Duplicate Size |
|         8192      | 0         | 0B             |
|
|       Views
|       -----
|       Definitions |
|       0           |
|
|       Analytics
|       ---------
|       CBAS |
|       0    |
|
|       FTS
|       ---
|       Aliases |
|       0       |
|
|       Indexing
|       --------
|       Indexes |
|       0       |
|
| * Backup
|   ------
|   Name                            | Size      | Type | Complete |
|   2020-06-03T08_00_22.62763+01_00 | 654.70KiB | INCR | true     |
|
|   Merged Range
|   ------------
|   Start | End | Count |
|   N/A   | N/A | N/A   |
|
|   Cluster
|   -------
|   Hostname              | UUID                             |
|   http://localhost:8091 | c044f5eeb1dc16d0cd49dac29074b5f9 |
|
|   Services
|   --------
|
|     Eventing
|     --------
|     Functions |
|     0         |
|
|     FTS
|     ---
|     Aliases |
|     1       |
|
|     Query
|     -----
|     UDFs |
|     0    |
|
|   Buckets
|   -------
|
|  -  Bucket
|     ------
|     Name    | Size      |
|     example | 654.70KiB |
|
|     Services
|     --------
|
|       Data
|       ----
|       Mutations | Deletions | Size      |
|       4         | 0         | 654.70KiB |
|
|         Point in Time
|         -------------
|         Mutations | Deletions | Duplicate Size |
|         4         | 0         | 0B             |
|
|       Views
|       -----
|       Definitions |
|       0           |
|
|       Analytics
|       ---------
|       CBAS |
|       0    |
|
|       FTS
|       ---
|       Aliases |
|       0       |
|
|       Indexing
|       --------
|       Indexes |
|       0       |

$ cbbackupmgr merge -a /data/backup -r example --start 2020-06-02T07_58_32.42306+01_00 \
 --end 2020-06-03T08_00_22.62763+01_00

$ cbbackupmgr info -a /data/backups -r example --all
| Repo
| ----
| Name    | Size    | # Backups | Encrypted | Point in Time |
| example | 2.38MiB | 1         | false     | false         |
|
| Backups
| -------
|
| * Backup
|   ------
|   Name                            | Size    | Type         | Complete |
|   2020-06-03T08_00_22.62763+01_00 | 2.38MiB | MERGE - FULL | true     |
|
|   Merged Range
|   ------------
|   Start               | End                 | Count |
|   2020-06-02T07_58_32 | 2020-06-03T08_00_22 | 2     |
|
|   Cluster
|   -------
|   Hostname              | UUID                             |
|   http://localhost:8091 | c044f5eeb1dc16d0cd49dac29074b5f9 |
|
|   Services
|   --------
|
|     Eventing
|     --------
|     Functions |
|     0         |
|
|     FTS
|     ---
|     Aliases |
|     1       |
|
|     Query
|     -----
|     UDFs |
|     0    |
|
|   Buckets
|   -------
|
|  -  Bucket
|     ------
|     Name    | Size    |
|     example | 2.38MiB |
|
|     Services
|     --------
|
|       Data
|       ----
|       Mutations | Deletions | Size    |
|       8192      | 0         | 2.38MiB |
|
|         Point in Time
|         -------------
|         Mutations | Deletions | Duplicate Size |
|         8192      | 0         | 0B             |
|
|       Views
|       -----
|       Definitions |
|       0           |
|
|       Analytics
|       ---------
|       CBAS |
|       0    |
|
|       FTS
|       ---
|       Aliases |
|       0       |
|
|       Indexing
|       --------
|       Indexes |
|       0       |</pre>
</div>
</div>
<div class="paragraph">
<p>Upon completion of the merge the number of items in the backup files is the
same. This is because the keys in the second backup were also contained in the
first backup, but the keys in the second backup contained newer values and
overwrote the keys in the first backup during the merge. The timestamp of the
backup folder is also the same as the timestamp of the latest backup because the
new backup is a snapshot of the cluster at that point in time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discussion"><a class="anchor" href="#discussion"></a>DISCUSSION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is important that internally the merge command is able to merge backups
together without corrupting the backup archive or leaving it in an intermediate
state. In order to ensure this behavior cbbackupmgr always creates a new backup
and completely merges all data before removing any backup files. When a merge is
started a .merge_status file is created in the backup repository to track the
merge progress. cbbackupmgr then copies the first backup to the .merge folder
and begins merging the other backups into .merge folder. After each backup is
merged the .merge_status file is updated to track the merge progress. if all
backups are merged together successfully, cbbackupmgr will start deleting the
old backups and then copy the fully merged backup into a folder containing the
same name as the backup specified by the --end flag. If the cbbackupmgr utility
fails during this process, then the merge will either be completed or the
partial merge files will be removed from the backup repository during the next
invocation of the cbbackupmgr.</p>
</div>
<div class="paragraph">
<p>Since the merge command creates a new backup file before it removes the old ones
it is necessary to have at least as much free space as the backups that are to
be merge together.</p>
</div>
<div class="paragraph">
<p>For more information on suggestions for how to use the merge command in your
backup process see <a href="cbbackupmgr-strategies.html" class="xref page">cbbackupmgr-strategies</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="environment-and-configuration-variables"><a class="anchor" href="#environment-and-configuration-variables"></a>ENVIRONMENT AND CONFIGURATION VARIABLES</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">CB_ARCHIVE_PATH</dt>
<dd>
<p>Specifies the path to the backup archive. If the archive path is supplied as
a command line argument then this value is overridden.</p>
</dd>
<dt class="hdlist1">CB_ENCRYPTION_PASSPHRASE</dt>
<dd>
<p>Specifies the passphrase used for encryption.</p>
</dd>
<dt class="hdlist1">CB_KM_KEY_URL</dt>
<dd>
<p>Specifies the URL identifying the encryption key on the KMS. See
<code>--km-key-url</code> for the expected format and accepted KMSs.</p>
</dd>
<dt class="hdlist1">CB_KM_ACCESS_ID</dt>
<dd>
<p>Specifies the key/user ID used to connect to the KMS.</p>
</dd>
<dt class="hdlist1">CB_KM_SECRET_ACCESS_KEY</dt>
<dd>
<p>Specifies the secret key/token used to connect to the KMS.</p>
</dd>
<dt class="hdlist1">CB_KM_AUTH_FILE</dt>
<dd>
<p>Specifies a path to a file containing the required credentials to connect to
the KMS.</p>
</dd>
<dt class="hdlist1">CB_KM_TENANT_ID</dt>
<dd>
<p>Specifies the cloud provider tenant to connect to the KMS with. This value is
only for when using access key authentication in Azure.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="files"><a class="anchor" href="#files"></a>FILES</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">.merge_status</dt>
<dd>
<p>File storing information on the progress of the merge.</p>
</dd>
<dt class="hdlist1">.merge</dt>
<dd>
<p>Directory storing intermediate merge data.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="cbbackupmgr-info.html" class="xref page">cbbackupmgr-info</a>,
<a href="cbbackupmgr-strategies.html" class="xref page">cbbackupmgr-strategies</a>,
<a href="cbbackupmgr-encryption.html" class="xref page">cbbackupmgr-encryption</a>,
<a href="cbbackupmgr-network-filesystems.html" class="xref page">cbbackupmgr-network-filesystems</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cbbackupmgr"><a class="anchor" href="#cbbackupmgr"></a>CBBACKUPMGR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href="cbbackupmgr.html" class="xref page">cbbackupmgr</a> suite</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>Â© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
