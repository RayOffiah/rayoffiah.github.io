<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Manage and Monitor Queries | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/server/current/n1ql/n1ql-manage/monitoring-n1ql-query.html">
<link rel="stylesheet" href="../../../../_/css/site.css">
<script src="../../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Monitoring and profiling SQL++ queries, query service nodes, and corresponding system resources is very important for smoother operational performance and efficiency of the system.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.6">
<meta name="page-url" content="/server/current/n1ql/n1ql-manage/monitoring-n1ql-query.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="monitoring-n1ql-query.html" selected>7.6</option>
        <option value="7.2" data-url="../../../7.2/index.html">7.2</option>
        <option value="7.1" data-url="../../../7.1/index.html">7.1</option>
        <option value="7.0" data-url="../../../7.0/index.html">7.0</option>
        <option value="6.6" data-url="../../../6.6/index.html">6.6</option>
        <option value="6.5" data-url="../../../6.5/index.html">6.5</option>
        <option value="6.0" data-url="../../../6.0/index.html">6.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/docs-devex/modules/n1ql/pages/n1ql-manage/monitoring-n1ql-query.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb"><a href="../query.html">Query Data with SQL++</a></li>
<li class="crumb"><a href="index.html">Administer Queries and Indexes</a></li>
<li class="crumb"><a href="monitoring-n1ql-query.html">Manage and Monitor Queries</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Manage and Monitor Queries</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Monitoring and profiling SQL++ queries, query service nodes, and corresponding system resources is very important for smoother operational performance and efficiency of the system.
In fact, often it is vital for diagnosing and troubleshooting issues such as query performance, resource bottlenecks, and overloading of various services.
</blockquote>
</div>
<div class="paragraph">
<p>System keyspaces provide various monitoring details and statistics about individual queries and the Query service.
When running on a cluster with multiple query nodes, stats about all queries on all query nodes are collected in the Query management and monitoring system keyspaces.</p>
</div>
<div class="paragraph">
<p>For example, this can help identify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The top 10 slow or fast queries running on a particular query node or the cluster.</p>
</li>
<li>
<p>Resource usage statistics of the query service, or resources used for a particular query.</p>
</li>
<li>
<p>Details about the active, completed, and prepared queries.</p>
</li>
<li>
<p>Find long running queries that are running for more than 2 minutes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These system keyspaces are transient in nature, and are not persisted to disk or permanent storage.
Hence, the information in the keyspaces pertains to the current instantiation of the Query service.</p>
</div>
<div class="paragraph">
<p>You can access the Query management and monitoring system keyspaces using any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SQL++ from the cbq shell or Query Workbench</p>
</li>
<li>
<p>The Query Admin REST API</p>
</li>
<li>
<p>A monitoring SDK</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using SQL++ enables you to obtain further insights from the keyspaces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-and-client-privileges"><a class="anchor" href="#authentication-and-client-privileges"></a>Authentication and Client Privileges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users must have the <strong>Query System Catalog</strong> role to access restricted system keyspaces.
For more details about user roles, see <a href="../../learn/security/authorization-overview.html" class="xref page">Authorization</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples-on-this-page"><a class="anchor" href="#examples-on-this-page"></a>Examples on this Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the REST API examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$BASE_URL</code> is the protocol, host name or IP address, and port&#8201;&#8212;&#8201;for example, <code>http://localhost:8093</code>.</p>
</li>
<li>
<p><code>$USER</code> is the user name.</p>
</li>
<li>
<p><code>$PASSWORD</code> is the password.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vitals"><a class="anchor" href="#vitals"></a>Monitor System Vitals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>system:vitals</code> catalog provides data about the running state and health of the query nodes, such as number of logical cores, active threads, queued threads, CPU utilization, memory usage, network utilization, garbage collection percentage, and so on.
This information can be very useful to assess the current workload and performance characteristics of a query node.</p>
</div>
<div class="sect2">
<h3 id="sys-vitals-get"><a class="anchor" href="#sys-vitals-get"></a>Get System Vitals</h3>
<div class="paragraph">
<p>To view system vitals, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset1_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_rest-api">
<div class="paragraph">
<p>To view system vitals with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD $BASE_URL/admin/vitals</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_sql">
<div class="paragraph">
<p>To view system vitals with SQL++:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:vitals;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-vital-examples"><a class="anchor" href="#sys-vital-examples"></a>System Vitals Details</h3>
<div class="paragraph">
<p>Getting system vitals, as described in <a href="#sys-vitals-get">Get System Vitals</a>, returns results similar to the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "uptime": "7h39m32.668577197s",
  "local.time": "2021-04-30 18:42:39.517208807 +0000 UTC m=+27573.945319668",
  "version": "7.0.0-N1QL",
  "total.threads": 191,
  "cores": 2,
  "gc.num": 669810600,
  "gc.pause.time": "57.586373ms",
  "gc.pause.percent": 0,
  "memory.usage": 247985184,
  "memory.total": 11132383704,
  "memory.system": 495554808,
  "cpu.user.percent": 0,
  "cpu.sys.percent": 0,
  "request.completed.count": 140,
  "request.active.count": 0,
  "request.per.sec.1min": 0.0018,
  "request.per.sec.5min": 0.0055,
  "request.per.sec.15min": 0.0033,
  "request_time.mean": "536.348163ms",
  "request_time.median": "54.065567ms",
  "request_time.80percentile": "981.869933ms",
  "request_time.95percentile": "2.543128455s",
  "request_time.99percentile": "4.627922799s",
  "request.prepared.percent": 0
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/admin.html#_vitals" class="xref page">Vitals</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sys-active-req"><a class="anchor" href="#sys-active-req"></a>Monitor and Manage Active Requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>system:active_requests</code> catalog lists all currently executing active requests or queries.</p>
</div>
<div class="sect2">
<h3 id="sys-active-get"><a class="anchor" href="#sys-active-get"></a>Get Active Requests</h3>
<div class="paragraph">
<p>To view active requests, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset2_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_rest-api">
<div class="paragraph">
<p>To view active requests with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD $BASE_URL/admin/active_requests</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_sql">
<div class="paragraph">
<p>To view active requests with SQL++:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:active_requests;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get the query plan for active requests, include <code>meta().plan</code> in a SQL++ query.
See <a href="#query-monitoring-settings">Query Profiling</a>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_sql">
<div class="paragraph">
<p>To view active requests with SQL++, including the query plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT *, meta().plan FROM system:active_requests;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-active-delete"><a class="anchor" href="#sys-active-delete"></a>Terminate an Active Request</h3>
<div class="paragraph">
<p>The DELETE command can be used to terminate an active request, for instance, a non-responding or a long-running query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset4_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_rest-api">
<div class="paragraph">
<p>To terminate an active request <code class="var">uuid</code> with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD -X DELETE $BASE_URL/admin/active_requests/uuid</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_sql">
<div class="paragraph">
<p>To terminate an active request <code class="var">uuid</code> with SQL++:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">DELETE FROM system:active_requests WHERE requestId = "uuid";</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-active-examples"><a class="anchor" href="#sys-active-examples"></a>Active Request Details</h3>
<div class="paragraph">
<p>Getting active requests, as described in <a href="#sys-active-get">Get Active Requests</a>, returns results similar to the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "active_requests": {
      "clientContextID": "832adfa0-e9e6-464e-b5e6-b7ec7549d511",
      "cpuTime": "111.877µs",
      "elapsedTime": "77.631814ms",
      "executionTime": "77.517185ms",
      "n1qlFeatCtrl": 76,
      "node": "127.0.0.1:8091",
      "phaseOperators": {
        "authorize": 1,
        "fetch": 1,
        "primaryScan": 1,
        "project": 1,
        "stream": 1
      },
      "phaseTimes": {
        "authorize": "4.998µs",
        "fetch": "69.519µs",
        "instantiate": "16.28µs",
        "parse": "597.435µs",
        "plan": "24.141851ms",
        "plan.index.metadata": "24.005473ms",
        "plan.keyspace.metadata": "2.022µs",
        "primaryScan": "23.496033ms",
        "project": "824ns",
        "stream": "2.242µs"
      },
      "queryContext": "default:travel-sample.inventory",
      "remoteAddr": "127.0.0.1:37506",
      "requestId": "05cc1895-9986-4819-b4d3-8a4311e8f319",
      "requestTime": "2024-05-21T13:29:16.864Z",
      "scanConsistency": "unbounded",
      "state": "running",
      "statement": "SELECT * FROM system:active_requests;",
      "statementType": "SELECT",
      "useCBO": true,
      "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:126.0) Gecko/20100101 Firefox/126.0",
      "users": "builtin:Administrator"
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/admin.html#_requests" class="xref page">Requests</a>.</p>
</div>
<div class="paragraph">
<p>For query plan field names and meanings, see <a href="#monitor-profile-details">Query Profiling Details</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sys-prepared"><a class="anchor" href="#sys-prepared"></a>Monitor and Manage Prepared Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>system:prepareds</code> catalog provides data about the known prepared statements and their state in a query node&#8217;s prepared statement cache.
For each prepared statement, this catalog provides information such as name, statement, query plan, last use time, number of uses, and so on.</p>
</div>
<div class="paragraph">
<p>A prepared statement is created and stored relative to the current <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">query context</a>.
You can create multiple prepared statements with the same name, each stored relative to a different query context.
This enables you to run multiple instances of the same application against different datasets.</p>
</div>
<div class="paragraph">
<p>When there are multiple prepared statements with the same name in different query contexts, the name of the prepared statement in the <code>system:prepareds</code> catalog includes the associated query context in brackets.</p>
</div>
<div class="sect2">
<h3 id="sys-prepared-get"><a class="anchor" href="#sys-prepared-get"></a>Get Prepared Statements</h3>
<div class="paragraph">
<p>To get a list of all known prepared statements, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset5_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_rest-api">
<div class="paragraph">
<p>To get a list of all known prepared statements with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD $BASE_URL/admin/prepareds</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_sql">
<div class="paragraph">
<p>To get a list of all known prepared statements with a SQL++ query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:prepareds;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get information about a specific prepared statement, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset6_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_rest-api">
<div class="paragraph">
<p>To get information about a specific prepared statement <code class="var">example1</code> with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD $BASE_URL/admin/prepareds/example1</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset6_sql">
<div class="paragraph">
<p>To get information about a specific prepared statement <code class="var">example1</code> with a SQL++ query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:prepareds WHERE name = "example1";</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get the query plan for prepared statements, include <code>meta().plan</code> in a SQL++ query.
See <a href="#query-monitoring-settings">Query Profiling</a>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset7_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset7_sql">
<div class="paragraph">
<p>To view prepared statements with SQL++, including the query plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT *, meta().plan FROM system:prepareds;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-prepared-delete"><a class="anchor" href="#sys-prepared-delete"></a>Delete Prepared Statements</h3>
<div class="paragraph">
<p>To delete a specific prepared statement, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset8_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset8_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset8_rest-api">
<div class="paragraph">
<p>To delete a prepared statement <code class="var">p1</code> with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD -X DELETE $BASE_URL/admin/prepareds/p1</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset8_sql">
<div class="paragraph">
<p>To delete a prepared statement <code class="var">p1</code> with a SQL++ query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">DELETE FROM system:prepareds WHERE name = "p1";</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To delete all the known prepared statements, use a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset9_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset9_sql">
<div class="paragraph">
<p>To delete all known prepared statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">DELETE FROM system:prepareds;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-prepared-examples"><a class="anchor" href="#sys-prepared-examples"></a>Prepared Statement Details</h3>
<div class="paragraph">
<p>To try the examples in this section, first create a couple of prepared statements.</p>
</div>
<div class="exampleblock">
<div class="title">Create a prepared statement with default query context</div>
<div class="content">
<div class="paragraph">
<p>For this example, unset the query context.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">PREPARE p1 AS SELECT * FROM `travel-sample`.inventory.airline WHERE iata = "U2";</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Create a prepared statement with specified query context</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>inventory</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">PREPARE p1 AS SELECT * FROM airline WHERE iata = "U2";</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Getting prepared statements, as described in <a href="#sys-prepared-get">Get Prepared Statements</a>, returns results similar to the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requestID": "d976e59a-d74e-4350-b0df-fa137099d594",
  "signature": {
    "*": "*",
    "plan": "json"
  },
  "results": [
    {
      "prepareds": {
        "encoded_plan": "H4sIAAAAAAAA/6RTUW/TPBT9K9H5XrbJ30QBMcmIhzJ1AjG0qh3wwKbEJLedmWt71061UIXfjpxkndYhENpbYt97z7nn+GxAtnQVVbk3ykICAgtSsWY6djayMwHy6JWAthXdjr3+TBy0s5Avh7N5qewHaoJXJQXIDSpaqNpEGVmtyfwf1MobOtR2TTY6bg6VZqMtQS6UCdQKWLUiSPgR+u9uFOTdIAg4T6yi4zT+v/sfjOt45Vj/IAh41mttaNmTONUhQn7d4FzxkuL9tL/SEpiyXkMepQ/nA+Sz9rIV+FleaVPtMpjTTU22TG19AZPtcP+5aMp6pbhJcr6AwLe6vO54P+CLQfR+n3zLPh/Y576fcleXe3bfqYydYxsMt/k1NZCR66T+9eAdJO4l+L0NoXQ+nWxhIVAHbZeQWAaNVjxc6YRiefWnXZ6EvYs2VayMIYMneXWiTSSGQOlspXvhsLdXDPyKw0KrqIr97E12gU/PL7D/iMh7q6NWZtpLDwGmUJuYR+JV6ADp1qfCQGaRVouKBzsu28s2vbYd4pFJrZDuBFJOtyE8Go0EbmriJqWVbmOfYKab86aTaz45nRyfJxC9tF2skyoHkDhAKzC0TGeT6Xg2yfwoG8+zvic7yE5mZx+z4oFpxePEZF/eTWaTLMmyFeV19zLo+O3ZsNivAAAA//+q+jhuaAQAAA==",
        "featuresControl": 76,
        "indexApiVersion": 4,
        "indexScanKeyspaces": {
          "default:travel-sample.inventory.airline": false
        },
        "name": "p1", <i class="conum" data-value="1"></i><b>(1)</b>
        "namespace": "default",
        "node": "127.0.0.1:8091",
        "statement": "PREPARE p1 AS SELECT * FROM `travel-sample`.inventory.airline WHERE iata = \"U2\";",
        "uses": 0
      }
    },
    {
      "prepareds": {
        "encoded_plan": "H4sIAAAAAAAA/6STT28TMRDFv8rqcWkrExFAVDLiEKpUIIoaJQUOtNqY3Ulq6tju2Bt1iZbPjry7TWmKQKg3/xnPvPk9zwZkC1dSmXujLCQgsCAVK6YjZyM7EyAPXwloW9LNyOvPxEE7C/myP5sVyn6gOnhVUIDcoKSFqkyUkdWazNOgVt7QQNs12ei4HijNRluCXCgTqBGwakWQ8EN06zYV5G0iCDhPrKLjlP7J3QajKl461j8IAp71WhtadiJOdIiQXzc4U7ykeJftn7IEJqzXkIdp4XyAfNZcNAI/i0ttyl0FM7quyBbpWRfAZNu6/x00Yb1SXCecLyDwrSquWt339KKH3vWTb9Xnvfrcd1lu43LP7jsVsXVsg/42v6IaMnKV6F/13kHiDsGfbQiF8+lkWxYCVdB2CYll0GjE/ZaOKRaXf+vlUbV3q00UK2PI4FFeHWsTiSFQOFvqDhz29ua9vvlgrlVU8/3sTXaOT8/Psf9AyHuro1Zm0qGHAFOoTMwj8Sq0BenGp8BAZpFai4p7Oy6aiyb9th3hkUmtkO4E0pxuh/BwOBS4rojrNK108wDy4HevmK7P6pbibHwyPjpLtfXSttOeYB1A4gCNQJ9pMh1PRtNx5ofZaJZ1b7KD7Hh6+jHreWRf3o2n4ywx2RJ53X4LOnp72nf1KwAA////9+bsZQQAAA==",
        "featuresControl": 76,
        "indexApiVersion": 4,
        "indexScanKeyspaces": {
          "default:travel-sample.inventory.airline": false
        },
        "name": "p1(travel-sample.inventory)", <i class="conum" data-value="2"></i><b>(2)</b>
        "namespace": "default",
        "node": "127.0.0.1:8091",
        "statement": "PREPARE p1 AS SELECT * FROM airline WHERE iata = \"U2\";",
        "uses": 0
      }
    }
  ],
  "status": "success",
  "metrics": {
    "elapsedTime": "25.323496ms",
    "executionTime": "25.173646ms",
    "resultCount": 2,
    "resultSize": 7891,
    "serviceLoad": 12
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the names of the prepared statements are identical, but they are associated with different query contexts.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the prepared statement for the default query context</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the prepared statement showing the associated query context</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/admin.html#_statements" class="xref page">Statements</a>.</p>
</div>
<div class="paragraph">
<p>For query plan field names and meanings, see <a href="#monitor-profile-details">Query Profiling Details</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sys-completed-req"><a class="anchor" href="#sys-completed-req"></a>Monitor and Manage Completed Requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the <code>system:completed_requests</code> catalog maintains a list of the most recent completed requests that have run longer than a predefined threshold of time.
(You can also log completed requests that meet other conditions that you define.)</p>
</div>
<div class="paragraph">
<p>For each completed request, this catalog maintains information such as requestId, statement text, prepared name (if prepared statement), request time, service time, and so on.
This information provides a general insight into the health and performance of the query node and the cluster.</p>
</div>
<div class="sect2">
<h3 id="sys-completed-get"><a class="anchor" href="#sys-completed-get"></a>Get Completed Requests</h3>
<div class="paragraph">
<p>To get a list of all logged completed requests, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset10_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset10_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset10_rest-api">
<div class="paragraph">
<p>To get a list of all logged completed requests using the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD $BASE_URL/admin/completed_requests</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset10_sql">
<div class="paragraph">
<p>To get a list of all logged completed requests using SQL++:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:completed_requests;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>completed</code> state means that the request was started and completed by the Query service, but it does not mean that it was necessarily successful.
The request could have been successful, or completed with errors.</p>
</div>
<div class="paragraph">
<p>To find requests that completed successfully, search for completed requests whose <code>state</code> is <code>completed</code> and whose <code>errorCount</code> field has the value <code>0</code>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset11_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset11_sql">
<div class="paragraph">
<p>To get a list of all logged completed requests, including only successful requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM system:completed_requests
WHERE state = "completed" AND errorCount = 0;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To get the query plan for completed requests, include <code>meta().plan</code> in a SQL++ query.
See <a href="#query-monitoring-settings">Query Profiling</a>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset12_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset12_sql">
<div class="paragraph">
<p>To view completed requests with SQL++, including the query plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT *, meta().plan FROM system:completed_requests;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-completed-delete"><a class="anchor" href="#sys-completed-delete"></a>Purge the Completed Requests</h3>
<div class="paragraph">
<p>To purge a specific completed request, use the Admin REST API or a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset13_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset13_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset13_rest-api">
<div class="paragraph">
<p>To purge a completed request <code class="var">uuid</code> with the Admin REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl -u $USER:$PASSWORD -X DELETE $BASE_URL/admin/completed_requests/uuid</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset13_sql">
<div class="paragraph">
<p>To purge a completed request <code class="var">uuid</code> with SQL++:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">DELETE FROM system:completed_requests WHERE requestId = "uuid";</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To purge completed requests for a given time period, use a SQL++ query.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset14_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset14_sql">
<div class="paragraph">
<p>To purge the completed requests for a given time period:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">DELETE FROM system:completed_requests WHERE requestTime LIKE "2015-09-09%";</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sys-completed-examples"><a class="anchor" href="#sys-completed-examples"></a>Completed Request Details</h3>
<div class="paragraph">
<p>To try the examples in this section, first run a query which takes at least 1000ms (the default value of the <code>completed-threshold</code> query setting) to get registered in the <code>system:completed_requests</code> keyspace.</p>
</div>
<div class="exampleblock">
<div class="title">Run a long query</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>inventory</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">SELECT * FROM route ORDER BY sourceairport LIMIT 5;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Getting completed requests, as described in <a href="#sys-completed-get">Get Completed Requests</a>, returns results similar to the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  // ...
  {
    "completed_requests": {
      "clientContextID": "a19a61ab-cd9e-46c9-be71-92623ff85741",
      "cpuTime": "912.408423ms",
      "elapsedTime": "3.762926948s",
      "errorCount": 0,
      "errors": [],
      "n1qlFeatCtrl": 76,
      "node": "127.0.0.1:8091",
      "phaseCounts": {
        "fetch": 24023,
        "primaryScan": 24023,
        "primaryScan.GSI": 24023,
        "sort": 24028
      },
      "phaseOperators": {
        "authorize": 1,
        "fetch": 1,
        "primaryScan": 1,
        "primaryScan.GSI": 1,
        "project": 1,
        "sort": 2,
        "stream": 1
      },
      "phaseTimes": {
        "authorize": "15.111µs",
        "fetch": "3.641125449s",
        "instantiate": "332.963µs",
        "parse": "1.04015ms",
        "plan": "602.878µs",
        "plan.index.metadata": "25.849µs",
        "plan.keyspace.metadata": "11.586µs",
        "primaryScan": "101.118572ms",
        "primaryScan.GSI": "101.118572ms",
        "project": "33.273783ms",
        "run": "3.760767643s",
        "sort": "666.364325ms",
        "stream": "1.617688ms"
      },
      "queryContext": "default:travel-sample.inventory",
      "remoteAddr": "127.0.0.1:37684",
      "requestId": "e170bf67-d364-4ed7-9698-784bbb779d18",
      "requestTime": "2024-05-21T14:31:46.882Z",
      "resultCount": 5,
      "resultSize": 17714,
      "scanConsistency": "unbounded",
      "serviceTime": "3.762768429s",
      "state": "completed",
      "statement": "SELECT * FROM route ORDER BY sourceairport LIMIT 5;",
      "statementType": "SELECT",
      "useCBO": true,
      "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:126.0) Gecko/20100101 Firefox/126.0",
      "users": "builtin:Administrator",
      "~qualifier": "threshold"
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/admin.html#_requests" class="xref page">Requests</a>.</p>
</div>
<div class="paragraph">
<p>For query plan field names and meanings, see <a href="#monitor-profile-details">Query Profiling Details</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sys-completed-config"><a class="anchor" href="#sys-completed-config"></a>Configure the Completed Requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure the <code>system:completed_requests</code> keyspace by specifying parameters through the Admin API <code>/admin/settings</code> endpoint.</p>
</div>
<div class="paragraph">
<p>You can specify the conditions for completed request logging using the <code>completed</code> field.
This field takes a JSON object containing the names and values of logging qualifiers.
Completed requests that meet the defined qualifiers are logged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed": {"user": "marco", "error": 12003}}'</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="logging-qualifiers"><a class="anchor" href="#logging-qualifiers"></a>Logging Qualifiers</h3>
<div class="paragraph">
<p>You can specify the following logging qualifiers.
A completed request is logged if <em>any</em> of the qualifiers are met (logical OR).</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>threshold</code>
</td>
<td class="hdlist2">
<p>The execution time threshold in milliseconds.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>aborted</code>
</td>
<td class="hdlist2">
<p>Whether to log requests that generate a panic.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>error</code>
</td>
<td class="hdlist2">
<p>Log requests returning this error number.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>client</code>
</td>
<td class="hdlist2">
<p>Log requests from this IP address.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>user</code>
</td>
<td class="hdlist2">
<p>Log requests with this user name.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>context</code>
</td>
<td class="hdlist2">
<p>Log requests with this client context ID.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For full details, see <a href="../n1ql-rest-api/admin.html#_logging_parameters" class="xref page">Logging parameters</a>.</p>
</div>
<div class="paragraph">
<p>The basic syntax adds a qualifier to the logging parameters, i.e. any existing qualifiers are not removed.
You can change the value of a logging qualifier by specifying the same qualifier again with a new value.</p>
</div>
<div class="paragraph">
<p>To add a new instance of an existing qualifier, use a plus sign (<code>+</code>) before the qualifier name, e.g. <code>+user</code>.
To remove a qualifier, use a minus sign (<code>-</code>) before the qualifier name, e.g. <code>-user</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following request will add user <code>simon</code> to those tracked, and remove error <code>12003</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed": {"+user": "simon", "-error": 12003}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you could remove all logging by execution time with the following request, as long as the value matches the existing threshold.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed": {"-threshold": 1000}}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tagged-sets"><a class="anchor" href="#tagged-sets"></a>Tagged Sets</h3>
<div class="paragraph">
<p>You can also specify qualifiers that have to be met as a group for the completed request to be logged (logical AND).</p>
</div>
<div class="paragraph">
<p>To do this, specify the <code>tag</code> field along with a set of qualifiers, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed": {"user": "marco", "error": 12003, "tag": "both_user_and_error"}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the request will be logged when both user and error match.</p>
</div>
<div class="paragraph">
<p>The tag name can be any string that is meaningful and unique.
Requests that match a tagged set of conditions are logged with a field <code>~tag</code>, which is set to the name of the tag.</p>
</div>
<div class="paragraph">
<p>To add a qualifier to a tagged set, specify the tag name again along with the new qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed": {"client": "172.1.2.3", "tag": "both_user_and_error"}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You cannot add a new instance of an existing qualifier to a tagged set using a plus sign (<code>+</code>) before the qualifier name.
For example, you cannot add a <code>user</code> qualifier to a tagged set that already contains a <code>user</code> qualifier.
If you need to track two users with the same error, create two tagged sets, one per user.</p>
</div>
<div class="paragraph">
<p>You can remove a qualifier from a tagged set using a minus sign (<code>-</code>) before the qualifier name, e.g. <code>-user</code>.
When you remove the last qualifier from a tagged set, the tagged set is removed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can specify multiple tagged sets.
In this case, completed requests are logged if they match all of the qualifiers in any of the tagged sets.</p>
</div>
<div class="paragraph">
<p>You can also specify a mixture of tagged sets and individual qualifiers.
In this case, completed requests are logged if they match any of the individual qualifiers, or all of the qualifiers in any of the tagged sets.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="completed-threshold"><a class="anchor" href="#completed-threshold"></a>Completed Threshold</h3>
<div class="paragraph">
<p>The <code class="param">completed-threshold</code> field provides another way of specifying the <code>threshold</code> qualifier within the <code>completed</code> field.</p>
</div>
<div class="paragraph">
<p>This field sets the minimum request duration after which requests are added to the <code>system:completed_requests</code> catalog.
The default value is 1000ms.
Specify <code class="in">0</code> to log all requests and <code class="in">-1</code> to not log any requests to the keyspace.</p>
</div>
<div class="paragraph">
<p>To specify a different value, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed-threshold":0}'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="completed-limit"><a class="anchor" href="#completed-limit"></a>Completed Limit</h3>
<div class="paragraph">
<p>The <code class="param">completed-limit</code> field sets the number of most recent requests to be tracked in the <code>system:completed_requests</code> catalog.
The default value is 4000.
Specify <code class="in">0</code> to not track any requests and <code class="in">-1</code> to set no limit.</p>
</div>
<div class="paragraph">
<p>To specify a different value, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"completed-limit":1000}'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-monitoring-settings"><a class="anchor" href="#query-monitoring-settings"></a>Query Profiling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Query profiling enables you to obtain more detailed monitoring information and finer execution timings for any query.
You can set query profiling to the following levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>off</code>&#8201;&#8212;&#8201;query profiling is disabled.</p>
</li>
<li>
<p><code>phases</code>&#8201;&#8212;&#8201;query profiling is enabled, including information about the phases of query execution.</p>
</li>
<li>
<p><code>timings</code>&#8201;&#8212;&#8201;query profiling is enabled, including information about the phases of query execution, and detailed timing information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set query profiling in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the <a href="#enable-settings-for-a-query-engine">node level</a>, so that it is enabled for all queries on that node.</p>
</li>
<li>
<p>At the <a href="#enable-settings-per-session-or-per-query">request level</a>, for individual queries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about Query settings and parameters, see <a href="query-settings.html" class="xref page">Configure Queries</a>.</p>
</div>
<div class="sect2">
<h3 id="enable-settings-for-a-query-engine"><a class="anchor" href="#enable-settings-for-a-query-engine"></a>Enable Query Profiling for a Query Node</h3>
<div class="paragraph">
<p>To activate query profiling at the node level, specify the <code>profile</code> setting using the <a href="../n1ql-rest-api/admin.html" class="xref page">Admin REST API</a> (<code>/admin/settings</code> endpoint).</p>
</div>
<div class="exampleblock">
<div class="title">See the current node-level query settings</div>
<div class="content">
<div class="paragraph">
<p>The following request gets the current node-level query settings.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh" data-source-url="file:///Users/rayoffiah/projects/couchbase/docs-devex/modules/n1ql/examples/settings/node-level-settings.sh#L4">curl $BASE_URL/admin/settings -u $USER:$PASSWORD</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="file:///Users/rayoffiah/projects/couchbase/docs-devex/modules/n1ql/examples/settings/node-level-settings.jsonc">{
  "atrcollection": "",
  "auto-prepare": false,
  "cleanupclientattempts": true,
  "cleanuplostattempts": true,
  "cleanupwindow": "1m0s",
  "completed": {
    "aborted": null,
    "threshold": 1000
  },
  "completed-limit": 4000,
  "completed-threshold": 1000,
  "controls": false,
  "cpuprofile": "",
  "debug": false,
  "functions-limit": 16384,
  "keep-alive-length": 16384,
  "loglevel": "INFO",
  "max-index-api": 4,
  "max-parallelism": 1,
  "memory-quota": 0,
  "memprofile": "",
  "mutexprofile": false,
  "n1ql-feat-ctrl": 76,
  "numatrs": 1024,
  "pipeline-batch": 16,
  "pipeline-cap": 512,
  "plus-servicers": 16,
  "prepared-limit": 16384,
  "pretty": false,
  "profile": "off",
  "request-size-cap": 67108864,
  "scan-cap": 512,
  "servicers": 4,
  "timeout": 0,
  "txtimeout": "0s",
  "use-cbo": true
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Save node-level query settings to a file</div>
<div class="content">
<div class="paragraph">
<p>The following request saves the current node-level query settings to the file <code>query_settings.json</code>.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh" data-source-url="file:///Users/rayoffiah/projects/couchbase/docs-devex/modules/n1ql/examples/settings/save-node-level-settings.sh#L4">curl $BASE_URL/admin/settings -u $USER:$PASSWORD -o ./query_settings.json</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Set node-level query settings from a file</div>
<div class="content">
<div class="paragraph">
<p>Assuming that you have edited the file <code>query_settings.json</code> to specify the query settings you want, the following request
sets the node-level query settings according to the file.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -X POST \
  -d@./query_settings.json</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Set node-level query settings explicitly</div>
<div class="content">
<div class="paragraph">
<p>The following request explicitly sets query profiling at the node level.</p>
</div>
<div class="listingblock">
<div class="title">Request</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/admin/settings -u $USER:$PASSWORD \
  -H 'Content-Type: application/json' \
  -d '{"profile": "phases"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  // ...
  "profile":"phases",
  "request-size-cap": 67108864,
  "scan-cap": 512,
  "servicers": 4,
  "timeout": 0,
  "txtimeout": "0s",
  "use-cbo": true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-settings-per-session-or-per-query"><a class="anchor" href="#enable-settings-per-session-or-per-query"></a>Enable Query Profiling for a Request</h3>
<div class="paragraph">
<p>To activate profiling at the request level, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <code>profile</code> setting using the <a href="../n1ql-rest-api/index.html" class="xref page">Query REST API</a> (<code>/query/service</code> endpoint).</p>
</li>
<li>
<p>Specify the <code>profile</code> setting using the <a href="../n1ql-intro/cbq.html" class="xref page">cbq</a> command line tool.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset15_rest-api"></a>REST API</p>
</li>
<li>
<p><a id="tabset15_sql"></a>SQL++</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset15_rest-api">
<div class="paragraph">
<p>To set query settings using the REST API, specify the parameters in the request body.</p>
</div>
<hr>
<div class="paragraph">
<p>The following statement sets the profiling to phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/query/service -u $USER:$PASSWORD \
  -d 'profile=phases&amp;statement=SELECT * FROM `travel-sample`.inventory.airline LIMIT 1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following statement sets the profiling to timings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">curl $BASE_URL/query/service -u $USER:$PASSWORD \
  -d 'profile=timings&amp;statement=SELECT * FROM `travel-sample`.inventory.airline LIMIT 1'</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset15_sql">
<div class="paragraph">
<p>To set query settings using the cbq shell, use the <code>\SET</code> command.</p>
</div>
<hr>
<div class="paragraph">
<p>The following statement sets the profiling to phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">\set -profile "phases";
SELECT * FROM `travel-sample`.inventory.airline LIMIT 1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following statement sets the profiling to timings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">\set -profile "timings";
SELECT * FROM `travel-sample`.inventory.airline LIMIT 1;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Query Workbench automatically enables Query profiling, with detailed timing information.
To disable or enable Query profiling with the Query Workbench, specify the <strong>Collect query timings</strong> option using the <a href="../../tools/query-workbench.html#query-preferences" class="xref page">Query Preferences</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitor-profile-details"><a class="anchor" href="#monitor-profile-details"></a>Query Profiling Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can access the profiling information in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <a href="#profile">query responses</a>.</p>
</li>
<li>
<p>In the <a href="#plan">system catalogs</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a query executes a user-defined function, profiling information is available for the SQL++ queries within the user-defined function as well.</p>
</div>
<div class="sect2">
<h3 id="profile"><a class="anchor" href="#profile"></a>Profiling Details in Query Responses</h3>
<div class="paragraph">
<p>When profiling is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are using the cbq shell or the Query REST API, query profiling information is returned with the query results.</p>
</li>
<li>
<p>If you are using the Query workbench, query profiling information is not returned with the query results.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Phases Profile</div>
<div class="content">
<div class="paragraph">
<p>If you are using the cbq shell or the Query REST API, the following statistics are returned when <code>profile</code> is set to <code>phases</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requestID": "06d6c1c2-1a8a-4989-a856-7314f9eddee5",
  "signature": {
    "*": "*"
  },
  "results": [
    {
      "airline": {
        "callsign": "MILE-AIR",
        "country": "United States",
        "iata": "Q5",
        "icao": "MLA",
        "id": 10,
        "name": "40-Mile Air",
        "type": "airline"
      }
    }
  ],
  "status": "success",
  "metrics": {
    "elapsedTime": "12.77927ms",
    "executionTime": "12.570648ms",
    "resultCount": 1,
    "resultSize": 254,
    "serviceLoad": 12
  },
  "profile": {
    "phaseTimes": {
      "authorize": "19.629µs",
      "fetch": "401.997µs",
      "instantiate": "147.686µs",
      "parse": "4.545234ms",
      "plan": "409.364µs",
      "primaryScan": "6.103775ms",
      "run": "6.699056ms"
    },
    "phaseCounts": {
      "fetch": 1,
      "primaryScan": 1
    },
    "phaseOperators": {
      "authorize": 1,
      "fetch": 1,
      "primaryScan": 1
    },
    "requestTime": "2021-04-30T18:37:56.394Z",
    "servicingHost": "127.0.0.1:8091"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Timings Profile</div>
<div class="content">
<div class="paragraph">
<p>If you are using the cbq shell or the Query REST API, the following statistics are returned when <code>profile</code> is set to <code>timings</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requestID": "268a1240-6864-43a2-af13-ccb8d1e50abf",
  "signature": {
    "*": "*"
  },
  "results": [
    {
      "airline": {
        "callsign": "MILE-AIR",
        "country": "United States",
        "iata": "Q5",
        "icao": "MLA",
        "id": 10,
        "name": "40-Mile Air",
        "type": "airline"
      }
    }
  ],
  "status": "success",
  "metrics": {
    "elapsedTime": "2.915245ms",
    "executionTime": "2.755355ms",
    "resultCount": 1,
    "resultSize": 254,
    "serviceLoad": 12
  },
  "profile": {
    "phaseTimes": {
      "authorize": "18.096µs",
      "fetch": "388.122µs",
      "instantiate": "31.702µs",
      "parse": "646.157µs",
      "plan": "120.427µs",
      "primaryScan": "1.402918ms",
      "run": "1.936852ms"
    },
    "phaseCounts": {
      "fetch": 1,
      "primaryScan": 1
    },
    "phaseOperators": {
      "authorize": 1,
      "fetch": 1,
      "primaryScan": 1
    },
    "requestTime": "2021-04-30T18:40:13.239Z",
    "servicingHost": "127.0.0.1:8091",
    "executionTimings": {
      "#operator": "Authorize",
      "#stats": {
        "#phaseSwitches": 4,
        "execTime": "1.084µs",
        "servTime": "17.012µs"
      },
      "privileges": {
        "List": [
          {
            "Target": "default:travel-sample.inventory.airline",
            "Priv": 7,
            "Props": 0
          }
        ]
      },
      "~child": {
        "#operator": "Sequence",
        "#stats": {
          "#phaseSwitches": 1,
          "execTime": "2.474µs"
        },
        "~children": [
          {
            "#operator": "PrimaryScan3",
            "#stats": {
              "#itemsOut": 1,
              "#phaseSwitches": 7,
              "execTime": "18.584µs",
              "kernTime": "8.869µs",
              "servTime": "1.384334ms"
            },
            "bucket": "travel-sample",
            "index": "def_inventory_airline_primary",
            "index_projection": {
              "primary_key": true
            },
            "keyspace": "airline",
            "limit": "1",
            "namespace": "default",
            "scope": "inventory",
            "using": "gsi"
          },
          {
            "#operator": "Fetch",
            "#stats": {
              "#itemsIn": 1,
              "#itemsOut": 1,
              "#phaseSwitches": 10,
              "execTime": "25.64µs",
              "kernTime": "1.427752ms",
              "servTime": "362.482µs"
            },
            "bucket": "travel-sample",
            "keyspace": "airline",
            "namespace": "default",
            "scope": "inventory"
          },
          {
            "#operator": "InitialProject",
            "#stats": {
              "#itemsIn": 1,
              "#itemsOut": 1,
              "#phaseSwitches": 9,
              "execTime": "6.006µs",
              "kernTime": "1.825917ms"
            },
            "result_terms": [
              {
                "expr": "self",
                "star": true
              }
            ]
          },
          {
            "#operator": "Limit",
            "#stats": {
              "#itemsIn": 1,
              "#itemsOut": 1,
              "#phaseSwitches": 4,
              "execTime": "2.409µs",
              "kernTime": "2.094µs"
            },
            "expr": "1"
          },
          {
            "#operator": "Stream",
            "#stats": {
              "#itemsIn": 1,
              "#itemsOut": 1,
              "#phaseSwitches": 6,
              "execTime": "46.964µs",
              "kernTime": "1.844828ms"
            }
          }
        ]
      },
      "~versions": [
        "7.0.0-N1QL",
        "7.0.0-4960-enterprise"
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/index.html#_profile" class="xref page">Profile</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="plan"><a class="anchor" href="#plan"></a>Profiling Details in System Catalogs</h3>
<div class="paragraph">
<p>The <a href="#sys-active-req">system:active_requests</a> and <a href="#sys-completed-req">system:completed_requests</a> system catalogs always return profiling information regarding query phases: that is, phase times, phase counts, and phase operators.</p>
</div>
<div class="paragraph">
<p>The <a href="#sys-active-req">system:active_requests</a>, <a href="#sys-completed-req">system:completed_requests</a>, and <a href="#sys-prepared">system:prepareds</a> system catalogs also support the <code>meta().plan</code> virtual attribute.
This captures the whole query plan, and includes profiling information regarding execution timings.</p>
</div>
<div class="paragraph">
<p>To get execution timing information from these system catalogs, you must explicitly specify <code>meta().plan</code> in the projection list for the SELECT query.</p>
</div>
<div class="paragraph">
<p>Within these system catalogs, not all statements have a <code>meta().plan</code> attribute.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With <a href="#sys-active-req">system:active_requests</a> and <a href="#sys-completed-req">system:completed_requests</a>, the <code>meta().plan</code> attribute is only available for statements that you run when profile is set to <code>timings</code>.</p>
</li>
<li>
<p>With <a href="#sys-prepared">system:prepareds</a>, the <code>meta().plan</code> attribute is available for all statements.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When request profiling is set to <code>timings</code>, profiling information is likely to use 100KB+ per entry in the <code>system:completed_requests</code> keyspace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Due to the added overhead of running both profiling and <a href="../../manage/manage-logging/manage-logging.html" class="xref page">logging</a>, turn on both of them only when needed.
Running only one of them continuously has no noticeable affect on performance.</p>
</li>
<li>
<p>Profiling does not carry any extra cost beyond memory for completed requests, so it&#8217;s fine to run it continuously.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div id="example-2" class="exampleblock">
<div class="title">Plan Details</div>
<div class="content">
<div class="paragraph">
<p>Getting the plan for a statement that you ran when the profile was set to <code>timings</code> returns results similar to the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
  // ...
    "plan": {
      "#operator": "Authorize",
      "#stats": {
        "#phaseSwitches": 4,
        "execTime": "1.725µs",
        "servTime": "21.312µs"
      },
      "privileges": {
        "List": [
          {
            "Priv": 7,
            "Props": 0,
            "Target": "default:travel-sample.inventory.route"
          }
        ]
      },
      "~child": {
        "#operator": "Sequence",
        "#stats": {
          "#phaseSwitches": 2,
          "execTime": "1.499µs"
        },
        "~children": [
          {
            "#operator": "PrimaryScan3",
            "#stats": {
              "#heartbeatYields": 6,
              "#itemsOut": 24024,
              "#phaseSwitches": 96099,
              "execTime": "84.366121ms",
              "kernTime": "3.021901421s",
              "servTime": "69.320752ms"
            },
            "bucket": "travel-sample",
            "index": "def_inventory_route_primary",
            "index_projection": {
              "primary_key": true
            },
            "keyspace": "route",
            "namespace": "default",
            "scope": "inventory",
            "using": "gsi"
          },
          {
            "#operator": "Fetch",
            "#stats": {
              "#heartbeatYields": 7258,
              "#itemsIn": 24024,
              "#itemsOut": 24024,
              "#phaseSwitches": 99104,
              "execTime": "70.34694ms",
              "kernTime": "142.630196ms",
              "servTime": "3.021959695s"
            },
            "bucket": "travel-sample",
            "keyspace": "route",
            "namespace": "default",
            "scope": "inventory"
          },
          {
            "#operator": "InitialProject",
            "#stats": {
              "#itemsIn": 24024,
              "#itemsOut": 24024,
              "#phaseSwitches": 96100,
              "execTime": "15.331951ms",
              "kernTime": "3.219612458s"
            },
            "result_terms": [
              {
                "expr": "self",
                "star": true
              }
            ]
          },
          {
            "#operator": "Order",
            "#stats": {
              "#itemsIn": 24024,
              "#itemsOut": 24024,
              "#phaseSwitches": 72078,
              "execTime": "147.889352ms",
              "kernTime": "3.229055752s"
            },
            "sort_terms": [
              {
                "expr": "(`route`.`sourceairport`)"
              }
            ]
          },
          {
            "#operator": "Stream",
            "#stats": {
              "#itemsIn": 24024,
              "#itemsOut": 24024,
              "#phaseSwitches": 24025,
              "execTime": "11.851634134s"
            }
          }
        ]
      },
      "~versions": [
        "7.0.0-N1QL",
        "7.0.0-4960-enterprise"
      ]
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For field names and meanings, see <a href="../n1ql-rest-api/index.html#_execution_timings" class="xref page">Execution Timings</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-profiling-summary"><a class="anchor" href="#query-profiling-summary"></a>Query Profiling Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following table summarizes Query profiling behavior.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Profile is &#8230;&#8203;</th>
<th class="tableblock halign-left valign-top" colspan="3">Query returns &#8230;&#8203;</th>
<th class="tableblock halign-left valign-top" colspan="3">Catalog includes &#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cbq</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REST API</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Query<br>
workbench</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Active<br>
Requests</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Completed<br>
Requests</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Prepared<br>
Statements</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>off</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>phases</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timings</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases<br>
<span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases<br>
<span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases<br>
<span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> phases<br>
<span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-check fa-fw"></i></span> timings</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Refer to <a href="../n1ql-intro/sysinfo.html" class="xref page">Getting System Information</a> for more information on the system namespace.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.6"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
</body>
</html>
