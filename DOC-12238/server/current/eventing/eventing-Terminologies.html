<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Eventing Terminology | Couchbase Docs</title>
<link rel="canonical" href="https://docs.couchbase.com/server/current/eventing/eventing-Terminologies.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The following terminology is used by the Eventing Service.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.6">
<meta name="page-url" content="/server/current/eventing/eventing-Terminologies.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.7">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://docs.couchbase.com/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="eventing-Terminologies.html" selected>7.6</option>
        <option value="7.2" data-url="../../7.2/index.html">7.2</option>
        <option value="7.1" data-url="../../7.1/index.html">7.1</option>
        <option value="7.0" data-url="../../7.0/index.html">7.0</option>
        <option value="6.6" data-url="../../6.6/index.html">6.6</option>
        <option value="6.5" data-url="../../6.5/index.html">6.5</option>
        <option value="6.0" data-url="../../6.0/index.html">6.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/rayoffiah/projects/couchbase/docs-devex/modules/eventing/pages/eventing-Terminologies.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb"><a href="eventing-overview.html">Run a Function on Data Change</a></li>
<li class="crumb"><a href="eventing-Terminologies.html">Terminology</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Eventing Terminology</h1>
<div class="labels">
<ul></ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The following terminology is used by the Eventing Service.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eventing-service"><a class="anchor" href="#eventing-service"></a>Eventing Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Eventing Service executes user-defined code and responds in real time whenever applications interact and cause your data to change.</p>
</div>
<div class="paragraph">
<p>The Eventing Service can run one or more Eventing Functions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eventing-functions"><a class="anchor" href="#eventing-functions"></a>Eventing Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eventing Functions handle data changes in the Eventing Service.
They&#8217;re standalone JavaScript fragments that trigger in real time as a response to document mutations and that must execute from start to finish before a specified timeout is reached.</p>
</div>
<div class="paragraph">
<p>Eventing Functions allow you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Integrate with the Data Service to:</p>
<div class="ulist">
<ul>
<li>
<p>Read, write, and delete documents</p>
</li>
<li>
<p>Work with Atomic Counters, CAS, and TTLS</p>
</li>
</ul>
</div>
</li>
<li>
<p>Integrate with the Query Service to use inline SQL++ queries or statements</p>
</li>
<li>
<p>Enable a Timer to schedule functions to run in the future</p>
</li>
<li>
<p>Interact with external REST endpoints through cURL functionality</p>
</li>
<li>
<p>Route mutations to the entry points <code>OnUpdate</code> and <code>OnDelete</code></p>
</li>
<li>
<p>Route fired timers to a user-defined Timer callback</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JavaScript code in an Eventing Function is compressed in Couchbase Server versions 6.5.0 and later.
The compressed size is limited to 128KB.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="handlers"><a class="anchor" href="#handlers"></a>Handlers</h3>
<div class="paragraph">
<p>The Eventing Service calls the <code>OnUpdate</code>, <code>OnDelete</code>, and Timer Callback handlers on mutations and fired timers.</p>
</div>
<div class="sect3">
<h4 id="onupdate"><a class="anchor" href="#onupdate"></a><code>OnUpdate</code></h4>
<div class="paragraph">
<p>The <code>OnUpdate</code> handler is called when you create or modify a document.</p>
</div>
<div class="paragraph">
<p>The entry point <code>OnUpdate(doc,meta)</code> passes <code>doc</code>, the document, and <code>meta</code>, which contains additional data like the document ID, CAS, expiration date, and data type.</p>
</div>
<div class="paragraph">
<p>There are two limitations to the <code>OnUpdate</code> handler:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you modify a document several times in a short period of time, the handler calls can merge into a single event due to deduplication</p>
</li>
<li>
<p>It is not possible to distinguish between Create and Update operations</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To prevent the suppression of binary documents, you must set the language compatibility of your Function to Couchbase Server version 6.6.2 or later.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ondelete"><a class="anchor" href="#ondelete"></a><code>OnDelete</code></h4>
<div class="paragraph">
<p>The <code>OnDelete</code> handler is called when you delete a document or when the document expires.</p>
</div>
<div class="paragraph">
<p>The entry point <code>OnDelete(meta,options)</code> passes <code>meta</code>, which contains information like the document, and <code>options</code>, which contains the boolean parameter <code>options.expired</code> that indicates if the document was removed because of a deletion or an expiration.</p>
</div>
<div class="paragraph">
<p>It is not possible to get the value of a document that has been deleted or expired.</p>
</div>
</div>
<div class="sect3">
<h4 id="timer-callback"><a class="anchor" href="#timer-callback"></a>Timer Callback</h4>
<div class="paragraph">
<p>Timer callbacks are user-defined JavaScript functions passed as the <code>callback</code> argument to the built-in function call <code>createTimer(callback,date,reference,context)</code>.</p>
</div>
<div class="paragraph">
<p>When you create a Timer, the <code>callback</code> argument is executed at or close to the <code>date</code> argument.
The <code>reference</code> argument works as an identifier for the Timer scoped to an Eventing Function and callback.
The <code>context</code> argument must be serializable data that is available to the callback when the Timer is fired.</p>
</div>
<div class="paragraph">
<p>For more information about Timer callbacks, see <a href="eventing-timers.html#createtimer-function" class="xref page"><code>createTimer()</code> and <code>cancelTimer()</code></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="statelessness"><a class="anchor" href="#statelessness"></a>Statelessness</h3>
<div class="paragraph">
<p>The persistent state of an Eventing Function is captured in the following external elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Documents or mutations and their extended attributes</p>
</li>
<li>
<p>Listen to Location, or the Eventing source: a collection that is the source of mutations sent to the Function through the Database Change Protocol (DCP)</p>
</li>
<li>
<p>Eventing Storage, or the Eventing metadata: a collection used as a scratchpad for the state of the Function</p>
</li>
<li>
<p>Optional bindings for the Function:</p>
<div class="ulist">
<ul>
<li>
<p>Bucket alias: an alias and access mode used by the Function to access a collection</p>
</li>
<li>
<p>URL alias: an alias and HTTP/S setting used by the Function to access external REST APIs</p>
</li>
<li>
<p>Constant alias: an alias to an integer, decimal number, string, boolean, or a JSON object used as a global variable within the Function</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All states in the execution stack are short-lived.</p>
</div>
</div>
<div class="sect2">
<h3 id="deduplication"><a class="anchor" href="#deduplication"></a>Deduplication</h3>
<div class="paragraph">
<p>Couchbase does not store every version a document permanently.
When a handler receives the mutation history of documents from Eventing, it sees a truncated history of each document.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because the current state of a document is always available in the database, the final state of a document is always present in the mutation history.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To ensure high performance, the KV data engine deduplicates multiple mutations made to an individual document in succession.
Handlers might not see all intermediate states of a document when it mutates quickly, but they do see its final state.</p>
</div>
</div>
<div class="sect2">
<h3 id="recursive-mutation"><a class="anchor" href="#recursive-mutation"></a>Recursive Mutation</h3>
<div class="paragraph">
<p>A potentially recursive mutation happens when a handler manipulates documents in a keyspace that also serves as the mutation source for this or another handler.
The write originated by the handler causes a mutation to be seen by itself or by another handler.</p>
</div>
</div>
<div class="sect2">
<h3 id="json_number_precision"><a class="anchor" href="#json_number_precision"></a>JSON Number Precision</h3>
<div class="paragraph">
<p>JSON does not have specialized types for integral and floating-point numbers, so many JavaScript runtimes use floating-point numbers to hold JSON numbers.
This means that JavaScript numbers have a large range but less precision when it comes to traditional integers of the same size.</p>
</div>
<div class="paragraph">
<p>The JavaScript and WebAssembly engine V8 uses 64-bit floating-point numbers that yield a 53-bit precision.
Only integers up to +/- 253 can be safely handled by Eventing JavaScript.</p>
</div>
<div class="paragraph">
<p>To handle large integers of 15 or more digits, you can use JavaScript <code>BigInt</code> types.
The constants <code>Number.MAX_SAFE_INTEGER</code> and <code>Number.MIN_SAFE_INTERGER</code> show the exact numbers where integral precision is defined and lost by JavaScript.</p>
</div>
<div class="paragraph">
<p>Large integers are usually tokens that require equality comparisons.
In Eventing, this can be seen in the CAS values generated by Advanced Keyspace Operations and in the results generated by the <code>crc64()</code> Function.
In these cases, you can hold the large integers as strings.
The strings ensure full fidelity and retain the ability to do equality comparisons.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>crc64()</code> Function, see <a href="eventing-language-constructs.html#crc64_call" class="xref page"><code>crc64()</code> Function Call</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="function-scope"><a class="anchor" href="#function-scope"></a>Function Scope</h3>
<div class="paragraph">
<p>You can use a <code>bucket.scope</code> to identify Functions that belong to the same group.</p>
</div>
<div class="paragraph">
<p>As a best practice, you should set your Function scope to the <code>bucket.scope</code> that contains the collection that&#8217;s the source of your Eventing Function mutations.
This makes sure that your Function does not undeploy by removing a scope that points to a resource that&#8217;s not required for the Function to run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To set the <code>bucket.scope</code> to <code>+</code>.<code>+</code>, you must have the <code>Eventing Full Admin</code> or the <code>Full Admin</code> role.
All other users must use a scope that references an existing resource of their <code>bucket.scope</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="section_mzd_l1p_m2b"><a class="anchor" href="#section_mzd_l1p_m2b"></a>Bindings</h3>
<div class="paragraph">
<p>A binding is a construct that lets you separate environment-specific variables, like keyspace names, external endpoint URLS and credentials, and global constrains, from the source code of the Eventing Function.</p>
</div>
<div class="paragraph">
<p>A binding provides indirection between environment-specific artifacts and symbolic names, and helps move a Function definition from development to a production environment without changing your code.
Binding names must be valid JavaScript identifiers, and cannot conflict with built-in types.</p>
</div>
<div class="paragraph">
<p>Your Eventing Function can have no binding, one binding, or several bindings.</p>
</div>
<div class="sect3">
<h4 id="bucket-alias"><a class="anchor" href="#bucket-alias"></a>Bucket alias</h4>
<div class="paragraph">
<p>A bucket alias binding gives the JavaScript of a Function access to the Couchbase KV collections from the Data Service or KV.
The keyspaces <code>bucket.scope.collection</code> are accessible by the bound name as a JavaScript map in the global space of the Function.</p>
</div>
<div class="paragraph">
<p>You can add bucket aliases by selecting <strong>Bucket alias</strong> and entering an alias-name, a keyspace, and the access level.
This sequence of values does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>alias-name is the name you can use to refer to the keyspace or collection from your Eventing Function code</p>
</li>
<li>
<p>keyspace is the full path to a collection in the cluster</p>
</li>
<li>
<p>the access level provides access to the keyspace as <code>read only</code> or <code>read and write</code></p>
<div class="ulist">
<ul>
<li>
<p><code>read only</code> lets you read documents from the collection but not write (create, update, or delete) documents in the collection</p>
</li>
<li>
<p><code>read and write</code> lets you read and write documents in the collection</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You must have one or more bucket alias bindings for your Eventing Function to perform operations directly against the Data Service.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An Eventing Function can listen to multiple collections when you use the <code>*</code> wildcard in its scope or collection.
You can also use the <code>*</code> wildcard in the scope or collection of the bucket alias code.
If the bucket alias has a <code>*</code> wildcard, only the Advanced Keyspace Accessors can read or write the Data Service.</p>
</div>
</div>
<div class="sect3">
<h4 id="url-alias"><a class="anchor" href="#url-alias"></a>URL alias</h4>
<div class="paragraph">
<p>A URL alias binding is used by the cURL language construct to access external resources.
The URL alias specifies the endpoint, the HTTP/S protocol, and the credentials.</p>
</div>
<div class="paragraph">
<p>You can enable cookie support through the binding when you access trusted remote nodes.
The target of a URL alias should not be a node that belongs to the Couchbase cluster.</p>
</div>
<div class="paragraph">
<p>You can add URL aliases by selecting <strong>URL alias</strong> and entering an alias-name, a URL, settings to allow cookies, security settings to validate SSL certificate, and an authorization type of <code>no auth</code>, <code>basic</code>, <code>bearer</code>, and <code>digest</code>.</p>
</div>
<div class="paragraph">
<p>For more information about URL aliases, see <a href="eventing-curl-spec.html#bindings" class="xref page">cURL Bindings</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="constant-alias"><a class="anchor" href="#constant-alias"></a>Constant alias</h4>
<div class="paragraph">
<p>A constant alias is used by the JavaScript code of the Eventing Function as a global variable.</p>
</div>
<div class="paragraph">
<p>You can add constant aliases by selecting <strong>Constant alias</strong> and entering an alias-name and a value.
The valuje can be an integer, a decimal number, a string, a boolean, or a JSON object.</p>
</div>
<div class="paragraph">
<p>For example, you can have an alias of <code>debug</code> with a value of <code>true</code> or <code>false</code> that controls logging.
This alias acts in the same way as adding a <code>const debug = true</code> statement at the beginning of your JavaScript code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eventing-keyspaces"><a class="anchor" href="#eventing-keyspaces"></a>Eventing Keyspaces</h3>
<div class="paragraph">
<p>A keyspace is a path to a collection in the format <code>bucket-name.scope-name.collection-name</code>.</p>
</div>
<div class="paragraph">
<p>For backward compatibility, you can also use the format <code>bucket-name._default._default</code>.
This is the format of a bucket from Couchbase Server version 6.6 that has been upgraded to version 7.0.</p>
</div>
<div class="paragraph">
<p>The following are the two keyspaces used by Eventing Functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#listen-to-location">Listen to Location</a>, which represents the Eventing source</p>
</li>
<li>
<p><a href="#eventing-storage">Eventing Storage</a>, which represents the Eventing metadata</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="listen-to-location"><a class="anchor" href="#listen-to-location"></a>Listen to Location</h4>
<div class="paragraph">
<p>Eventing Functions use a collection as the source for their data mutations.
This collection is called the Eventing source, and can be made up of Couchbase or Ephemeral keyspace types.
Memcached keyspace types are not supported.</p>
</div>
<div class="paragraph">
<p>When you create an Eventing Function, you must specify a source collection.
The <code>OnUpdate</code> and <code>OnDelete</code> handlers are the entry points for this collection; they receive events and receive and track data mutations.</p>
</div>
<div class="paragraph">
<p>When you delete a source collection, all deployed and paused Functions associated with the collection are undeployed.</p>
</div>
<div class="paragraph">
<p>While a Function is processing its JavaScript code, the Function&#8217;s documents can be mutated in different collections.
You can set keyspaces as destination collections, which are then bound to the Function through bucket aliases.</p>
</div>
<div class="paragraph">
<p>The Function&#8217;s JavaScript code triggers data mutations on documents through Basic Keyspace Accessors or Advanced Keyspace Accessors in the Data Service.
If the code directly modifies documents in the source collection, the Eventing Service suppresses the mutation back to the Function performing the mutation.</p>
</div>
<div class="paragraph">
<p>The Function&#8217;s JavaScript code can also trigger mutations on documents through inline SQL++ statements in the Query Service or <code>N1QL()</code> function calls.
You might need to add additional business logic to terminate or protect the Function against possible recursion.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you implement multiple Functions, you can create infinite recursions.
The Eventing Service prevents the deployment of Functions that might result in recursion loops.
For more information abotu cyclic generation of data changes, see <a href="troubleshooting-best-practices.html#cyclicredun" class="xref page">Bucket Allocation Considerations</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get the <code>Listen To</code> keyspace to listen to multiple collections, you can use a <code>*</code> wildcard for the scope or collection.
If the bucket binding used by the JavaScript code also has a <code>*</code> wildcard for its scope or collection, you must use Advanced Keyspace Accessors to read or write the Data Service. For more information about Advanced Keyspace Accessors, see <a href="eventing-advanced-keyspace-accessors.html#multiple-collection-functions" class="xref page">Eventing Functions that Listen to Multiple Collections</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can have multiple Functions listening to the same collection while running different code.
To use less resources, though, you can use only one Function and code an if-then-else or switch statement in your handler&#8217;s JavaScript.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eventing-storage"><a class="anchor" href="#eventing-storage"></a>Eventing Storage</h3>
<div class="paragraph">
<p>The Eventing Storage is the Eventing Function&#8217;s metadata bucket.
The metadata bucket stores artifacts, or configuration documents, that contain information about DCP streams, worker allocations, Timer information and state, and internal checkpoints.</p>
</div>
<div class="paragraph">
<p>When you create an Eventing Function, you must make sure that a separate collection has been designated as an Eventing metadata and reserved for the Eventing Service&#8217;s internal use.
You can use a common Eventing metadata collection across multiple Eventing Functions for the same tenant.</p>
</div>
<div class="paragraph">
<p>The Eventing Storage keyspace must be in a Couchbase-type bucket.
If this keyspace is not persistent, the Data Service evicts Timer and checkpoint documents when it hits quota, and loses track of Timers and mutations that have been processed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not delete the Eventing metadata collection.
Make sure that your Function&#8217;s JavaScript code does not perform a write or delete operation on the Eventing metadata collection.
If you delete the metadata collection, all deployed Eventing Functions are undeployed and all associated indexes and constructs are dropped.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="function-settings"><a class="anchor" href="#function-settings"></a>Eventing Function Settings</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Function Name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A unique name for your Eventing Function.
The Function name must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start with an uppercase character (A-Z), lowercase character (a-z), or number (0-9)</p>
</li>
<li>
<p>Contain only uppercase characters (A-Z), lowercase characters (a-z), numbers (0-9), underscores (_), and hyphens (-)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional description that describes the purpose of your Eventing Function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment Feed Boundary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Feed Boundary determines if the Eventing Function&#8217;s activities need to include documents that already exist.</p>
<p class="tableblock">When you set the Feed Boundary to <code>Everything</code>, the Function deploys all mutations available in your database.
When you set the Feed Boundary to <code>From Now</code>, the Function only processes instances of data mutation that happen after the Function&#8217;s deployment.</p>
<p class="tableblock">The Feed Boundary also works as a checkpoint for paused Functions.
When you resume a paused Function, the Feed Boundary makes sure that no mutations are lost or processed again.</p>
<p class="tableblock">You can only modify the Feed Boundary when you create a Function or when a Function is undeployed or paused.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Log Level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the granularity of messages logged across the Eventing Function.
Can be one of <code>Info</code> (the default), <code>Error</code>, <code>Debug</code>, <code>Warning</code>, or <code>Trace</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Log Location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory path to the log file for the Eventing Function.
The format is <code>&lt;function_name&gt;.log</code>.
The Function uses <code>log()</code> statements to write to this file.</p>
<p class="tableblock">When you select the <strong>Log</strong> value on the UI, all log files are combined across Eventing nodes and displayed.
The log value is read-only and cannot be changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL++ Consistency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default consistency level of SQL++ statements in the Eventing Function.</p>
<p class="tableblock">You can set the consistency level by statement.
Can be one of <code>None</code> (the default) or <code>Request</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of worker threads per node to be allocated to the Eventing Function to process events.
Allows the Function to scale up.</p>
<p class="tableblock">The minimum number of workers is <code>1</code> (the default) and the maximum is <code>64</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language Compatibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The language version of the Eventing Function for backward compatibility.</p>
<p class="tableblock">If the semantics of a language construct change during a release, the Language Compatibility setting makes sure that an older Eventing Function continues to produce the runtime behavior from when the Function was initially created.
The older Function only stops this behavior when the behavior is deprecated and removed.</p>
<p class="tableblock">Couchbase versions 6.0.0, 6.5.0, and 6.6.2 are the only versions that are currently defined.
New Functions default to the highest compatibility version available of 6.6.2.</p>
<p class="tableblock">In version 6.5.0, trying to access a non-existing item from a keyspace returns an undefined value.
In version 6.0.0, it throws an exception.</p>
<p class="tableblock">Only a Function with a language compability setting of version 6.6.2 passes binary documents to Eventing Function handlers.
Versions 6.0.0 and 6.5.0 filter all binary documents out of the DCP mutation stream.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script Timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of seconds to elapse before the script times out and is terminated.</p>
<p class="tableblock">The entry points into the handler processing for each mutation must run from start to finish before the specified timeout duration.
The default number of seconds is <code>60</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time Context Max Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size limit of the context for any Timer created by the Eventing Function.</p>
<p class="tableblock">A context can be any JSON document. Timers can store and access a context, which is then used to store the state of when a Timer is created and to retrieve the state of when a Timer is fired.</p>
<p class="tableblock">The default is <code>1024</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operations"><a class="anchor" href="#operations"></a>Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operations exposed through the UI, couchbase-cli, and REST APIs.</p>
</div>
<div class="sect2">
<h3 id="deploy"><a class="anchor" href="#deploy"></a>Deploy</h3>
<div class="paragraph">
<p>The deploy operation activates an Eventing Function in a cluster.
It performs validations and allows only valid Eventing Functions to be deployed.</p>
</div>
<div class="paragraph">
<p>Deploying an Eventing Function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates necessary metadata</p>
</li>
<li>
<p>Spawns worker processes</p>
</li>
<li>
<p>Calculates initial partitions</p>
</li>
<li>
<p>Initiates check-pointing of DCP streams to process</p>
</li>
<li>
<p>Allows the Function to receive and process mutations and Timer callbacks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You cannot edit the source code of a deployed Eventing Function.</p>
</div>
<div class="paragraph">
<p>During deployment, you must choose one of the following <strong>Deployment Feed Boundary</strong> settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Everything</strong>, which provides the Eventing Function with a deduplicated history of all documents, ending with the current value of each document. This means the Function sees every document in the keyspace at least once.</p>
</li>
<li>
<p><strong>From now</strong>, which provides the Eventing Function with mutations starting at deployment. This means the Function only sees documents that have mutated after the Function&#8217;s deployment.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="undeploy"><a class="anchor" href="#undeploy"></a>Undeploy</h3>
<div class="paragraph">
<p>The undeploy operation causes the Eventing Function to stop processing events of all types.
It also shuts down the worker processes associated with the Function.</p>
</div>
<div class="paragraph">
<p>Undeploying an Eventing Function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deletes all Timers and context documents created by the Function</p>
</li>
<li>
<p>Releases any runtime resources acquired by the Function</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can edit the code and change the settings of an undeployed Eventing Function.</p>
</div>
<div class="paragraph">
<p>When you create a new Eventing Function, the Function&#8217;s state is undeployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="pause"><a class="anchor" href="#pause"></a>Pause</h3>
<div class="paragraph">
<p>The pause operation causes the Eventing Function to pause all mutations and Timer callbacks.
It also performs a checkpoint to be used for resuming the Function.</p>
</div>
<div class="paragraph">
<p>You can edit the code and change the settings of a paused Eventing Function.</p>
</div>
<div class="paragraph">
<p>A paused Function can be resumed or undeployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="resume"><a class="anchor" href="#resume"></a>Resume</h3>
<div class="paragraph">
<p>The resume operation continues processing mutations and Timer callbacks of an Eventing Function that was previously paused.</p>
</div>
<div class="paragraph">
<p>The resume operation is similar to the deploy operation, but it uses a progress checkpoint to restart the Function. This means no mutations are lost or processed again.</p>
</div>
<div class="paragraph">
<p>When you resume a Function, the backlog of mutations that occurred when the Function was in a paused state is processed. The backlog of Timers also fires, even if the time of the Timers has already passed.</p>
</div>
<div class="paragraph">
<p>Depending on the system capacity and on how long the Function was paused, clearing the backlog can take some time. After the backlog is cleared, the Function goes on to process current mutations and Timers.</p>
</div>
</div>
<div class="sect2">
<h3 id="delete"><a class="anchor" href="#delete"></a>Delete</h3>
<div class="paragraph">
<p>The delete operation deletes the following in the Eventing Function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The source code implementing the Function</p>
</li>
<li>
<p>All Timers and Timer contexts</p>
</li>
<li>
<p>All processing checkpoints</p>
</li>
<li>
<p>Application logs</p>
</li>
<li>
<p>Any other artifacts in the metadata provider</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can only delete an undeployed Eventing Function.</p>
</div>
</div>
<div class="sect2">
<h3 id="debug"><a class="anchor" href="#debug"></a>Debug</h3>
<div class="paragraph">
<p>The debug operation traps and sends the next event instance received by the Eventing Function to a separate v8 worker with debugging enabled. Debug is a special flag that can be attach to a Function.</p>
</div>
<div class="paragraph">
<p>The debug operation pauses the trapped event, opens a TCP port, and generates a Chrome Developer Tools URL with a session cookie that can be used to control the debug worker.
With the exception of the trapped event instance, all other Eventing Function events continue processing.</p>
</div>
<div class="paragraph">
<p>When the trapped event finishes debugging, the debug operation traps another event instance.
This continues until you stop the operation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>See Also</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="eventing-advanced-keyspace-accessors.html" class="xref page">Advanced Keyspace Accessors</a></p>
</li>
<li>
<p><a href="eventing-language-constructs.html#basic_bucket_accessors" class="xref page">Basic Keyspace Accessors</a></p>
</li>
<li>
<p><a href="eventing-curl-spec.html" class="xref page">cURL</a></p>
</li>
<li>
<p><a href="troubleshooting-best-practices.html" class="xref page">Troubleshooting and Best Practices</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.6"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
